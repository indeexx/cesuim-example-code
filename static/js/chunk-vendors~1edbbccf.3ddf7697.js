(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors~1edbbccf"],{"6a98":function(t,e,o){"use strict";var i=o("6af0"),a=o("85b2"),n=o("dde0"),s=o("6b82"),r=o("8d54"),c=o("c937"),l=o("e2a6"),m=o("b8b5"),u=o("722e"),d=o("ec1a"),p=o("1345"),h=o("6f7c"),_=o("dc6c");const f={},g=new s["a"](0,0,0,1);let w=new s["a"];const T=new i["a"],y=new a["a"],b=new a["a"];f.wgs84ToWindowCoordinates=function(t,e,o){return f.wgs84WithEyeOffsetToWindowCoordinates(t,e,n["a"].ZERO,o)};const P=new s["a"],E=new n["a"];function M(t,e,o,i){const a=o.viewMatrix,r=u["a"].multiplyByVector(a,s["a"].fromElements(t.x,t.y,t.z,1,P),P),c=n["a"].multiplyComponents(e,n["a"].normalize(r,E),E);return r.x+=e.x+c.x,r.y+=e.y+c.y,r.z+=c.z,u["a"].multiplyByVector(o.frustum.projectionMatrix,r,i)}const O=new r["a"](Math.PI,m["a"].PI_OVER_TWO),R=new n["a"],C=new n["a"];f.wgs84WithEyeOffsetToWindowCoordinates=function(t,e,o,i){if(!Object(c["a"])(t))throw new l["a"]("scene is required.");if(!Object(c["a"])(e))throw new l["a"]("position is required.");const s=t.frameState,r=f.computeActualWgs84Position(s,e,g);if(!Object(c["a"])(r))return;const P=t.canvas,E=T;E.x=0,E.y=0,E.width=P.clientWidth,E.height=P.clientHeight;const v=t.camera;let x=!1;if(s.mode===_["a"].SCENE2D){const e=t.mapProjection,s=O,c=e.project(s,R),l=n["a"].clone(v.position,C),d=v.frustum.clone(),p=u["a"].computeViewportTransformation(E,0,1,new u["a"]),_=v.frustum.projectionMatrix,g=v.positionWC.y,T=n["a"].fromElements(m["a"].sign(g)*c.x-g,0,-v.positionWC.x),I=h["a"].pointToGLWindowCoordinates(_,p,T);if(0===g||I.x<=0||I.x>=P.clientWidth)x=!0;else{if(I.x>.5*P.clientWidth){E.width=I.x,v.frustum.right=c.x-g,w=M(r,o,v,w),f.clipToGLWindowCoordinates(E,w,y),E.x+=I.x,v.position.x=-v.position.x;const t=v.frustum.right;v.frustum.right=-v.frustum.left,v.frustum.left=-t,w=M(r,o,v,w),f.clipToGLWindowCoordinates(E,w,b)}else{E.x+=I.x,E.width-=I.x,v.frustum.left=-c.x-g,w=M(r,o,v,w),f.clipToGLWindowCoordinates(E,w,y),E.x=E.x-E.width,v.position.x=-v.position.x;const t=v.frustum.left;v.frustum.left=-v.frustum.right,v.frustum.right=-t,w=M(r,o,v,w),f.clipToGLWindowCoordinates(E,w,b)}n["a"].clone(l,v.position),v.frustum=d.clone(),i=a["a"].clone(y,i),(i.x<0||i.x>P.clientWidth)&&(i.x=b.x)}}if(s.mode!==_["a"].SCENE2D||x){if(w=M(r,o,v,w),w.z<0&&!(v.frustum instanceof d["a"])&&!(v.frustum instanceof p["a"]))return;i=f.clipToGLWindowCoordinates(E,w,i)}return i.y=P.clientHeight-i.y,i},f.wgs84ToDrawingBufferCoordinates=function(t,e,o){if(o=f.wgs84ToWindowCoordinates(t,e,o),Object(c["a"])(o))return f.transformWindowToDrawingBuffer(t,o,o)};const v=new n["a"],x=new r["a"];f.computeActualWgs84Position=function(t,e,o){const i=t.mode;if(i===_["a"].SCENE3D)return n["a"].clone(e,o);const a=t.mapProjection,s=a.ellipsoid.cartesianToCartographic(e,x);if(!Object(c["a"])(s))return;if(a.project(s,v),i===_["a"].COLUMBUS_VIEW)return n["a"].fromElements(v.z,v.x,v.y,o);if(i===_["a"].SCENE2D)return n["a"].fromElements(0,v.x,v.y,o);const r=t.morphTime;return n["a"].fromElements(m["a"].lerp(v.z,e.x,r),m["a"].lerp(v.x,e.y,r),m["a"].lerp(v.y,e.z,r),o)};const I=new n["a"],S=new n["a"],j=new u["a"];f.clipToGLWindowCoordinates=function(t,e,o){return n["a"].divideByScalar(e,e.w,I),u["a"].computeViewportTransformation(t,0,1,j),u["a"].multiplyByPoint(j,I,S),a["a"].fromCartesian3(S,o)},f.transformWindowToDrawingBuffer=function(t,e,o){const i=t.canvas,n=t.drawingBufferWidth/i.clientWidth,s=t.drawingBufferHeight/i.clientHeight;return a["a"].fromElements(e.x*n,e.y*s,o)};const N=new s["a"],z=new s["a"];f.drawingBufferToWgs84Coordinates=function(t,e,o,i){const a=t.context,r=a.uniformState,l=r.currentFrustum,m=l.x,d=l.y;if(t.frameState.useLogDepth){const t=o*r.log2FarDepthFromNearPlusOne,e=Math.pow(2,t)-1;o=d*(1-m/(e+m))/(d-m)}const p=t.view.passState.viewport,h=s["a"].clone(s["a"].UNIT_W,N);let _;h.x=(e.x-p.x)/p.width*2-1,h.y=(e.y-p.y)/p.height*2-1,h.z=2*o-1,h.w=1;let f=t.camera.frustum;if(Object(c["a"])(f.fovy)){_=u["a"].multiplyByVector(r.inverseViewProjection,h,z);const t=1/_.w;n["a"].multiplyByScalar(_,t,_)}else Object(c["a"])(f._offCenterFrustum)&&(f=f._offCenterFrustum),_=z,_.x=.5*(h.x*(f.right-f.left)+f.left+f.right),_.y=.5*(h.y*(f.top-f.bottom)+f.bottom+f.top),_.z=.5*(h.z*(m-d)-m-d),_.w=1,_=u["a"].multiplyByVector(r.inverseView,_,_);return n["a"].fromCartesian4(_,i)},e["a"]=f},"8e20":function(t,e,o){"use strict";var i=o("dde0"),a=o("8d54"),n=o("ae9b"),s=o("c937"),r=o("21b7"),c=o("7e67"),l=o("b8b5"),m=o("722e"),u=o("ec1a"),d=o("1345"),p=o("3f87"),h=o("430c"),_=o("6d13"),f=o("149c"),g=o("6f7c"),w=o("c70c"),T=o("dc6c");function y(t){n["a"].typeOf.object("scene",t),this._scene=t,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}y.prototype.completeMorph=function(){Object(s["a"])(this._completeMorph)&&this._completeMorph()},y.prototype.morphTo2D=function(t,e){Object(s["a"])(this._completeMorph)&&this._completeMorph();const o=this._scene;this._previousMode=o.mode,this._morphToOrthographic=o.camera.frustum instanceof u["a"],this._previousMode!==T["a"].SCENE2D&&this._previousMode!==T["a"].MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,T["a"].SCENE2D,!0),o._mode=T["a"].MORPHING,o.camera._setTransform(m["a"].IDENTITY),this._previousMode===T["a"].COLUMBUS_VIEW?ht(this,t):Pt(this,t,e),0===t&&Object(s["a"])(this._completeMorph)&&this._completeMorph())};const b=new i["a"],P=new i["a"],E=new i["a"],M=new i["a"],O=new i["a"],R=new i["a"],C=new i["a"],v=new a["a"],x=new m["a"],I=new p["a"],S=new u["a"],j={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};y.prototype.morphToColumbusView=function(t,e){Object(s["a"])(this._completeMorph)&&this._completeMorph();const o=this._scene;if(this._previousMode=o.mode,this._previousMode===T["a"].COLUMBUS_VIEW||this._previousMode===T["a"].MORPHING)return;this._scene.morphStart.raiseEvent(this,this._previousMode,T["a"].COLUMBUS_VIEW,!0),o.camera._setTransform(m["a"].IDENTITY);let a=b;const n=P,r=E;if(t>0)a.x=0,a.y=-1,a.z=1,a=i["a"].multiplyByScalar(i["a"].normalize(a,a),5*e.maximumRadius,a),i["a"].negate(i["a"].normalize(a,n),n),i["a"].cross(i["a"].UNIT_X,n,r);else{const t=o.camera;if(this._previousMode===T["a"].SCENE2D)i["a"].clone(t.position,a),a.z=t.frustum.right-t.frustum.left,i["a"].negate(i["a"].UNIT_Z,n),i["a"].clone(i["a"].UNIT_Y,r);else{i["a"].clone(t.positionWC,a),i["a"].clone(t.directionWC,n),i["a"].clone(t.upWC,r);const s=e.scaleToGeodeticSurface(a,C),c=g["a"].eastNorthUpToFixedFrame(s,e,x);m["a"].inverseTransformation(c,c),o.mapProjection.project(e.cartesianToCartographic(a,v),a),m["a"].multiplyByPointAsVector(c,n,n),m["a"].multiplyByPointAsVector(c,r,r)}}let c;this._morphToOrthographic?(c=S,c.width=o.camera.frustum.right-o.camera.frustum.left,c.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight):(c=I,c.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,c.fov=l["a"].toRadians(60));const u=j;u.position=a,u.direction=n,u.up=r,u.frustum=c;const d=xt(u);D(this,d),this._previousMode===T["a"].SCENE2D?Mt(this,t,u,d):(u.position2D=m["a"].multiplyByPoint(w["a"].TRANSFORM_2D,a,M),u.direction2D=m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,n,O),u.up2D=m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,r,R),o._mode=T["a"].MORPHING,Ot(this,t,u,d)),0===t&&Object(s["a"])(this._completeMorph)&&this._completeMorph()};const N={position:new i["a"],direction:new i["a"],up:new i["a"],frustum:void 0},z=new p["a"];function D(t,e){if(t._scene.completeMorphOnUserInput){t._morphHandler=new _["a"](t._scene.canvas);const o=function(){t._morphCancelled=!0,t._scene.camera.cancelFlight(),e(t)};t._completeMorph=o,t._morphHandler.setInputAction(o,f["a"].LEFT_DOWN),t._morphHandler.setInputAction(o,f["a"].MIDDLE_DOWN),t._morphHandler.setInputAction(o,f["a"].RIGHT_DOWN),t._morphHandler.setInputAction(o,f["a"].WHEEL)}}function U(t){const e=t._currentTweens;for(let o=0;o<e.length;++o)e[o].cancelTween();t._currentTweens.length=0,t._morphHandler=t._morphHandler&&t._morphHandler.destroy()}y.prototype.morphTo3D=function(t,e){Object(s["a"])(this._completeMorph)&&this._completeMorph();const o=this._scene;if(this._previousMode=o.mode,this._previousMode!==T["a"].SCENE3D&&this._previousMode!==T["a"].MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,T["a"].SCENE3D,!0),o._mode=T["a"].MORPHING,o.camera._setTransform(m["a"].IDENTITY),this._previousMode===T["a"].SCENE2D)et(this,t,e);else{let a,n;t>0?(a=N,i["a"].fromDegrees(0,0,5*e.maximumRadius,e,a.position),i["a"].negate(a.position,a.direction),i["a"].normalize(a.direction,a.direction),i["a"].clone(i["a"].UNIT_Z,a.up)):a=F(this,e);const s=o.camera;s.frustum instanceof u["a"]?n=s.frustum.clone():(n=z,n.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,n.fov=l["a"].toRadians(60)),a.frustum=n;const r=Ct(a);D(this,r),G(this,t,a,r)}0===t&&Object(s["a"])(this._completeMorph)&&this._completeMorph()}},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return U(this),Object(r["a"])(this)};const W=new a["a"],A=new i["a"],B=new m["a"];function F(t,e){const o=t._scene,i=o.camera,a=N,n=a.position,s=a.direction,r=a.up,c=o.mapProjection.unproject(i.position,W);e.cartographicToCartesian(c,n);const l=e.scaleToGeodeticSurface(n,A),u=g["a"].eastNorthUpToFixedFrame(l,e,B);return m["a"].multiplyByPointAsVector(u,i.direction,s),m["a"].multiplyByPointAsVector(u,i.up,r),a}const H=new i["a"],k=new i["a"],V=new i["a"],Z=new i["a"],L=new i["a"],q=new i["a"];function G(t,e,o,a){e*=.5;const n=t._scene,s=n.camera,r=i["a"].clone(s.position,H),l=i["a"].clone(s.direction,k),u=i["a"].clone(s.up,V),d=m["a"].multiplyByPoint(w["a"].TRANSFORM_2D_INVERSE,o.position,Z),p=m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D_INVERSE,o.direction,L),h=m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D_INVERSE,o.up,q);function _(t){ot(r,d,t.time,s.position),ot(l,p,t.time,s.direction),ot(u,h,t.time,s.up),i["a"].cross(s.direction,s.up,s.right),i["a"].normalize(s.right,s.right)}const f=n.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:_,complete:function(){Rt(t,n,0,1,e,a)}});t._currentTweens.push(f)}const Y=new u["a"],Q=new i["a"],X=new i["a"],J=new i["a"],K=new i["a"],$=new i["a"],tt=new i["a"];function et(t,e,o){e/=3;const a=t._scene,n=a.camera;let s,r;e>0?(s=N,i["a"].fromDegrees(0,0,5*o.maximumRadius,o,s.position),i["a"].negate(s.position,s.direction),i["a"].normalize(s.direction,s.direction),i["a"].clone(i["a"].UNIT_Z,s.up)):(n.position.z=n.frustum.right-n.frustum.left,s=F(t,o)),t._morphToOrthographic?(r=Y,r.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,r.width=n.frustum.right-n.frustum.left):(r=z,r.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,r.fov=l["a"].toRadians(60)),s.frustum=r;const c=Ct(s);let m;D(t,c),m=t._morphToOrthographic?function(){G(t,e,s,c)}:function(){Et(t,e,s,(function(){G(t,e,s,c)}))},e>0?(a._mode=T["a"].SCENE2D,n.flyTo({duration:e,destination:i["a"].fromDegrees(0,0,5*o.maximumRadius,o,K),complete:function(){a._mode=T["a"].MORPHING,m()}})):m()}function ot(t,e,o,a){return i["a"].lerp(t,e,o,a)}function it(t,e,o,i,a){const n=t._scene,s=n.camera;if(s.frustum instanceof u["a"])return;const r=s.frustum.fov,m=.5*l["a"].RADIANS_PER_DEGREE,d=o.position.z*Math.tan(.5*r);function p(t){s.frustum.fov=l["a"].lerp(r,m,t.time);const e=d/Math.tan(.5*s.frustum.fov);i(s,e)}s.frustum.far=d/Math.tan(.5*m)+1e7;const h=n.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){s.frustum=o.frustum.clone(),a(t)}});t._currentTweens.push(h)}const at=new i["a"],nt=new i["a"],st=new i["a"],rt=new i["a"],ct=new i["a"],lt=new i["a"],mt=new d["a"],ut=new h["a"],dt=new i["a"],pt={position:void 0,direction:void 0,up:void 0,frustum:void 0};function ht(t,e){e*=.5;const o=t._scene,a=o.camera,n=i["a"].clone(a.position,at),r=i["a"].clone(a.direction,nt),l=i["a"].clone(a.up,st),u=i["a"].negate(i["a"].UNIT_Z,ct),d=i["a"].clone(i["a"].UNIT_Y,lt),p=rt;if(e>0)i["a"].clone(i["a"].ZERO,rt),p.z=5*o.mapProjection.ellipsoid.maximumRadius;else{i["a"].clone(n,rt);const t=ut;m["a"].multiplyByPoint(w["a"].TRANSFORM_2D,n,t.origin),m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,r,t.direction);const e=o.globe;if(Object(s["a"])(e)){const a=e.pickWorldCoordinates(t,o,!0,dt);Object(s["a"])(a)&&(m["a"].multiplyByPoint(w["a"].TRANSFORM_2D_INVERSE,a,p),p.z+=i["a"].distance(n,p))}}const h=mt;h.right=.5*p.z,h.left=-h.right,h.top=h.right*(o.drawingBufferHeight/o.drawingBufferWidth),h.bottom=-h.top;const _=pt;_.position=p,_.direction=u,_.up=d,_.frustum=h;const f=vt(_);function g(t){ot(n,p,t.time,a.position),ot(r,u,t.time,a.direction),ot(l,d,t.time,a.up),i["a"].cross(a.direction,a.up,a.right),i["a"].normalize(a.right,a.right),a._adjustOrthographicFrustum(!0)}function T(t,e){t.position.z=e}D(t,f);const y=o.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:g,complete:function(){it(t,e,_,T,f)}});t._currentTweens.push(y)}const _t=new a["a"],ft={position:new i["a"],direction:new i["a"],up:new i["a"],position2D:new i["a"],direction2D:new i["a"],up2D:new i["a"],frustum:new d["a"]},gt={position:new i["a"],direction:new i["a"],up:new i["a"],frustum:void 0},wt=new i["a"],Tt=new h["a"],yt=new m["a"],bt=new i["a"];function Pt(t,e,o){e*=.5;const a=t._scene,n=a.camera,r=ft;if(e>0)i["a"].clone(i["a"].ZERO,r.position),r.position.z=5*o.maximumRadius,i["a"].negate(i["a"].UNIT_Z,r.direction),i["a"].clone(i["a"].UNIT_Y,r.up);else{o.cartesianToCartographic(n.positionWC,_t),a.mapProjection.project(_t,r.position),i["a"].negate(i["a"].UNIT_Z,r.direction),i["a"].clone(i["a"].UNIT_Y,r.up);const t=Tt;i["a"].clone(r.position2D,t.origin);const e=i["a"].clone(n.directionWC,t.direction),c=o.scaleToGeodeticSurface(n.positionWC,bt),l=g["a"].eastNorthUpToFixedFrame(c,o,yt);m["a"].inverseTransformation(l,l),m["a"].multiplyByPointAsVector(l,e,e),m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,e,e);const u=a.globe;if(Object(s["a"])(u)){const e=u.pickWorldCoordinates(t,a,!0,wt);if(Object(s["a"])(e)){const t=i["a"].distance(r.position2D,e);e.x+=t,i["a"].clone(e,r.position2D)}}}function c(t,e){t.position.x=e}m["a"].multiplyByPoint(w["a"].TRANSFORM_2D,r.position,r.position2D),m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,r.direction,r.direction2D),m["a"].multiplyByPointAsVector(w["a"].TRANSFORM_2D,r.up,r.up2D);const l=r.frustum;l.right=.5*r.position.z,l.left=-l.right,l.top=l.right*(a.drawingBufferHeight/a.drawingBufferWidth),l.bottom=-l.top;const u=gt;m["a"].multiplyByPoint(w["a"].TRANSFORM_2D_INVERSE,r.position2D,u.position),i["a"].clone(r.direction,u.direction),i["a"].clone(r.up,u.up),u.frustum=l;const d=vt(u);function p(){it(t,e,r,c,d)}D(t,d),Ot(t,e,r,p)}function Et(t,e,o,i){const a=t._scene,n=a.camera,s=n.frustum.right-n.frustum.left;n.frustum=o.frustum.clone();const r=n.frustum.fov,m=.5*l["a"].RADIANS_PER_DEGREE,u=s*Math.tan(.5*r);function d(t){n.frustum.fov=l["a"].lerp(m,r,t.time),n.position.z=u/Math.tan(.5*n.frustum.fov)}n.frustum.far=u/Math.tan(.5*m)+1e7,n.frustum.fov=m;const p=a.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:d,complete:function(){i(t)}});t._currentTweens.push(p)}function Mt(t,e,o,a){e*=.5;const n=t._scene,s=n.camera,r=i["a"].clone(o.position,K),l=i["a"].clone(o.direction,$),m=i["a"].clone(o.up,tt);function u(){s.frustum=o.frustum.clone();const u=i["a"].clone(s.position,Q),d=i["a"].clone(s.direction,X),p=i["a"].clone(s.up,J);function h(t){ot(u,r,t.time,s.position),ot(d,l,t.time,s.direction),ot(p,m,t.time,s.up),i["a"].cross(s.direction,s.up,s.right),i["a"].normalize(s.right,s.right)}u.z=r.z;const _=n.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:h,complete:function(){a(t)}});t._currentTweens.push(_)}n._mode=T["a"].MORPHING,t._morphToOrthographic?u():Et(t,0,o,u)}function Ot(t,e,o,a){const n=t._scene,s=n.camera,r=i["a"].clone(s.position,Q),l=i["a"].clone(s.direction,X),m=i["a"].clone(s.up,J),u=i["a"].clone(o.position2D,K),d=i["a"].clone(o.direction2D,$),p=i["a"].clone(o.up2D,tt);function h(t){ot(r,u,t.time,s.position),ot(l,d,t.time,s.direction),ot(m,p,t.time,s.up),i["a"].cross(s.direction,s.up,s.right),i["a"].normalize(s.right,s.right),s._adjustOrthographicFrustum(!0)}const _=n.tweens.add({duration:e,easingFunction:c["a"].QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:h,complete:function(){Rt(t,n,1,0,e,a)}});t._currentTweens.push(_)}function Rt(t,e,o,i,a,n){const r={object:e,property:"morphTime",startValue:o,stopValue:i,duration:a,easingFunction:c["a"].QUARTIC_OUT};Object(s["a"])(n)&&(r.complete=function(){n(t)});const l=e.tweens.addProperty(r);t._currentTweens.push(l)}function Ct(t){return function(e){const o=e._scene;o._mode=T["a"].SCENE3D,o.morphTime=T["a"].getMorphTime(T["a"].SCENE3D),U(e);const a=o.camera;(e._previousMode!==T["a"].MORPHING||e._morphCancelled)&&(e._morphCancelled=!1,i["a"].clone(t.position,a.position),i["a"].clone(t.direction,a.direction),i["a"].clone(t.up,a.up),i["a"].cross(a.direction,a.up,a.right),i["a"].normalize(a.right,a.right),a.frustum=t.frustum.clone());const n=a.frustum;o.frameState.useLogDepth&&(n.near=.1,n.far=1e10);const r=Object(s["a"])(e._completeMorph);e._completeMorph=void 0,o.camera.update(o.mode),e._scene.morphComplete.raiseEvent(e,e._previousMode,T["a"].SCENE3D,r)}}function vt(t){return function(e){const o=e._scene;o._mode=T["a"].SCENE2D,o.morphTime=T["a"].getMorphTime(T["a"].SCENE2D),U(e);const a=o.camera;i["a"].clone(t.position,a.position),a.position.z=2*o.mapProjection.ellipsoid.maximumRadius,i["a"].clone(t.direction,a.direction),i["a"].clone(t.up,a.up),i["a"].cross(a.direction,a.up,a.right),i["a"].normalize(a.right,a.right),a.frustum=t.frustum.clone();const n=Object(s["a"])(e._completeMorph);e._completeMorph=void 0,o.camera.update(o.mode),e._scene.morphComplete.raiseEvent(e,e._previousMode,T["a"].SCENE2D,n)}}function xt(t){return function(e){const o=e._scene;o._mode=T["a"].COLUMBUS_VIEW,o.morphTime=T["a"].getMorphTime(T["a"].COLUMBUS_VIEW),U(e);const a=o.camera;(e._previousModeMode!==T["a"].MORPHING||e._morphCancelled)&&(e._morphCancelled=!1,i["a"].clone(t.position,a.position),i["a"].clone(t.direction,a.direction),i["a"].clone(t.up,a.up),i["a"].cross(a.direction,a.up,a.right),i["a"].normalize(a.right,a.right));const n=a.frustum;o.frameState.useLogDepth&&(n.near=.1,n.far=1e10);const r=Object(s["a"])(e._completeMorph);e._completeMorph=void 0,o.camera.update(o.mode),e._scene.morphComplete.raiseEvent(e,e._previousMode,T["a"].COLUMBUS_VIEW,r)}}e["a"]=y},c767:function(t,e,o){"use strict";var i=o("4051"),a=o("21b7"),n=o("a3c8"),s=o("66fd"),r=o("1494");function c(){this._numSamples=1,this._colorFramebuffer=new s["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._idFramebuffer=new s["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._idClearColor=new i["a"](0,0,0,0),this._clearCommand=new n["a"]({color:new i["a"](0,0,0,0),depth:1,owner:this})}function l(t){t._colorFramebuffer.destroy(),t._idFramebuffer.destroy()}Object.defineProperties(c.prototype,{framebuffer:{get:function(){return this._colorFramebuffer.framebuffer}},idFramebuffer:{get:function(){return this._idFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._colorFramebuffer.getDepthStencilTexture()}}}),c.prototype.update=function(t,e,o,i){const a=e.width,n=e.height,s=o?t.halfFloatingPointTexture?r["a"].HALF_FLOAT:r["a"].FLOAT:r["a"].UNSIGNED_BYTE;this._numSamples=i,this._colorFramebuffer.update(t,a,n,i,s),this._idFramebuffer.update(t,a,n)},c.prototype.clear=function(t,e,o){i["a"].clone(o,this._clearCommand.color),i["a"].clone(this._idClearColor,this._clearCommand.color),this._colorFramebuffer.clear(t,this._clearCommand,e),this._idFramebuffer.clear(t,this._clearCommand,e)},c.prototype.getFramebuffer=function(){return this._colorFramebuffer.framebuffer},c.prototype.getIdFramebuffer=function(){return this._idFramebuffer.framebuffer},c.prototype.prepareColorTextures=function(t){this._numSamples>1&&this._colorFramebuffer.prepareTextures(t)},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return l(this),Object(a["a"])(this)},e["a"]=c},d6be:function(t,e,o){"use strict";var i=o("85b2"),a=o("dde0"),n=o("6b82"),s=o("8d54"),r=o("1a5d"),c=o("c937"),l=o("21b7"),m=o("e2a6"),u=o("e107"),d=o("d0db"),p=o("7f05"),h=o("d2bc"),_=o("b8b5"),f=o("d767"),g=o("722e"),w=o("ec1a"),T=o("a7b2"),y=o("1b9c"),b=o("430c"),P=o("d9c4"),E=o("6f7c"),M=o("9c41"),O=o("0f20"),R=o("d58e"),C=o("dc6c"),v=o("6a98"),x=o("ef44");function I(t){if(!Object(c["a"])(t))throw new m["a"]("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=O["a"].LEFT_DRAG,this.zoomEventTypes=[O["a"].RIGHT_DRAG,O["a"].WHEEL,O["a"].PINCH],this.rotateEventTypes=O["a"].LEFT_DRAG,this.tiltEventTypes=[O["a"].MIDDLE_DRAG,O["a"].PINCH,{eventType:O["a"].LEFT_DRAG,modifier:h["a"].CTRL},{eventType:O["a"].RIGHT_DRAG,modifier:h["a"].CTRL}],this.lookEventTypes={eventType:O["a"].LEFT_DRAG,modifier:h["a"].SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=t,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new M["a"](t.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new x["a"],this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new i["a"](-1,-1),this._tiltCenter=new a["a"],this._rotateMousePosition=new i["a"](-1,-1),this._rotateStartPosition=new a["a"],this._strafeStartPosition=new a["a"],this._strafeMousePosition=new i["a"],this._strafeEndMousePosition=new i["a"],this._zoomMouseStart=new i["a"](-1,-1),this._zoomWorldPosition=new a["a"],this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;const e=t.mapProjection;this._maxCoord=e.project(new s["a"](Math.PI,_["a"].PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function S(t,e){if(t<0)return 0;const o=25*(1-e);return Math.exp(-o*t)}function j(t){return i["a"].equalsEpsilon(t.startPosition,t.endPosition,_["a"].EPSILON14)}const N=.4;function z(t,e,o,a,n,s,r){let l=s[r];Object(c["a"])(l)||(l=s[r]={startPosition:new i["a"],endPosition:new i["a"],motion:new i["a"],inertiaEnabled:!0});const m=t.getButtonPressTime(e,o),u=t.getButtonReleaseTime(e,o),d=m&&u&&(u.getTime()-m.getTime())/1e3,p=new Date,h=u&&(p.getTime()-u.getTime())/1e3;if(m&&u&&d<N){const r=S(h,a),m=t.getLastMovement(e,o);if(!Object(c["a"])(m)||j(m)||!l.inertiaEnabled)return;if(l.motion.x=.5*(m.endPosition.x-m.startPosition.x),l.motion.y=.5*(m.endPosition.y-m.startPosition.y),l.startPosition=i["a"].clone(m.startPosition,l.startPosition),l.endPosition=i["a"].multiplyByScalar(l.motion,r,l.endPosition),l.endPosition=i["a"].add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||i["a"].distance(l.startPosition,l.endPosition)<.5)return;if(!t.isButtonDown(e,o)){const i=t.getStartMousePosition(e,o);n(s,i,l)}}}function D(t,e){if(Object(c["a"])(e)){let o=t[e];Object(c["a"])(o)&&(o.inertiaEnabled=!0);const i=t._inertiaDisablers[e];if(Object(c["a"])(i)){const e=i.length;for(let a=0;a<e;++a)o=t[i[a]],Object(c["a"])(o)&&(o.inertiaEnabled=!1)}}}const U=[];function W(t,e,o,i,a,n){if(!Object(c["a"])(o))return;const s=t._aggregator;Array.isArray(o)||(U[0]=o,o=U);const r=o.length;for(let l=0;l<r;++l){const r=o[l],m=Object(c["a"])(r.eventType)?r.eventType:r,u=r.modifier,d=s.isMoving(m,u)&&s.getMovement(m,u),p=s.getStartMousePosition(m,u);t.enableInputs&&e&&(d?(i(t,p,d),D(t,n)):a<1&&z(s,m,u,a,i,t,n))}}const A=new b["a"],B=new a["a"],F=new i["a"],H=new a["a"],k=new i["a"],V=new a["a"],Z=new a["a"],L=new a["a"],q=new a["a"],G=new a["a"],Y=new a["a"],Q=new a["a"],X=new a["a"],J=new a["a"],K=new a["a"],$=new a["a"],tt=new a["a"],et=new a["a"],ot=new a["a"],it=new a["a"],at=new a["a"],nt=new a["a"],st=new a["a"],rt={orientation:new d["a"]};function ct(t,e,o,n,s,r){let l=1;Object(c["a"])(r)&&(l=_["a"].clamp(Math.abs(r),.25,1));const m=o.endPosition.y-o.startPosition.y,u=m>0,d=u?t.minimumZoomDistance*l:0,p=t.maximumZoomDistance,h=s-d;let f=n*h;f=_["a"].clamp(f,t._minimumZoomRate,t._maximumZoomRate);let g=m/t._scene.canvas.clientHeight;g=Math.min(g,t.maximumMovementRatio);let T=f*g;if(t.enableCollisionDetection||0===t.minimumZoomDistance||!Object(c["a"])(t._globe)){if(T>0&&Math.abs(s-d)<1)return;if(T<0&&Math.abs(s-p)<1)return;s-T<d?T=s-d-1:s-T>p&&(T=s-p)}const y=t._scene,b=y.camera,P=y.mode,E=rt.orientation;if(E.heading=b.heading,E.pitch=b.pitch,E.roll=b.roll,b.frustum instanceof w["a"])return void(Math.abs(T)>0&&(b.zoomIn(T),b._adjustOrthographicFrustum()));const M=i["a"].equals(e,t._zoomMouseStart);let O,R=t._zoomingOnVector,x=t._rotatingZoom;if(M||(t._zoomMouseStart=i["a"].clone(e,t._zoomMouseStart),Object(c["a"])(t._globe)&&(P===C["a"].SCENE2D?(O=b.getPickRay(e,A).origin,O=a["a"].fromElements(O.y,O.z,O.x)):O=Pt(t,e,B)),Object(c["a"])(O)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=a["a"].clone(O,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,R=t._zoomingOnVector=!1,x=t._rotatingZoom=!1,t._zoomingUnderground=t._cameraUnderground),!t._useZoomWorldPosition)return void b.zoomIn(T);let I=P===C["a"].COLUMBUS_VIEW;if(b.positionCartographic.height<2e6&&(x=!0),!M||x){if(P===C["a"].SCENE2D){const o=t._zoomWorldPosition,i=b.position;if(!a["a"].equals(o,i)&&b.positionCartographic.height<2*t._maxCoord.x){const n=b.position.x,s=a["a"].subtract(o,i,H);a["a"].normalize(s,s);const r=a["a"].distance(o,i)*T/(.5*b.getMagnitude());b.move(s,.5*r),(b.position.x<0&&n>0||b.position.x>0&&n<0)&&(O=b.getPickRay(e,A).origin,O=a["a"].fromElements(O.y,O.z,O.x),t._zoomWorldPosition=a["a"].clone(O,t._zoomWorldPosition))}}else if(P===C["a"].SCENE3D){const e=a["a"].normalize(b.position,G);if(t._cameraUnderground||t._zoomingUnderground||b.positionCartographic.height<3e3&&Math.abs(a["a"].dot(b.direction,e))<.6)I=!0;else{const o=y.canvas,i=k;i.x=o.clientWidth/2,i.y=o.clientHeight/2;const n=Pt(t,i,V);if(Object(c["a"])(n))if(b.positionCartographic.height<1e6){if(!(a["a"].dot(b.direction,e)>=-.5)){const o=Q;a["a"].clone(b.position,o);const i=t._zoomWorldPosition;let n=Y;if(n=a["a"].normalize(i,n),a["a"].dot(n,e)<0)return;const s=it,r=K;a["a"].clone(b.direction,r),a["a"].add(o,a["a"].multiplyByScalar(r,1e3,at),s);const c=$,l=tt;a["a"].subtract(i,o,c),a["a"].normalize(c,l);const m=a["a"].dot(e,l);if(m>=0)return void(t._zoomMouseStart.x=-1);const u=Math.acos(-m),d=a["a"].magnitude(o),p=a["a"].magnitude(i),h=d-T,f=a["a"].magnitude(c),g=Math.asin(_["a"].clamp(f/p*Math.sin(u),-1,1)),w=Math.asin(_["a"].clamp(h/p*Math.sin(u),-1,1)),y=g-w+u,P=X;a["a"].normalize(o,P);let E=J;E=a["a"].cross(l,P,E),E=a["a"].normalize(E,E),a["a"].normalize(a["a"].cross(P,E,at),r),a["a"].multiplyByScalar(a["a"].normalize(s,at),a["a"].magnitude(s)-T,s),a["a"].normalize(o,o),a["a"].multiplyByScalar(o,h,o);const M=et;a["a"].multiplyByScalar(a["a"].add(a["a"].multiplyByScalar(P,Math.cos(y)-1,nt),a["a"].multiplyByScalar(r,Math.sin(y),st),at),h,M),a["a"].add(o,M,o),a["a"].normalize(s,P),a["a"].normalize(a["a"].cross(P,E,at),r);const O=ot;return a["a"].multiplyByScalar(a["a"].add(a["a"].multiplyByScalar(P,Math.cos(y)-1,nt),a["a"].multiplyByScalar(r,Math.sin(y),st),at),a["a"].magnitude(s),O),a["a"].add(s,O,s),a["a"].clone(o,b.position),a["a"].normalize(a["a"].subtract(s,o,at),b.direction),a["a"].clone(b.direction,b.direction),a["a"].cross(b.direction,b.up,b.right),a["a"].cross(b.right,b.direction,b.up),void b.setView(rt)}I=!0}else{const e=a["a"].normalize(n,Z),o=a["a"].normalize(t._zoomWorldPosition,L),i=a["a"].dot(o,e);if(i>0&&i<1){const t=_["a"].acosClamped(i),n=a["a"].cross(o,e,q),s=Math.abs(t)>_["a"].toRadians(20)?.75*b.positionCartographic.height:b.positionCartographic.height-T,r=T/s;b.rotate(n,t*r)}}else I=!0}}t._rotatingZoom=!I}if(!M&&I||R){let o;const n=v["a"].wgs84ToWindowCoordinates(y,t._zoomWorldPosition,F);o=P!==C["a"].COLUMBUS_VIEW&&i["a"].equals(e,t._zoomMouseStart)&&Object(c["a"])(n)?b.getPickRay(n,A):b.getPickRay(e,A);const s=o.direction;P!==C["a"].COLUMBUS_VIEW&&P!==C["a"].SCENE2D||a["a"].fromElements(s.y,s.z,s.x,s),b.move(s,T),t._zoomingOnVector=!0}else b.zoomIn(T);t._cameraUnderground||b.setView(rt)}const lt=new b["a"],mt=new b["a"],ut=new a["a"];function dt(t,e,o){const i=t._scene,n=i.camera;let s=n.getPickRay(o.startPosition,lt).origin,r=n.getPickRay(o.endPosition,mt).origin;s=a["a"].fromElements(s.y,s.z,s.x,s),r=a["a"].fromElements(r.y,r.z,r.x,r);const c=a["a"].subtract(s,r,ut),l=a["a"].magnitude(c);l>0&&(a["a"].normalize(c,c),n.move(c,l))}function pt(t,e,o){Object(c["a"])(o.distance)&&(o=o.distance);const i=t._scene,a=i.camera;ct(t,e,o,t._zoomFactor,a.getMagnitude())}const ht=new i["a"],_t=new i["a"];function ft(t,e,o){if(Object(c["a"])(o.angleAndHeight))return void gt(t,e,o.angleAndHeight);const a=t._scene,n=a.camera,s=a.canvas,r=s.clientWidth,l=s.clientHeight;let m=ht;m.x=2/r*o.startPosition.x-1,m.y=2/l*(l-o.startPosition.y)-1,m=i["a"].normalize(m,m);let u=_t;u.x=2/r*o.endPosition.x-1,u.y=2/l*(l-o.endPosition.y)-1,u=i["a"].normalize(u,u);let d=_["a"].acosClamped(m.x);m.y<0&&(d=_["a"].TWO_PI-d);let p=_["a"].acosClamped(u.x);u.y<0&&(p=_["a"].TWO_PI-p);const h=p-d;n.twistRight(h)}function gt(t,e,o){let i=t._rotateFactor*t._rotateRateRangeAdjustment;i>t._maximumRotateRate&&(i=t._maximumRotateRate),i<t._minimumRotateRate&&(i=t._minimumRotateRate);const a=t._scene,n=a.camera,s=a.canvas;let r=(o.endPosition.x-o.startPosition.x)/s.clientWidth;r=Math.min(r,t.maximumMovementRatio);const c=i*r*Math.PI*4;n.twistRight(c)}function wt(t){const e=t._scene.mapMode2D===R["a"].ROTATE;g["a"].equals(g["a"].IDENTITY,t._scene.camera.transform)?(W(t,t.enableTranslate,t.translateEventTypes,dt,t.inertiaTranslate,"_lastInertiaTranslateMovement"),W(t,t.enableZoom,t.zoomEventTypes,pt,t.inertiaZoom,"_lastInertiaZoomMovement"),e&&W(t,t.enableRotate,t.tiltEventTypes,ft,t.inertiaSpin,"_lastInertiaTiltMovement")):(W(t,t.enableZoom,t.zoomEventTypes,pt,t.inertiaZoom,"_lastInertiaZoomMovement"),e&&W(t,t.enableRotate,t.translateEventTypes,ft,t.inertiaSpin,"_lastInertiaSpinMovement"))}const Tt=new b["a"],yt=new a["a"],bt=new a["a"];function Pt(t,e,o){const i=t._scene,n=t._globe,s=i.camera;if(!Object(c["a"])(n))return;const r=!t._cameraUnderground;let l;i.pickPositionSupported&&(l=i.pickPositionWorldCoordinates(e,yt));const m=s.getPickRay(e,Tt),u=n.pickWorldCoordinates(m,i,r,bt),d=Object(c["a"])(l)?a["a"].distance(l,s.positionWC):Number.POSITIVE_INFINITY,p=Object(c["a"])(u)?a["a"].distance(u,s.positionWC):Number.POSITIVE_INFINITY;return d<p?a["a"].clone(l,o):a["a"].clone(u,o)}const Et=new s["a"];function Mt(t){const e=t._ellipsoid,o=t._scene,i=o.camera,a=o.mode;let n=0;if(a===C["a"].SCENE3D){const t=e.cartesianToCartographic(i.position,Et);Object(c["a"])(t)&&(n=t.height)}else n=i.position.z;const s=Object(r["a"])(t._scene.globeHeight,0),l=Math.abs(s-n);return l}const Ot=new a["a"];function Rt(t,e){const o=e.origin,i=e.direction,n=Mt(t),s=a["a"].normalize(o,Ot);let r=Math.abs(a["a"].dot(s,i));return r=2*Math.max(r,.5),n*r}function Ct(t,e,o,i){let n=a["a"].distance(e.origin,o);const s=Mt(t),r=_["a"].clamp(5*s,t._minimumUndergroundPickDistance,t._maximumUndergroundPickDistance);return n>r&&(n=Math.min(n,s/5),n=Math.max(n,100)),b["a"].getPoint(e,n,i)}function vt(t,e,o,i){let n;return Object(c["a"])(o)?(n=a["a"].distance(e.origin,o),n>t._maximumUndergroundPickDistance&&(n=Mt(t))):n=Mt(t),b["a"].getPoint(e,n,i)}const xt=new i["a"];function It(t,e){const o=e.endPosition,a=i["a"].subtract(e.endPosition,e.startPosition,xt),n=t._strafeEndMousePosition;i["a"].add(n,a,n),e.endPosition=n,he(t,e,t._strafeStartPosition),e.endPosition=o}const St=new b["a"],jt=new b["a"],Nt=new a["a"],zt=new a["a"],Dt=new a["a"],Ut=new a["a"],Wt=new T["a"](a["a"].UNIT_X,0),At=new i["a"],Bt=new i["a"];function Ft(t,e,o){if(a["a"].equals(e,t._translateMousePosition)||(t._looking=!1),a["a"].equals(e,t._strafeMousePosition)||(t._strafing=!1),t._looking)return void oo(t,e,o);if(t._strafing)return void It(t,o);const n=t._scene,s=n.camera,r=t._cameraUnderground,l=i["a"].clone(o.startPosition,At),m=i["a"].clone(o.endPosition,Bt);let u=s.getPickRay(l,St);const d=a["a"].clone(a["a"].ZERO,Ut),h=a["a"].UNIT_X;let f;if(s.position.z<t._minimumPickingTerrainHeight&&(f=Pt(t,l,Nt),Object(c["a"])(f)&&(d.x=f.x)),r||d.x>s.position.z&&Object(c["a"])(f)){let n=f;return r&&(n=vt(t,u,f,Nt)),i["a"].clone(e,t._strafeMousePosition),i["a"].clone(e,t._strafeEndMousePosition),a["a"].clone(n,t._strafeStartPosition),t._strafing=!0,void he(t,o,t._strafeStartPosition)}const g=T["a"].fromPointNormal(d,h,Wt);u=s.getPickRay(l,St);const w=p["a"].rayPlane(u,g,Nt),y=s.getPickRay(m,jt),b=p["a"].rayPlane(y,g,zt);if(!Object(c["a"])(w)||!Object(c["a"])(b))return t._looking=!0,oo(t,e,o),void i["a"].clone(e,t._translateMousePosition);const P=a["a"].subtract(w,b,Dt),E=P.x;P.x=P.y,P.y=P.z,P.z=E;const M=a["a"].magnitude(P);M>_["a"].EPSILON6&&(a["a"].normalize(P,P),s.move(P,M))}const Ht=new i["a"],kt=new b["a"],Vt=new a["a"],Zt=new a["a"],Lt=new g["a"],qt=new g["a"],Gt=new a["a"],Yt=new T["a"](a["a"].UNIT_X,0),Qt=new a["a"],Xt=new s["a"],Jt=new g["a"],Kt=new y["a"],$t=new f["a"],te=new a["a"];function ee(t,e,o){if(Object(c["a"])(o.angleAndHeight)&&(o=o.angleAndHeight),i["a"].equals(e,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)return void oo(t,e,o);const a=t._scene,n=a.camera;t._tiltCVOffMap||!t.onMap()||Math.abs(n.position.z)>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,oe(t,e,o)):ie(t,e,o)}function oe(t,e,o){const n=t._scene,s=n.camera,r=n.canvas,l=Ht;l.x=r.clientWidth/2,l.y=r.clientHeight/2;const m=s.getPickRay(l,kt),d=a["a"].UNIT_X,p=m.origin,h=m.direction;let f;const w=a["a"].dot(d,h);if(Math.abs(w)>_["a"].EPSILON6&&(f=-a["a"].dot(d,p)/w),!Object(c["a"])(f)||f<=0)return t._looking=!0,oo(t,e,o),void i["a"].clone(e,t._tiltCenterMousePosition);const T=a["a"].multiplyByScalar(h,f,Vt);a["a"].add(p,T,T);const y=n.mapProjection,b=y.ellipsoid;a["a"].fromElements(T.y,T.z,T.x,T);const P=y.unproject(T,Xt);b.cartographicToCartesian(P,T);const M=E["a"].eastNorthUpToFixedFrame(T,b,Lt),O=t._globe,R=t._ellipsoid;t._globe=void 0,t._ellipsoid=u["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;const C=g["a"].clone(s.transform,Jt);s._setTransform(M),Pe(t,e,o,a["a"].UNIT_Z),s._setTransform(C),t._globe=O,t._ellipsoid=R;const v=R.maximumRadius;t._rotateFactor=1/v,t._rotateRateRangeAdjustment=v}function ie(t,e,o){const n=t._scene,s=n.camera,r=t._cameraUnderground;let l,m;const d=a["a"].UNIT_X;if(i["a"].equals(e,t._tiltCenterMousePosition))l=a["a"].clone(t._tiltCenter,Vt);else{if(s.position.z<t._minimumPickingTerrainHeight&&(l=Pt(t,e,Vt)),!Object(c["a"])(l)){m=s.getPickRay(e,kt);const n=m.origin,r=m.direction;let u;const p=a["a"].dot(d,r);if(Math.abs(p)>_["a"].EPSILON6&&(u=-a["a"].dot(d,n)/p),!Object(c["a"])(u)||u<=0)return t._looking=!0,oo(t,e,o),void i["a"].clone(e,t._tiltCenterMousePosition);l=a["a"].multiplyByScalar(r,u,Vt),a["a"].add(n,l,l)}r&&(Object(c["a"])(m)||(m=s.getPickRay(e,kt)),Ct(t,m,l,l)),i["a"].clone(e,t._tiltCenterMousePosition),a["a"].clone(l,t._tiltCenter)}const h=n.canvas,w=Ht;w.x=h.clientWidth/2,w.y=t._tiltCenterMousePosition.y,m=s.getPickRay(w,kt);const b=a["a"].clone(a["a"].ZERO,Gt);b.x=l.x;const P=T["a"].fromPointNormal(b,d,Yt),M=p["a"].rayPlane(m,P,Zt),O=s._projection,R=O.ellipsoid;a["a"].fromElements(l.y,l.z,l.x,l);let C=O.unproject(l,Xt);R.cartographicToCartesian(C,l);const v=E["a"].eastNorthUpToFixedFrame(l,R,Lt);let x;Object(c["a"])(M)?(a["a"].fromElements(M.y,M.z,M.x,M),C=O.unproject(M,Xt),R.cartographicToCartesian(C,M),x=E["a"].eastNorthUpToFixedFrame(M,R,qt)):x=v;const I=t._globe,S=t._ellipsoid;t._globe=void 0,t._ellipsoid=u["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;let j=a["a"].UNIT_Z;const N=g["a"].clone(s.transform,Jt);s._setTransform(v);const z=a["a"].cross(a["a"].UNIT_Z,a["a"].normalize(s.position,Qt),Qt),D=a["a"].dot(s.right,z);if(Pe(t,e,o,j,!1,!0),s._setTransform(x),D<0){const i=o.startPosition.y-o.endPosition.y;(r&&i<0||!r&&i>0)&&(j=void 0);const a=s.constrainedAxis;s.constrainedAxis=void 0,Pe(t,e,o,j,!0,!1),s.constrainedAxis=a}else Pe(t,e,o,j,!0,!1);if(Object(c["a"])(s.constrainedAxis)){const t=a["a"].cross(s.direction,s.constrainedAxis,te);a["a"].equalsEpsilon(t,a["a"].ZERO,_["a"].EPSILON6)||(a["a"].dot(t,s.right)<0&&a["a"].negate(t,t),a["a"].cross(t,s.direction,s.up),a["a"].cross(s.direction,s.up,s.right),a["a"].normalize(s.up,s.up),a["a"].normalize(s.right,s.right))}s._setTransform(N),t._globe=I,t._ellipsoid=S;const U=S.maximumRadius;t._rotateFactor=1/U,t._rotateRateRangeAdjustment=U;const W=a["a"].clone(s.positionWC,Qt);if(t.enableCollisionDetection&&so(t),!a["a"].equals(s.positionWC,W)){s._setTransform(x),s.worldToCameraCoordinatesPoint(W,W);const t=a["a"].magnitudeSquared(W);a["a"].magnitudeSquared(s.position)>t&&(a["a"].normalize(s.position,s.position),a["a"].multiplyByScalar(s.position,Math.sqrt(t),s.position));const e=a["a"].angleBetween(W,s.position),o=a["a"].cross(W,s.position,W);a["a"].normalize(o,o);const i=y["a"].fromAxisAngle(o,e,Kt),n=f["a"].fromQuaternion(i,$t);f["a"].multiplyByVector(n,s.direction,s.direction),f["a"].multiplyByVector(n,s.up,s.up),a["a"].cross(s.direction,s.up,s.right),a["a"].cross(s.right,s.direction,s.up),s._setTransform(N)}}const ae=new i["a"],ne=new b["a"],se=new a["a"];function re(t,e,o){Object(c["a"])(o.distance)&&(o=o.distance);const i=t._scene,n=i.camera,s=i.canvas,r=t._cameraUnderground;let l;r?l=e:(l=ae,l.x=s.clientWidth/2,l.y=s.clientHeight/2);const m=n.getPickRay(l,ne),u=m.origin,d=m.direction,p=n.position.z;let h,_;if(p<t._minimumPickingTerrainHeight&&(h=Pt(t,l,se)),Object(c["a"])(h)&&(_=a["a"].distance(u,h)),r){const e=Rt(t,m,p);_=Object(c["a"])(_)?Math.min(_,e):e}if(!Object(c["a"])(_)){const t=a["a"].UNIT_X;_=-a["a"].dot(t,u)/a["a"].dot(t,d)}ct(t,e,o,t._zoomFactor,_)}function ce(t){const e=t._scene,o=e.camera;if(g["a"].equals(g["a"].IDENTITY,o.transform)){const e=t._tweens;if(t._aggregator.anyButtonDown&&e.removeAll(),W(t,t.enableTilt,t.tiltEventTypes,ee,t.inertiaSpin,"_lastInertiaTiltMovement"),W(t,t.enableTranslate,t.translateEventTypes,Ft,t.inertiaTranslate,"_lastInertiaTranslateMovement"),W(t,t.enableZoom,t.zoomEventTypes,re,t.inertiaZoom,"_lastInertiaZoomMovement"),W(t,t.enableLook,t.lookEventTypes,oo),!t._aggregator.anyButtonDown&&!e.contains(t._tween)){const i=o.createCorrectPositionTween(t.bounceAnimationTime);Object(c["a"])(i)&&(t._tween=e.add(i))}e.update()}else W(t,t.enableRotate,t.rotateEventTypes,Pe,t.inertiaSpin,"_lastInertiaSpinMovement"),W(t,t.enableZoom,t.zoomEventTypes,ze,t.inertiaZoom,"_lastInertiaZoomMovement")}const le=new b["a"],me=new T["a"](a["a"].UNIT_X,0),ue=new a["a"],de=new a["a"],pe=new a["a"];function he(t,e,o){const i=t._scene,n=i.camera,s=n.getPickRay(e.endPosition,le);let r=a["a"].clone(n.direction,de);i.mode===C["a"].COLUMBUS_VIEW&&a["a"].fromElements(r.z,r.x,r.y,r);const l=T["a"].fromPointNormal(o,r,me),m=p["a"].rayPlane(s,l,ue);Object(c["a"])(m)&&(r=a["a"].subtract(o,m,r),i.mode===C["a"].COLUMBUS_VIEW&&a["a"].fromElements(r.y,r.z,r.x,r),a["a"].add(n.position,r,n.position))}const _e=new a["a"],fe=new s["a"],ge=new a["a"],we=new u["a"],Te=new a["a"],ye=new a["a"];function be(t,e,o){const n=t._scene,s=n.camera,r=t._cameraUnderground;let l,m,d=t._ellipsoid;if(!g["a"].equals(s.transform,g["a"].IDENTITY))return void Pe(t,e,o);const p=d.geodeticSurfaceNormal(s.position,Te);if(i["a"].equals(e,t._rotateMousePosition)){if(t._looking)oo(t,e,o,p);else if(t._rotating)Pe(t,e,o);else if(t._strafing)It(t,o);else{if(a["a"].magnitude(s.position)<a["a"].magnitude(t._rotateStartPosition))return;l=a["a"].magnitude(t._rotateStartPosition),m=ge,m.x=m.y=m.z=l,d=u["a"].fromCartesian3(m,we),Se(t,e,o,d)}return}t._looking=!1,t._rotating=!1,t._strafing=!1;const h=d.cartesianToCartographic(s.positionWC,fe).height,_=t._globe;if(Object(c["a"])(_)&&h<t._minimumPickingTerrainHeight){const n=Pt(t,o.startPosition,pe);if(Object(c["a"])(n)){let c=!1;const p=s.getPickRay(o.startPosition,Tt);if(r)c=!0,vt(t,p,n,n);else{const t=d.geodeticSurfaceNormal(n,ye),e=Math.abs(a["a"].dot(p.direction,t))<.05;c=!!e||a["a"].magnitude(s.position)<a["a"].magnitude(n)}c?(i["a"].clone(e,t._strafeEndMousePosition),a["a"].clone(n,t._strafeStartPosition),t._strafing=!0,he(t,o,t._strafeStartPosition)):(l=a["a"].magnitude(n),m=ge,m.x=m.y=m.z=l,d=u["a"].fromCartesian3(m,we),Se(t,e,o,d),a["a"].clone(n,t._rotateStartPosition))}else t._looking=!0,oo(t,e,o,p)}else Object(c["a"])(s.pickEllipsoid(o.startPosition,t._ellipsoid,_e))?(Se(t,e,o,t._ellipsoid),a["a"].clone(_e,t._rotateStartPosition)):h>t._minimumTrackBallHeight?(t._rotating=!0,Pe(t,e,o)):(t._looking=!0,oo(t,e,o,p));i["a"].clone(e,t._rotateMousePosition)}function Pe(t,e,o,i,n,s){n=Object(r["a"])(n,!1),s=Object(r["a"])(s,!1);const l=t._scene,m=l.camera,u=l.canvas,d=m.constrainedAxis;Object(c["a"])(i)&&(m.constrainedAxis=i);const p=a["a"].magnitude(m.position);let h=t._rotateFactor*(p-t._rotateRateRangeAdjustment);h>t._maximumRotateRate&&(h=t._maximumRotateRate),h<t._minimumRotateRate&&(h=t._minimumRotateRate);let _=(o.startPosition.x-o.endPosition.x)/u.clientWidth,f=(o.startPosition.y-o.endPosition.y)/u.clientHeight;_=Math.min(_,t.maximumMovementRatio),f=Math.min(f,t.maximumMovementRatio);const g=h*_*Math.PI*2,w=h*f*Math.PI;n||m.rotateRight(g),s||m.rotateUp(w),m.constrainedAxis=d}const Ee=n["a"].clone(n["a"].UNIT_W),Me=n["a"].clone(n["a"].UNIT_W),Oe=new a["a"],Re=new a["a"],Ce=new a["a"],ve=new a["a"],xe=new i["a"],Ie=new i["a"];function Se(t,e,o,n){const s=t._scene,r=s.camera,l=i["a"].clone(o.startPosition,xe),m=i["a"].clone(o.endPosition,Ie);let u=r.pickEllipsoid(l,n,Ee),d=r.pickEllipsoid(m,n,Me);if(!Object(c["a"])(u)||!Object(c["a"])(d))return t._rotating=!0,void Pe(t,e,o);if(u=r.worldToCameraCoordinates(u,u),d=r.worldToCameraCoordinates(d,d),Object(c["a"])(r.constrainedAxis)){const t=r.constrainedAxis,e=a["a"].mostOrthogonalAxis(t,Oe);a["a"].cross(e,t,e),a["a"].normalize(e,e);const o=a["a"].cross(t,e,Re),i=a["a"].magnitude(u),n=a["a"].dot(t,u),s=Math.acos(n/i),c=a["a"].multiplyByScalar(t,n,Ce);a["a"].subtract(u,c,c),a["a"].normalize(c,c);const l=a["a"].magnitude(d),m=a["a"].dot(t,d),p=Math.acos(m/l),h=a["a"].multiplyByScalar(t,m,ve);a["a"].subtract(d,h,h),a["a"].normalize(h,h);let f=Math.acos(a["a"].dot(c,e));a["a"].dot(c,o)<0&&(f=_["a"].TWO_PI-f);let g=Math.acos(a["a"].dot(h,e));a["a"].dot(h,o)<0&&(g=_["a"].TWO_PI-g);const w=f-g;let T;T=a["a"].equalsEpsilon(t,r.position,_["a"].EPSILON2)?r.right:a["a"].cross(t,r.position,Oe);const y=a["a"].cross(t,T,Oe),b=a["a"].dot(y,a["a"].subtract(u,t,Re)),P=a["a"].dot(y,a["a"].subtract(d,t,Re));let E;E=b>0&&P>0?p-s:b>0&&P<=0?a["a"].dot(r.position,t)>0?-s-p:s+p:s-p,r.rotateRight(w),r.rotateUp(E)}else{a["a"].normalize(u,u),a["a"].normalize(d,d);const t=a["a"].dot(u,d),e=a["a"].cross(u,d,Oe);if(t<1&&!a["a"].equalsEpsilon(e,a["a"].ZERO,_["a"].EPSILON14)){const o=Math.acos(t);r.rotate(e,o)}}}const je=new a["a"],Ne=new s["a"];function ze(t,e,o){Object(c["a"])(o.distance)&&(o=o.distance);const i=t._ellipsoid,n=t._scene,s=n.camera,r=n.canvas,l=t._cameraUnderground;let m;l?m=e:(m=ae,m.x=r.clientWidth/2,m.y=r.clientHeight/2);const u=s.getPickRay(m,ne);let d;const p=i.cartesianToCartographic(s.position,Ne).height;let h;if(p<t._minimumPickingTerrainHeight&&(d=Pt(t,m,se)),Object(c["a"])(d)&&(h=a["a"].distance(u.origin,d)),l){const e=Rt(t,u,p);h=Object(c["a"])(h)?Math.min(h,e):e}Object(c["a"])(h)||(h=p);const _=a["a"].normalize(s.position,je);ct(t,e,o,t._zoomFactor,h,a["a"].dot(_,s.direction))}const De=new i["a"],Ue=new b["a"],We=new a["a"],Ae=new a["a"],Be=new g["a"],Fe=new g["a"],He=new g["a"],ke=new y["a"],Ve=new f["a"],Ze=new s["a"],Le=new a["a"];function qe(t,e,o){const a=t._scene,n=a.camera;if(!g["a"].equals(n.transform,g["a"].IDENTITY))return;if(Object(c["a"])(o.angleAndHeight)&&(o=o.angleAndHeight),i["a"].equals(e,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){const i=t._ellipsoid.geodeticSurfaceNormal(n.position,Le);return void oo(t,e,o,i)}const s=t._ellipsoid,r=s.cartesianToCartographic(n.position,Ze);t._tiltOnEllipsoid||r.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,Ye(t,e,o)):Qe(t,e,o)}const Ge=new s["a"];function Ye(t,e,o){const n=t._ellipsoid,s=t._scene,r=s.camera,l=.25*t.minimumZoomDistance,m=n.cartesianToCartographic(r.positionWC,Ge).height;if(m-l-1<_["a"].EPSILON3&&o.endPosition.y-o.startPosition.y<0)return;const d=s.canvas,h=De;h.x=d.clientWidth/2,h.y=d.clientHeight/2;const f=r.getPickRay(h,Ue);let w;const T=p["a"].rayEllipsoid(f,n);if(Object(c["a"])(T))w=b["a"].getPoint(f,T.start,We);else{if(!(m>t._minimumTrackBallHeight)){t._looking=!0;const a=t._ellipsoid.geodeticSurfaceNormal(r.position,Le);return oo(t,e,o,a),void i["a"].clone(e,t._tiltCenterMousePosition)}{const t=p["a"].grazingAltitudeLocation(f,n);if(!Object(c["a"])(t))return;const e=n.cartesianToCartographic(t,Ze);e.height=0,w=n.cartographicToCartesian(e,We)}}const y=E["a"].eastNorthUpToFixedFrame(w,n,Be),P=t._globe,M=t._ellipsoid;t._globe=void 0,t._ellipsoid=u["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;const O=g["a"].clone(r.transform,He);r._setTransform(y),Pe(t,e,o,a["a"].UNIT_Z),r._setTransform(O),t._globe=P,t._ellipsoid=M;const R=M.maximumRadius;t._rotateFactor=1/R,t._rotateRateRangeAdjustment=R}function Qe(t,e,o){const n=t._ellipsoid,s=t._scene,r=s.camera,l=t._cameraUnderground;let m,d,h;if(i["a"].equals(e,t._tiltCenterMousePosition))m=a["a"].clone(t._tiltCenter,We);else{if(m=Pt(t,e,We),!Object(c["a"])(m)){if(d=r.getPickRay(e,Ue),h=p["a"].rayEllipsoid(d,n),!Object(c["a"])(h)){const a=n.cartesianToCartographic(r.position,Ze);if(a.height<=t._minimumTrackBallHeight){t._looking=!0;const a=t._ellipsoid.geodeticSurfaceNormal(r.position,Le);oo(t,e,o,a),i["a"].clone(e,t._tiltCenterMousePosition)}return}m=b["a"].getPoint(d,h.start,We)}l&&(Object(c["a"])(d)||(d=r.getPickRay(e,Ue)),Ct(t,d,m,m)),i["a"].clone(e,t._tiltCenterMousePosition),a["a"].clone(m,t._tiltCenter)}const w=s.canvas,T=De;T.x=w.clientWidth/2,T.y=t._tiltCenterMousePosition.y,d=r.getPickRay(T,Ue);const P=a["a"].magnitude(m),M=a["a"].fromElements(P,P,P,ge),O=u["a"].fromCartesian3(M,we);if(h=p["a"].rayEllipsoid(d,O),!Object(c["a"])(h))return;const R=a["a"].magnitude(d.origin)>P?h.start:h.stop,C=b["a"].getPoint(d,R,Ae),v=E["a"].eastNorthUpToFixedFrame(m,n,Be),x=E["a"].eastNorthUpToFixedFrame(C,O,Fe),I=t._globe,S=t._ellipsoid;t._globe=void 0,t._ellipsoid=u["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;let j=a["a"].UNIT_Z;const N=g["a"].clone(r.transform,He);r._setTransform(x);const z=a["a"].cross(C,r.positionWC,te),D=a["a"].dot(r.rightWC,z);if(D<0){const i=o.startPosition.y-o.endPosition.y;(l&&i<0||!l&&i>0)&&(j=void 0);const a=r.constrainedAxis;r.constrainedAxis=void 0,Pe(t,e,o,j,!0,!1),r.constrainedAxis=a}else Pe(t,e,o,j,!0,!1);if(r._setTransform(v),Pe(t,e,o,j,!1,!0),Object(c["a"])(r.constrainedAxis)){const t=a["a"].cross(r.direction,r.constrainedAxis,te);a["a"].equalsEpsilon(t,a["a"].ZERO,_["a"].EPSILON6)||(a["a"].dot(t,r.right)<0&&a["a"].negate(t,t),a["a"].cross(t,r.direction,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].normalize(r.up,r.up),a["a"].normalize(r.right,r.right))}r._setTransform(N),t._globe=I,t._ellipsoid=S;const U=S.maximumRadius;t._rotateFactor=1/U,t._rotateRateRangeAdjustment=U;const W=a["a"].clone(r.positionWC,te);if(t.enableCollisionDetection&&so(t),!a["a"].equals(r.positionWC,W)){r._setTransform(x),r.worldToCameraCoordinatesPoint(W,W);const t=a["a"].magnitudeSquared(W);a["a"].magnitudeSquared(r.position)>t&&(a["a"].normalize(r.position,r.position),a["a"].multiplyByScalar(r.position,Math.sqrt(t),r.position));const e=a["a"].angleBetween(W,r.position),o=a["a"].cross(W,r.position,W);a["a"].normalize(o,o);const i=y["a"].fromAxisAngle(o,e,ke),n=f["a"].fromQuaternion(i,Ve);f["a"].multiplyByVector(n,r.direction,r.direction),f["a"].multiplyByVector(n,r.up,r.up),a["a"].cross(r.direction,r.up,r.right),a["a"].cross(r.right,r.direction,r.up),r._setTransform(N)}}const Xe=new i["a"],Je=new i["a"],Ke=new b["a"],$e=new b["a"],to=new a["a"],eo=new a["a"];function oo(t,e,o,i){const n=t._scene,s=n.camera,l=Xe;l.x=o.startPosition.x,l.y=0;const m=Je;m.x=o.endPosition.x,m.y=0;let u,d,p=s.getPickRay(l,Ke),h=s.getPickRay(m,$e),f=0;s.frustum instanceof w["a"]?(u=p.origin,d=h.origin,a["a"].add(s.direction,u,u),a["a"].add(s.direction,d,d),a["a"].subtract(u,s.position,u),a["a"].subtract(d,s.position,d),a["a"].normalize(u,u),a["a"].normalize(d,d)):(u=p.direction,d=h.direction);let g=a["a"].dot(u,d);g<1&&(f=Math.acos(g)),f=o.startPosition.x>o.endPosition.x?-f:f;const T=t._horizontalRotationAxis;if(Object(c["a"])(i)?s.look(i,-f):Object(c["a"])(T)?s.look(T,-f):s.lookLeft(f),l.x=0,l.y=o.startPosition.y,m.x=0,m.y=o.endPosition.y,p=s.getPickRay(l,Ke),h=s.getPickRay(m,$e),f=0,s.frustum instanceof w["a"]?(u=p.origin,d=h.origin,a["a"].add(s.direction,u,u),a["a"].add(s.direction,d,d),a["a"].subtract(u,s.position,u),a["a"].subtract(d,s.position,d),a["a"].normalize(u,u),a["a"].normalize(d,d)):(u=p.direction,d=h.direction),g=a["a"].dot(u,d),g<1&&(f=Math.acos(g)),f=o.startPosition.y>o.endPosition.y?-f:f,i=Object(r["a"])(i,T),Object(c["a"])(i)){const t=s.direction,e=a["a"].negate(i,to),o=a["a"].equalsEpsilon(t,i,_["a"].EPSILON2),n=a["a"].equalsEpsilon(t,e,_["a"].EPSILON2);if(o||n)(o&&f<0||n&&f>0)&&s.look(s.right,-f);else{g=a["a"].dot(t,i);let o=_["a"].acosClamped(g);f>0&&f>o&&(f=o-_["a"].EPSILON4),g=a["a"].dot(t,e),o=_["a"].acosClamped(g),f<0&&-f>o&&(f=-o+_["a"].EPSILON4);const n=a["a"].cross(i,t,eo);s.look(n,f)}}else s.lookUp(f)}function io(t){W(t,t.enableRotate,t.rotateEventTypes,be,t.inertiaSpin,"_lastInertiaSpinMovement"),W(t,t.enableZoom,t.zoomEventTypes,ze,t.inertiaZoom,"_lastInertiaZoomMovement"),W(t,t.enableTilt,t.tiltEventTypes,qe,t.inertiaSpin,"_lastInertiaTiltMovement"),W(t,t.enableLook,t.lookEventTypes,oo)}const ao=new g["a"],no=new s["a"];function so(t){t._adjustedHeightForTerrain=!0;const e=t._scene,o=e.mode,i=e.globe;if(!Object(c["a"])(i)||o===C["a"].SCENE2D||o===C["a"].MORPHING)return;const n=e.camera,s=i.ellipsoid,r=e.mapProjection;let l,m;g["a"].equals(n.transform,g["a"].IDENTITY)||(l=g["a"].clone(n.transform,ao),m=a["a"].magnitude(n.position),n._setTransform(g["a"].IDENTITY));const u=no;o===C["a"].SCENE3D?s.cartesianToCartographic(n.position,u):r.unproject(n.position,u);let d=!1;if(u.height<t._minimumCollisionTerrainHeight){const e=t._scene.globeHeight;if(Object(c["a"])(e)){const i=e+t.minimumZoomDistance;u.height<i&&(u.height=i,o===C["a"].SCENE3D?s.cartographicToCartesian(u,n.position):r.project(u,n.position),d=!0)}}Object(c["a"])(l)&&(n._setTransform(l),d&&(a["a"].normalize(n.position,n.position),a["a"].negate(n.position,n.direction),a["a"].multiplyByScalar(n.position,Math.max(m,t.minimumZoomDistance),n.position),a["a"].normalize(n.direction,n.direction),a["a"].cross(n.direction,n.up,n.right),a["a"].cross(n.right,n.direction,n.up)))}I.prototype.onMap=function(){const t=this._scene,e=t.mode,o=t.camera;return e!==C["a"].COLUMBUS_VIEW||Math.abs(o.position.x)-this._maxCoord.x<0&&Math.abs(o.position.y)-this._maxCoord.y<0};const ro=new a["a"],co=new a["a"];I.prototype.update=function(){const t=this._scene,e=t.camera,o=t.globe,i=t.mode;g["a"].equals(e.transform,g["a"].IDENTITY)?(this._globe=o,this._ellipsoid=Object(c["a"])(this._globe)?this._globe.ellipsoid:t.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=u["a"].UNIT_SPHERE);const n=Object(c["a"])(this._globe)?this._globe.terrainExaggeration:1,s=Object(c["a"])(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=P["a"].getHeight(this.minimumCollisionTerrainHeight,n,s),this._minimumPickingTerrainHeight=P["a"].getHeight(this.minimumPickingTerrainHeight,n,s),this._minimumTrackBallHeight=P["a"].getHeight(this.minimumTrackBallHeight,n,s),this._cameraUnderground=t.cameraUnderground&&Object(c["a"])(this._globe);const r=this._ellipsoid.maximumRadius;this._rotateFactor=1/r,this._rotateRateRangeAdjustment=r,this._adjustedHeightForTerrain=!1;const l=a["a"].clone(e.positionWC,ro),m=a["a"].clone(e.directionWC,co);if(i===C["a"].SCENE2D?wt(this):i===C["a"].COLUMBUS_VIEW?(this._horizontalRotationAxis=a["a"].UNIT_Z,ce(this)):i===C["a"].SCENE3D&&(this._horizontalRotationAxis=void 0,io(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){const t=!a["a"].equals(l,e.positionWC)||!a["a"].equals(m,e.directionWC);t&&so(this)}this._aggregator.reset()},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(l["a"])(this)},e["a"]=I},dc6c:function(t,e,o){"use strict";const i={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(t){return t===i.SCENE3D?1:t!==i.MORPHING?0:void 0}};e["a"]=Object.freeze(i)}}]);