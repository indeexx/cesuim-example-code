(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors~e21f3e4f"],{"37ce":function(t,e,n){"use strict";var a=n("cbf0"),i=n("1a5d"),r=n("c937"),o=n("1197"),s=n("6f54"),d=n("6ba7"),_=n("7c8c"),T=n("5f79"),u=n("afe9"),I=n("8b16"),c=n("216b");const S={};function E(t){t.addStruct(S.STRUCT_ID_FEATURE_IDS_VS,S.STRUCT_NAME_FEATURE_IDS,o["a"].VERTEX),t.addStruct(S.STRUCT_ID_FEATURE_IDS_FS,S.STRUCT_NAME_FEATURE_IDS,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,o["a"].VERTEX),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,o["a"].VERTEX),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,S.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,o["a"].VERTEX)}function l(t,e,n){const a=e.featureIds,i=e.attributes[0].count;for(let s=0;s<a.length;s++){const e=a[s],d=e.positionalLabel;if(e instanceof u["a"].FeatureIdAttribute)N(t,e,d);else{const a=1;F(t,e,d,i,a,n)}const _=e.label;Object(r["a"])(_)&&R(t,d,_,o["a"].BOTH)}}function A(t,e,n){const a=e.featureIds,i=_["a"].getAttributeBySemantic(e,T["a"].POSITION),s=i.count;for(let d=0;d<a.length;d++){const e=a[d],i=e.positionalLabel;let _=o["a"].BOTH;e instanceof u["a"].FeatureIdAttribute?f(t,e,i):e instanceof u["a"].FeatureIdImplicitRange?F(t,e,i,s,void 0,n):(U(t,e,i,d,n),_=o["a"].FRAGMENT);const T=e.label;Object(r["a"])(T)&&R(t,i,T,_)}}function N(t,e,n){const a=t.shaderBuilder;a.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",n),a.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",n);const i=e.setIndex,r=n.replace(/_\d+$/,"_"),o=`a_${r}${i}`,s=`v_${r}${i}`,d=`featureIds.${n} = int(czm_round(${o}));`,_=`featureIds.${n} = int(czm_round(${s}));`;a.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[d]),a.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[_]),a.addVarying("float",s),a.addFunctionLines(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${s} = ${o};`])}function f(t,e,n){const a=t.shaderBuilder;a.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",n),a.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",n);const i=e.setIndex,r=n.replace(/_\d+$/,"_"),o=[`featureIds.${n} = int(czm_round(attributes.${r}${i}));`];a.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,o),a.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,o)}function F(t,e,n,a,i,r){C(t,e,a,i,r);const o=t.shaderBuilder,s="a_implicit_"+n;o.addAttribute("float",s);const d="v_implicit_"+n;o.addVarying("float",d),o.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",n),o.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",n),o.addFunctionLines(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${d} = ${s};`]),o.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${n} = int(czm_round(${s}));`]),o.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${n} = int(czm_round(${d}));`])}function U(t,e,n,a,r){const s="u_featureIdTexture_"+a,d=t.uniformMap,_=e.textureReader;d[s]=function(){return Object(i["a"])(_.texture,r.context.defaultTexture)};const T=_.channels,u=t.shaderBuilder;u.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",n),u.addUniform("sampler2D",s,o["a"].FRAGMENT);const I="v_texCoord_"+_.texCoord,c=`texture2D(${s}, ${I}).${T}`,E=`featureIds.${n} = czm_unpackUint(${c});`;u.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[E])}function R(t,e,n,a){const i=t.shaderBuilder,r=o["a"].includesVertexShader(a);r&&i.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",n),i.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",n);const s=[`featureIds.${n} = featureIds.${e};`];r&&i.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,s),i.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,s)}function C(t,e,n,i,o){const _=t.model;let T,u;if(Object(r["a"])(e.repeat)){const t=b(e,n);T=s["a"].createVertexBuffer({context:o.context,typedArray:t,usage:d["a"].STATIC_DRAW}),T.vertexArrayDestroyable=!1,_._resources.push(T)}else u=[e.offset];const I={index:t.attributeIndex++,instanceDivisor:i,value:u,vertexBuffer:T,normalize:!1,componentsPerAttribute:1,componentDatatype:a["a"].FLOAT,strideInBytes:a["a"].getSizeInBytes(a["a"].FLOAT),offsetInBytes:0};t.attributes.push(I)}function b(t,e){const n=t.offset,a=t.repeat,i=new Float32Array(e);for(let r=0;r<e;r++)i[r]=n+Math.floor(r/a);return i}S.name="FeatureIdPipelineStage",S.STRUCT_ID_FEATURE_IDS_VS="FeatureIdsVS",S.STRUCT_ID_FEATURE_IDS_FS="FeatureIdsFS",S.STRUCT_NAME_FEATURE_IDS="FeatureIds",S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS="initializeFeatureIdsVS",S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS="initializeFeatureIdsFS",S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS="initializeFeatureIdAliasesVS",S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS="initializeFeatureIdAliasesFS",S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS="void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)",S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES="void initializeFeatureIdAliases(inout FeatureIds featureIds)",S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS="setFeatureIdVaryings",S.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS="void setFeatureIdVaryings()",S.process=function(t,e,n){const a=t.shaderBuilder;E(a);const i=t.runtimeNode.node.instances;Object(r["a"])(i)&&l(t,i,n),A(t,e,n),a.addVertexLines([c["a"]]),a.addFragmentLines([I["a"]])},e["a"]=S},"3a30d":function(t,e,n){"use strict";var a=n("c937"),i=n("6b82"),r=n("1197"),o=n("7c8c");const s={};function d(t,e){const n=t.shaderBuilder,a=t.uniformMap,i=e.variableName,o=e.attribute.quantization;if(o.octEncoded){const t="model_normalizationRange_"+i;n.addUniform("float",t,r["a"].VERTEX),a[t]=function(){return o.normalizationRange}}else{const t="model_quantizedVolumeOffset_"+i,s="model_quantizedVolumeStepSize_"+i,d=e.glslType;n.addUniform(d,t,r["a"].VERTEX),n.addUniform(d,s,r["a"].VERTEX);let T=o.quantizedVolumeOffset,u=o.quantizedVolumeStepSize;/^color_\d+$/.test(i)&&(T=_(T,0),u=_(u,1)),a[t]=function(){return T},a[s]=function(){return u}}}function _(t,e){return t instanceof i["a"]?t:new i["a"](t.x,t.y,t.z,e)}function T(t,e){const n=e.variableName,a=e.attribute.quantization;let i;i=a.octEncoded?u(n,a):I(n),t.addFunctionLines(s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[i])}function u(t,e){const n="attributes."+t,a="a_quantized_"+t,i="model_normalizationRange_"+t,r=e.octEncodedZXY?".zxy":".xyz";return`${n} = czm_octDecode(${a}, ${i})${r};`}function I(t){const e="attributes."+t,n="a_quantized_"+t,a="model_quantizedVolumeOffset_"+t,i="model_quantizedVolumeStepSize_"+t;return`${e} = ${a} + ${n} * ${i};`}s.name="DequantizationPipelineStage",s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS="dequantizationStage",s.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS="void dequantizationStage(inout ProcessedAttributes attributes)",s.process=function(t,e){const n=t.shaderBuilder;n.addFunction(s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,s.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,r["a"].VERTEX),n.addDefine("USE_DEQUANTIZATION",void 0,r["a"].VERTEX);const i=e.attributes;for(let r=0;r<i.length;r++){const e=i[r],s=e.quantization;if(!Object(a["a"])(s))continue;const _=o["a"].getAttributeInfo(e);T(n,_),d(t,_)}},e["a"]=s},"53fc":function(t,e,n){"use strict";var a=n("2fad"),i=n("1a5d");const r={name:"BatchTexturePipelineStage",process:function(t,e,n){const r=t.shaderBuilder,o={},s=t.model,d=s.featureTables[s.featureTableId],_=d.featuresLength;r.addUniform("int","model_featuresLength"),o.model_featuresLength=function(){return _};const T=d.batchTexture;r.addUniform("sampler2D","model_batchTexture"),o.model_batchTexture=function(){return Object(i["a"])(T.batchTexture,T.defaultTexture)},r.addUniform("vec4","model_textureStep"),o.model_textureStep=function(){return T.textureStep},T.textureDimensions.y>1&&(r.addDefine("MULTILINE_BATCH_TEXTURE"),r.addUniform("vec2","model_textureDimensions"),o.model_textureDimensions=function(){return T.textureDimensions}),t.uniformMap=Object(a["a"])(o,t.uniformMap)}};e["a"]=r},"84d0":function(t,e,n){"use strict";const a={MODIFY_MATERIAL:"MODIFY_MATERIAL",REPLACE_MATERIAL:"REPLACE_MATERIAL",getDefineName:function(t){return"CUSTOM_SHADER_"+t}};e["a"]=Object.freeze(a)},8693:function(t,e,n){"use strict";var a=n("ae9b"),i=n("1a5d"),r=n("c937"),o=n("21b7"),s=n("e2a6"),d=n("84d0"),_=n("3eda"),T=n("7f683");function u(t){t=Object(i["a"])(t,i["a"].EMPTY_OBJECT),this.mode=Object(i["a"])(t.mode,d["a"].MODIFY_MATERIAL),this.lightingModel=t.lightingModel,this.uniforms=Object(i["a"])(t.uniforms,i["a"].EMPTY_OBJECT),this.varyings=Object(i["a"])(t.varyings,i["a"].EMPTY_OBJECT),this.vertexShaderText=t.vertexShaderText,this.fragmentShaderText=t.fragmentShaderText,this.isTranslucent=Object(i["a"])(t.isTranslucent,!1),this._textureManager=new T["a"],this._defaultTexture=void 0,this.uniformMap=I(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},l(this),f(this)}function I(t){const e=t.uniforms,n={};for(const a in e)if(e.hasOwnProperty(a)){const i=e[a],r=i.type;if(r===_["a"].SAMPLER_CUBE)throw new s["a"]("CustomShader does not support samplerCube uniforms");r===_["a"].SAMPLER_2D?(t._textureManager.loadTexture2D(a,i.value),n[a]=c(t,a)):n[a]=S(t,a)}return n}function c(t,e){return function(){return Object(i["a"])(t._textureManager.getTexture(e),t._defaultTexture)}}function S(t,e){return function(){return t.uniforms[e].value}}function E(t,e,n){let a;while(null!==(a=e.exec(t))){const t=a[1];n[t]=!0}}function l(t){const e=/[vf]sInput\.attributes\.(\w+)/g,n=/[vf]sInput\.featureIds\.(\w+)/g,a=/[vf]sInput\.metadata.(\w+)/g;let i;const o=t.vertexShaderText;Object(r["a"])(o)&&(i=t.usedVariablesVertex.attributeSet,E(o,e,i),i=t.usedVariablesVertex.featureIdSet,E(o,n,i),i=t.usedVariablesVertex.metadataSet,E(o,a,i));const s=t.fragmentShaderText;if(Object(r["a"])(s)){i=t.usedVariablesFragment.attributeSet,E(s,e,i),i=t.usedVariablesFragment.featureIdSet,E(s,n,i),i=t.usedVariablesFragment.metadataSet,E(s,a,i);const r=/material\.(\w+)/g,o=t.usedVariablesFragment.materialSet;E(s,r,o)}}function A(t){const e=/^.*MC$/,n=/^.*WC$/,a=/^.*EC$/;return e.test(t)?t+" (model coordinates)":n.test(t)?t+" (Cartesian world coordinates)":a.test(t)?t+" (eye coordinates)":t}function N(t,e,n,a){if(t.hasOwnProperty(e)){const t=`${A(e)} is not available in the ${a} shader. Did you mean ${A(n)} instead?`;throw new s["a"](t)}}function f(t){const e=t.usedVariablesVertex.attributeSet;N(e,"position","positionMC","vertex"),N(e,"normal","normalMC","vertex"),N(e,"tangent","tangentMC","vertex"),N(e,"bitangent","bitangentMC","vertex"),N(e,"positionWC","positionMC","vertex"),N(e,"positionEC","positionMC","vertex"),N(e,"normalEC","normalMC","vertex"),N(e,"tangentEC","tangentMC","vertex"),N(e,"bitangentEC","bitangentMC","vertex");const n=t.usedVariablesFragment.attributeSet;N(n,"position","positionEC","fragment"),N(n,"normal","normalEC","fragment"),N(n,"tangent","tangentEC","fragment"),N(n,"bitangent","bitangentEC","fragment"),N(n,"normalMC","normalEC","fragment"),N(n,"tangentMC","tangentEC","fragment"),N(n,"bitangentMC","bitangentEC","fragment")}u.prototype.setUniform=function(t,e){if(a["a"].typeOf.string("uniformName",t),a["a"].defined("value",e),!Object(r["a"])(this.uniforms[t]))throw new s["a"](`Uniform ${t} must be declared in the CustomShader constructor.`);const n=this.uniforms[t];n.type===_["a"].SAMPLER_2D?this._textureManager.loadTexture2D(t,e):Object(r["a"])(e.clone)?n.value=e.clone(n.value):n.value=e},u.prototype.update=function(t){this._defaultTexture=t.context.defaultTexture,this._textureManager.update(t)},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),Object(o["a"])(this)}},8771:function(t,e,n){"use strict";var a=n("c937"),i=n("cbf0"),r=n("82ba"),o=n("c380"),s=n("5f79"),d=n("fc7a"),_=n("ecdb"),T=n("9206"),u=n("1197"),I=n("7c8c"),c=n("8676");const S={};function E(t,e,n,i){const r=t.shaderBuilder,o=I["a"].getAttributeInfo(e);i>1?N(t,e,n,i):A(t,e,n),F(r,o),f(r,o),Object(a["a"])(e.semantic)&&l(r,e),U(r,o),R(r,o),C(r,o)}function l(t,e){const n=e.semantic,a=e.setIndex;switch(n){case s["a"].NORMAL:t.addDefine("HAS_NORMALS");break;case s["a"].TANGENT:t.addDefine("HAS_TANGENTS");break;case s["a"].FEATURE_ID:t.addDefine(`HAS${n}_${a}`);break;case s["a"].TEXCOORD:case s["a"].COLOR:t.addDefine(`HAS_${n}_${a}`)}}function A(t,e,n){const i=e.quantization;let r,d;Object(a["a"])(i)?(r=i.type,d=i.componentDatatype):(r=e.type,d=e.componentDatatype);const _=e.semantic,T=e.setIndex;_===s["a"].FEATURE_ID&&T>=t.featureIdVertexAttributeSetIndex&&(t.featureIdVertexAttributeSetIndex=T+1);const u={index:n,value:Object(a["a"])(e.buffer)?void 0:e.constant,vertexBuffer:e.buffer,componentsPerAttribute:o["a"].getNumberOfComponents(r),componentDatatype:d,offsetInBytes:e.byteOffset,strideInBytes:e.byteStride,normalize:e.normalized};t.attributes.push(u)}function N(t,e,n,r){const s=e.quantization;let d,_;Object(a["a"])(s)?(d=s.type,_=s.componentDatatype):(d=e.type,_=e.componentDatatype);const T=e.normalized,u=o["a"].getNumberOfComponents(d),I=u/r,c=i["a"].getSizeInBytes(_),S=I*c,E=e.byteStride;for(let a=0;a<r;a++){const i=e.byteOffset+a*S,r={index:n+a,vertexBuffer:e.buffer,componentsPerAttribute:I,componentDatatype:_,offsetInBytes:i,strideInBytes:E,normalize:T};t.attributes.push(r)}}function f(t,e){const n=e.variableName;let a,i="v_"+n;"normalMC"===n?(i="v_normalEC",a=e.glslType):"tangentMC"===n?(a="vec3",i="v_tangentEC"):a=e.glslType,t.addVarying(a,i)}function F(t,e){const n=e.attribute.semantic,a=e.variableName;let i,r;e.isQuantized?(i="a_quantized_"+a,r=e.quantizedGlslType):(i="a_"+a,r=e.glslType),n===s["a"].POSITION?t.setPositionAttribute(r,i):t.addAttribute(r,i)}function U(t,e){const n=S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,a=S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,i=e.variableName;"tangentMC"===i?(t.addStructField(n,"vec3","tangentMC"),t.addStructField(a,"vec3","tangentEC")):"normalMC"===i?(t.addStructField(n,"vec3","normalMC"),t.addStructField(a,"vec3","normalEC")):(t.addStructField(n,e.glslType,i),t.addStructField(a,e.glslType,i))}function R(t,e){if(e.isQuantized)return;const n=S.FUNCTION_ID_INITIALIZE_ATTRIBUTES,a=e.variableName;let i;i="tangentMC"===a?"attributes.tangentMC = a_tangentMC.xyz;":`attributes.${a} = a_${a};`,t.addFunctionLines(n,[i])}function C(t,e){const n=e.attribute.semantic,i=e.attribute.setIndex;if(Object(a["a"])(n)&&!Object(a["a"])(i))return;let r=S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS;const o=e.variableName;let s=`v_${o} = attributes.${o};`;t.addFunctionLines(r,[s]),r=S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,s=`attributes.${o} = v_${o};`,t.addFunctionLines(r,[s])}function b(t,e){let n=!1,a=!1;for(let i=0;i<e.length;i++){const t=e[i];t.semantic===s["a"].NORMAL?n=!0:t.semantic===s["a"].TANGENT&&(a=!0)}n&&a&&(t.addDefine("HAS_BITANGENTS"),t.addFunctionLines(S.FUNCTION_ID_INITIALIZE_ATTRIBUTES,["attributes.bitangentMC = normalize(cross(a_normalMC, a_tangentMC.xyz) * a_tangentMC.w);"]),t.addVarying("vec3","v_bitangentEC"),t.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"vec3","bitangentMC"),t.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","bitangentEC"))}S.name="GeometryPipelineStage",S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS="ProcessedAttributesVS",S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS="ProcessedAttributesFS",S.STRUCT_NAME_PROCESSED_ATTRIBUTES="ProcessedAttributes",S.FUNCTION_ID_INITIALIZE_ATTRIBUTES="initializeAttributes",S.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES="void initializeAttributes(out ProcessedAttributes attributes)",S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS="setDynamicVaryingsVS",S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS="setDynamicVaryingsFS",S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS="void setDynamicVaryings(inout ProcessedAttributes attributes)",S.process=function(t,e){const n=t.shaderBuilder;n.addStruct(S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"ProcessedAttributes",u["a"].VERTEX),n.addStruct(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"ProcessedAttributes",u["a"].FRAGMENT),n.addStruct(T["a"].STRUCT_ID_SELECTED_FEATURE,T["a"].STRUCT_NAME_SELECTED_FEATURE,u["a"].BOTH),n.addFunction(S.FUNCTION_ID_INITIALIZE_ATTRIBUTES,S.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES,u["a"].VERTEX),n.addVarying("vec3","v_positionWC"),n.addVarying("vec3","v_positionEC"),n.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionWC"),n.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionEC"),n.addFunction(S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,u["a"].VERTEX),n.addFunction(S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,u["a"].FRAGMENT);const a=t.model.type;a===c["a"].TILE_PNTS&&n.addDefine("HAS_SRGB_COLOR",void 0,u["a"].FRAGMENT);for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],a=o["a"].getAttributeLocationCount(n.type);let r;a>1?(r=t.attributeIndex,t.attributeIndex+=a):r=n.semantic===s["a"].POSITION?0:t.attributeIndex++,E(t,n,r,a)}b(n,e.attributes),e.primitiveType===r["a"].POINTS&&n.addDefine("PRIMITIVE_TYPE_POINTS"),n.addVertexLines([_["a"]]),n.addFragmentLines([d["a"]])},e["a"]=S},"915b":function(t,e,n){"use strict";var a=n("2fad"),i=n("c937"),r=n("e47d"),o=n("1197"),s=n("51f2"),d=n("2b2b"),_=n("99c2"),T=n("8574"),u=n("84d0"),I=n("37ce"),c=n("cf18"),S=n("7c8c");const E={};function l(t){const e={};for(let n=0;n<t.length;n++){const a=t[n],i=S["a"].getAttributeInfo(a);e[i.variableName]=i}return e}E.name="CustomShaderPipelineStage",E.STRUCT_ID_ATTRIBUTES_VS="AttributesVS",E.STRUCT_ID_ATTRIBUTES_FS="AttributesFS",E.STRUCT_NAME_ATTRIBUTES="Attributes",E.STRUCT_ID_VERTEX_INPUT="VertexInput",E.STRUCT_NAME_VERTEX_INPUT="VertexInput",E.STRUCT_ID_FRAGMENT_INPUT="FragmentInput",E.STRUCT_NAME_FRAGMENT_INPUT="FragmentInput",E.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS="initializeInputStructVS",E.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS="void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)",E.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS="initializeInputStructFS",E.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS="void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)",E.process=function(t,e,n){const r=t.shaderBuilder,d=t.model.customShader;Object(i["a"])(d.lightingModel)&&(t.lightingOptions.lightingModel=d.lightingModel);const _=t.alphaOptions;d.isTranslucent?(_.pass=s["a"].TRANSLUCENT,_.alphaMode=T["a"].BLEND):(_.pass=void 0,_.alphaMode=T["a"].OPAQUE);const I=m(d,e);if(!I.customShaderEnabled)return;if(O(r,d,I),I.shouldComputePositionWC&&r.addDefine("COMPUTE_POSITION_WC",void 0,o["a"].BOTH),Object(i["a"])(d.vertexShaderText)&&r.addDefine("HAS_CUSTOM_VERTEX_SHADER",void 0,o["a"].VERTEX),Object(i["a"])(d.fragmentShaderText)){r.addDefine("HAS_CUSTOM_FRAGMENT_SHADER",void 0,o["a"].FRAGMENT);const t=u["a"].getDefineName(d.mode);r.addDefine(t,void 0,o["a"].FRAGMENT)}const c=d.uniforms;for(const a in c)if(c.hasOwnProperty(a)){const t=c[a];r.addUniform(t.type,a)}const S=d.varyings;for(const a in S)if(S.hasOwnProperty(a)){const t=S[a];r.addVarying(t,a)}t.uniformMap=Object(a["a"])(t.uniformMap,d.uniformMap)};const A={position:"vec3",normal:"vec3",tangent:"vec3",bitangent:"vec3",texCoord:"vec2",color:"vec4",joints:"ivec4",weights:"vec4"},N={position:"vec3(0.0)",normal:"vec3(0.0, 0.0, 1.0)",tangent:"vec3(1.0, 0.0, 0.0)",bitangent:"vec3(0.0, 1.0, 0.0)",texCoord:"vec2(0.0)",color:"vec4(1.0)",joints:"ivec4(0)",weights:"vec4(0.0)"};function f(t){let e=t.replace(/_[0-9]+$/,"");e=e.replace(/(MC|EC)$/,"");const n=A[e],a=N[e];if(Object(i["a"])(n))return{attributeField:[n,t],value:a}}function F(t,e,n){const a=b(e,t.usedVariablesVertex.attributeSet,!1),r=a.addToShader,o=a.missingAttributes;let s,d;const _=[],T=[];for(s in r)if(r.hasOwnProperty(s)){const t=r[s],e=[t.glslType,s];_.push(e),d=`vsInput.attributes.${s} = attributes.${s};`,T.push(d)}for(let u=0;u<o.length;u++){s=o[u];const t=f(s);if(!Object(i["a"])(t))return void E._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveVS",`Primitive is missing attribute ${s}, disabling custom vertex shader`);_.push(t.attributeField),d=`vsInput.attributes.${s} = ${t.value};`,T.push(d)}n.enabled=!0,n.attributeFields=_,n.initializationLines=T}function U(t){const e=[],n=[],a=t.usedVariablesFragment.attributeSet;return a.hasOwnProperty("positionWC")&&(e.push(["vec3","positionWC"]),n.push("fsInput.attributes.positionWC = attributes.positionWC;")),a.hasOwnProperty("positionEC")&&(e.push(["vec3","positionEC"]),n.push("fsInput.attributes.positionEC = attributes.positionEC;")),{attributeFields:e,initializationLines:n}}function R(t,e,n){const a=b(e,t.usedVariablesFragment.attributeSet,!0),r=a.addToShader,o=a.missingAttributes;let s,d;const _=[],T=[];for(s in r)if(r.hasOwnProperty(s)){const t=r[s],e=[t.glslType,s];_.push(e),d=`fsInput.attributes.${s} = attributes.${s};`,T.push(d)}for(let I=0;I<o.length;I++){s=o[I];const t=f(s);if(!Object(i["a"])(t))return void E._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveFS",`Primitive is missing attribute ${s}, disabling custom fragment shader.`);_.push(t.attributeField),d=`fsInput.attributes.${s} = ${t.value};`,T.push(d)}const u=U(t);n.enabled=!0,n.attributeFields=_.concat(u.attributeFields),n.initializationLines=u.initializationLines.concat(T)}const C={positionWC:!0,positionEC:!0};function b(t,e,n){let a,i;const r={};for(i in t)if(t.hasOwnProperty(i)){const o=t[i];a=i,n&&"normalMC"===i?a="normalEC":n&&"tangentMC"===i&&(a="tangentEC"),e.hasOwnProperty(a)&&(r[a]=o)}const o=[];for(i in e)if(e.hasOwnProperty(i)){if(C.hasOwnProperty(i))continue;a=i,n&&"normalEC"===i?a="normalMC":n&&"tangentEC"===i&&(a="tangentMC"),t.hasOwnProperty(a)||o.push(i)}return{addToShader:r,missingAttributes:o}}function m(t,e){const n={enabled:!1},a={enabled:!1},r=l(e.attributes);Object(i["a"])(t.vertexShaderText)&&F(t,r,n),Object(i["a"])(t.fragmentShaderText)&&R(t,r,a);const o=t.usedVariablesFragment.attributeSet,s=o.hasOwnProperty("positionWC")&&a.enabled;return{vertexLines:n,fragmentLines:a,vertexLinesEnabled:n.enabled,fragmentLinesEnabled:a.enabled,customShaderEnabled:n.enabled||a.enabled,shouldComputePositionWC:s}}function D(t,e){let n,a=E.STRUCT_ID_ATTRIBUTES_VS;t.addStruct(a,E.STRUCT_NAME_ATTRIBUTES,o["a"].VERTEX);const i=e.attributeFields;for(n=0;n<i.length;n++){const e=i[n],r=e[0],o=e[1];t.addStructField(a,r,o)}a=E.STRUCT_ID_VERTEX_INPUT,t.addStruct(a,E.STRUCT_NAME_VERTEX_INPUT,o["a"].VERTEX),t.addStructField(a,E.STRUCT_NAME_ATTRIBUTES,"attributes"),t.addStructField(a,I["a"].STRUCT_NAME_FEATURE_IDS,"featureIds"),t.addStructField(a,c["a"].STRUCT_NAME_METADATA,"metadata");const r=E.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;t.addFunction(r,E.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,o["a"].VERTEX);const s=e.initializationLines;t.addFunctionLines(r,s)}function p(t,e){let n,a,i,r,s=E.STRUCT_ID_ATTRIBUTES_FS;t.addStruct(s,E.STRUCT_NAME_ATTRIBUTES,o["a"].FRAGMENT);const d=e.attributeFields;for(n=0;n<d.length;n++)a=d[n],i=a[0],r=a[1],t.addStructField(s,i,r);s=E.STRUCT_ID_FRAGMENT_INPUT,t.addStruct(s,E.STRUCT_NAME_FRAGMENT_INPUT,o["a"].FRAGMENT),t.addStructField(s,E.STRUCT_NAME_ATTRIBUTES,"attributes"),t.addStructField(s,I["a"].STRUCT_NAME_FEATURE_IDS,"featureIds"),t.addStructField(s,c["a"].STRUCT_NAME_METADATA,"metadata");const _=E.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;t.addFunction(_,E.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,o["a"].FRAGMENT);const T=e.initializationLines;t.addFunctionLines(_,T)}function O(t,e,n){const a=n.vertexLines;a.enabled&&(D(t,a),t.addVertexLines(["#line 0",e.vertexShaderText,d["a"]]));const i=n.fragmentLines;i.enabled&&(p(t,i),t.addFragmentLines(["#line 0",e.fragmentShaderText,_["a"]]))}E._oneTimeWarning=r["a"],e["a"]=E},de2e:function(t,e,n){"use strict";var a=n("b54c"),i=n("9f09"),r=n("51f2"),o=n("ce1c"),s=n("1197"),d=n("3c3d"),_=n("df33"),T=n("8574"),u=n("c937");const I={name:"CPUStylingPipelineStage",process:function(t,e,n){const I=t.model,c=t.shaderBuilder;c.addVertexLines([a["a"]]),c.addFragmentLines([i["a"]]),c.addDefine("USE_CPU_STYLING",void 0,s["a"].BOTH),Object(u["a"])(I.color)||(c.addUniform("float",_["a"].COLOR_BLEND_UNIFORM_NAME,s["a"].FRAGMENT),t.uniformMap[_["a"].COLOR_BLEND_UNIFORM_NAME]=function(){return o["a"].getColorBlend(I.colorBlendMode,I.colorBlendAmount)}),c.addUniform("bool","model_commandTranslucent",s["a"].BOTH),t.uniformMap.model_commandTranslucent=function(){return t.alphaOptions.pass===r["a"].TRANSLUCENT};const S=I.featureTables[I.featureTableId],E=d["a"].getStyleCommandsNeeded(S.featuresLength,S.batchTexture.translucentFeaturesLength);E!==d["a"].ALL_OPAQUE&&(t.alphaOptions.alphaMode=T["a"].BLEND),t.styleCommandsNeeded=E}};e["a"]=I}}]);