(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors~885ee3c9"],{c66a:function(e,t,a){"use strict";var r=a("6af0"),n=a("4051"),o=a("c937"),s=a("21b7"),u=a("0238"),i=a("cedf"),c=a("a3c8"),d=a("d5cf"),m=a("66fd"),l=a("1494"),h=a("5027"),_=a("b3ce"),p=a("1a75"),f=a("1894"),C=a("215e"),g=a("dc3b"),T=a("c294");function S(e){this._numSamples=1,this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;const t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=new m["a"]({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._alphaFBO=new m["a"]({createColorAttachments:!1,createDepthAttachments:!1,depth:!0}),this._adjustTranslucentFBO=new m["a"]({colorAttachmentsLength:this._translucentMRTSupport?2:1,createColorAttachments:!1}),this._adjustAlphaFBO=new m["a"]({createColorAttachments:!1}),this._opaqueClearCommand=new c["a"]({color:new n["a"](0,0,0,0),owner:this}),this._translucentMRTClearCommand=new c["a"]({color:new n["a"](0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new c["a"]({color:new n["a"](0,0,0,0),owner:this}),this._alphaClearCommand=new c["a"]({color:new n["a"](1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new r["a"],this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function O(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function w(e){e._translucentFBO.destroy(),e._alphaFBO.destroy(),e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO.destroy()}function b(e){O(e),w(e)}function x(e,t,a,r){O(e),e._accumulationTexture=new p["a"]({context:t,width:a,height:r,pixelFormat:u["a"].RGBA,pixelDatatype:l["a"].FLOAT});const n=new Float32Array(a*r*4);e._revealageTexture=new p["a"]({context:t,pixelFormat:u["a"].RGBA,pixelDatatype:l["a"].FLOAT,source:{arrayBufferView:n,width:a,height:r},flipY:!1})}function v(e,t){w(e);const a=i["a"].FRAMEBUFFER_COMPLETE;let r=!0;const n=e._accumulationTexture.width,o=e._accumulationTexture.height;if(e._translucentMRTSupport&&(e._translucentFBO.setColorTexture(e._accumulationTexture,0),e._translucentFBO.setColorTexture(e._revealageTexture,1),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,n,o),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture,0),e._adjustTranslucentFBO.setColorTexture(e._revealageTexture,1),e._adjustTranslucentFBO.update(t,n,o),e._translucentFBO.status===a&&e._adjustTranslucentFBO.status===a||(w(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO.setColorTexture(e._accumulationTexture),e._translucentFBO.setDepthStencilTexture(e._depthStencilTexture),e._translucentFBO.update(t,n,o),e._alphaFBO.setColorTexture(e._revealageTexture),e._alphaFBO.setDepthStencilTexture(e._depthStencilTexture),e._alphaFBO.update(t,n,o),e._adjustTranslucentFBO.setColorTexture(e._accumulationTexture),e._adjustTranslucentFBO.update(t,n,o),e._adjustAlphaFBO.setColorTexture(e._revealageTexture),e._adjustAlphaFBO.update(t,n,o);const s=e._translucentFBO.status===a,u=e._alphaFBO.status===a,i=e._adjustTranslucentFBO.status===a,c=e._adjustAlphaFBO.status===a;s&&u&&i&&c||(b(e),e._translucentMultipassSupport=!1,r=!1)}return r}S.prototype.update=function(e,t,a,n,s){if(!this.isSupported())return;this._opaqueFBO=a,this._opaqueTexture=a.getColorTexture(0),this._depthStencilTexture=a.getDepthStencilTexture();const u=this._opaqueTexture.width,i=this._opaqueTexture.height,c=this._accumulationTexture,d=!Object(o["a"])(c)||c.width!==u||c.height!==i||n!==this._useHDR,m=this._numSamples!==s;if((d||m)&&(this._numSamples=s,x(this,e,u,i)),(!Object(o["a"])(this._translucentFBO.framebuffer)||d||m)&&!v(this,e))return;this._useHDR=n;const l=this;let p,g;Object(o["a"])(this._compositeCommand)||(p=new _["a"]({sources:[C["a"]]}),this._translucentMRTSupport&&p.defines.push("MRT"),g={u_opaque:function(){return l._opaqueTexture},u_accumulation:function(){return l._accumulationTexture},u_revealage:function(){return l._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(p,{uniformMap:g,owner:this})),Object(o["a"])(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(p=new _["a"]({defines:["MRT"],sources:[f["a"]]}),g={u_bgColor:function(){return l._translucentMRTClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(p,{uniformMap:g,owner:this})):this._translucentMultipassSupport&&(p=new _["a"]({sources:[f["a"]]}),g={u_bgColor:function(){return l._translucentMultipassClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(p,{uniformMap:g,owner:this}),g={u_bgColor:function(){return l._alphaClearCommand.color},u_depthTexture:function(){return l._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(p,{uniformMap:g,owner:this}))),this._viewport.width=u,this._viewport.height=i;const T=!r["a"].equals(this._viewport,t.viewport);let S=T!==this._useScissorTest;this._useScissorTest=T,r["a"].equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=r["a"].clone(t.viewport,this._scissorRectangle),S=!0),Object(o["a"])(this._rs)&&r["a"].equals(this._viewport,this._rs.viewport)&&!S||(this._rs=h["a"].fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),Object(o["a"])(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),Object(o["a"])(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)};const F={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ONE,functionDestinationRgb:T["a"].ONE,functionSourceAlpha:T["a"].ZERO,functionDestinationAlpha:T["a"].ONE_MINUS_SOURCE_ALPHA},j={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ONE,functionDestinationRgb:T["a"].ONE,functionSourceAlpha:T["a"].ONE,functionDestinationAlpha:T["a"].ONE},R={enabled:!0,color:new n["a"](0,0,0,0),equationRgb:g["a"].ADD,equationAlpha:g["a"].ADD,functionSourceRgb:T["a"].ZERO,functionDestinationRgb:T["a"].ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:T["a"].ZERO,functionDestinationAlpha:T["a"].ONE_MINUS_SOURCE_ALPHA};function B(e,t,a,r){let n=a[r.id];if(!Object(o["a"])(n)){const e=h["a"].getState(r);e.depthMask=!1,e.blending=t,n=h["a"].fromCache(e),a[r.id]=n}return n}function A(e,t,a){return B(t,F,e._translucentRenderStateCache,a)}function D(e,t,a){return B(t,j,e._translucentRenderStateCache,a)}function M(e,t,a){return B(t,R,e._alphaRenderStateCache,a)}const P="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",y="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",q="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function z(e,t,a,r){let n=e.shaderCache.getDerivedShaderProgram(t,a);if(!Object(o["a"])(n)){const o=t._attributeLocations,s=t.fragmentShaderSource.clone();s.sources=s.sources.map((function(e){return e=_["a"].replaceMain(e,"czm_translucent_main"),e=e.replace(/gl_FragColor/g,"czm_gl_FragColor"),e=e.replace(/\bdiscard\b/g,"czm_discard = true"),e=e.replace(/czm_phong/g,"czm_translucentPhong"),e})),s.sources.splice(0,0,(-1!==r.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),s.sources.push(`void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n${r}}\n`),n=e.shaderCache.createDerivedShaderProgram(t,a,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:s,attributeLocations:o})}return n}function E(e,t){return z(e,t,"translucentMRT",P)}function L(e,t){return z(e,t,"translucentMultipass",y)}function N(e,t){return z(e,t,"alphaMultipass",q)}function I(e,t,a,r,n,s){let u,i,c;const d=t.context,m=t.frameState.useLogDepth,l=t._hdr,h=r.framebuffer,_=n.length,p=t.frameState.shadowState.lightShadowsEnabled;r.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(d,r),r.framebuffer=e._adjustAlphaFBO.framebuffer,e._adjustAlphaCommand.execute(d,r);const f=e._opaqueFBO.framebuffer;for(r.framebuffer=e._translucentFBO.framebuffer,c=0;c<_;++c)u=n[c],u=m?u.derivedCommands.logDepth.command:u,u=l?u.derivedCommands.hdr.command:u,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.translucentCommand:u.derivedCommands.oit.translucentCommand,a(i,t,d,r,f);for(Object(o["a"])(s)&&(u=s.unclassifiedCommand,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.translucentCommand:u.derivedCommands.oit.translucentCommand,a(i,t,d,r,f)),r.framebuffer=e._alphaFBO.framebuffer,c=0;c<_;++c)u=n[c],u=m?u.derivedCommands.logDepth.command:u,u=l?u.derivedCommands.hdr.command:u,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.alphaCommand:u.derivedCommands.oit.alphaCommand,a(i,t,d,r,f);Object(o["a"])(s)&&(u=s.unclassifiedCommand,i=p&&u.receiveShadows?u.derivedCommands.oit.shadows.alphaCommand:u.derivedCommands.oit.alphaCommand,a(i,t,d,r,f)),r.framebuffer=h}function U(e,t,a,r,n,s){const u=t.context,i=t.frameState.useLogDepth,c=t._hdr,d=r.framebuffer,m=n.length,l=t.frameState.shadowState.lightShadowsEnabled;r.framebuffer=e._adjustTranslucentFBO.framebuffer,e._adjustTranslucentCommand.execute(u,r);const h=e._opaqueFBO.framebuffer;let _,p;r.framebuffer=e._translucentFBO.framebuffer;for(let o=0;o<m;++o)_=n[o],_=i?_.derivedCommands.logDepth.command:_,_=c?_.derivedCommands.hdr.command:_,p=l&&_.receiveShadows?_.derivedCommands.oit.shadows.translucentCommand:_.derivedCommands.oit.translucentCommand,a(p,t,u,r,h);Object(o["a"])(s)&&(_=s.unclassifiedCommand,p=l&&_.receiveShadows?_.derivedCommands.oit.shadows.translucentCommand:_.derivedCommands.oit.translucentCommand,a(p,t,u,r,h)),r.framebuffer=d}S.prototype.createDerivedCommands=function(e,t,a){if(Object(o["a"])(a)||(a={}),this._translucentMRTSupport){let r,n;Object(o["a"])(a.translucentCommand)&&(r=a.translucentCommand.shaderProgram,n=a.translucentCommand.renderState),a.translucentCommand=d["a"].shallowClone(e,a.translucentCommand),Object(o["a"])(r)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=r,a.translucentCommand.renderState=n):(a.translucentCommand.shaderProgram=E(t,e.shaderProgram),a.translucentCommand.renderState=A(this,t,e.renderState),a.shaderProgramId=e.shaderProgram.id)}else{let r,n,s,u;Object(o["a"])(a.translucentCommand)&&(r=a.translucentCommand.shaderProgram,n=a.translucentCommand.renderState,s=a.alphaCommand.shaderProgram,u=a.alphaCommand.renderState),a.translucentCommand=d["a"].shallowClone(e,a.translucentCommand),a.alphaCommand=d["a"].shallowClone(e,a.alphaCommand),Object(o["a"])(r)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=r,a.translucentCommand.renderState=n,a.alphaCommand.shaderProgram=s,a.alphaCommand.renderState=u):(a.translucentCommand.shaderProgram=L(t,e.shaderProgram),a.translucentCommand.renderState=D(this,t,e.renderState),a.alphaCommand.shaderProgram=N(t,e.shaderProgram),a.alphaCommand.renderState=M(this,t,e.renderState),a.shaderProgramId=e.shaderProgram.id)}return a},S.prototype.executeCommands=function(e,t,a,r,n){this._translucentMRTSupport?U(this,e,t,a,r,n):I(this,e,t,a,r,n)},S.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},S.prototype.clear=function(e,t,a){const r=t.framebuffer;t.framebuffer=this._opaqueFBO.framebuffer,n["a"].clone(a,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO.framebuffer;const o=this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand;o.execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO.framebuffer,this._alphaClearCommand.execute(e,t)),t.framebuffer=r},S.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},S.prototype.isDestroyed=function(){return!1},S.prototype.destroy=function(){return b(this),Object(o["a"])(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(o["a"])(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),Object(o["a"])(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Object(s["a"])(this)},t["a"]=S}}]);