(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors~aaa45a20"],{c770:function(e,t,i){"use strict";var a=i("6af0"),s=i("8656"),o=i("90c5"),n=i("dde0"),r=i("8d54"),c=i("44e9"),u=i("4051"),m=i("ed17"),d=i("0b4a"),h=i("c76f"),l=i("1a5d"),p=i("c937"),f=i("44c1"),_=i("21b7"),g=i("e2a6"),b=i("2459"),C=i("f7b5"),S=i("1f02"),v=i("e8ff"),w=i("f6fe"),D=i("a61d"),y=i("6247"),O=i("b8b5"),E=i("722e"),x=i("7f00"),P=i("8ccc"),T=i("ec1a"),j=i("1345"),F=i("3f87"),I=i("a06c"),R=i("d828"),L=i("86a0"),k=i("6f7c"),M=i("a3c8"),A=i("055f"),V=i("f176"),N=i("2341"),B=i("51f2"),U=i("5027"),W=i("0c61"),G=i("c70c"),H=i("4b41"),q=i("b429"),Q=i("a924"),z=i("2b78"),K=i("6ba9"),J=i("ee78"),X=i("b1bd"),Y=i("695d"),Z=i("f123"),$=i("9b40"),ee=i("52c0"),te=i("1184"),ie=i("d58e"),ae=i("5ef1"),se=i("86a5"),oe=i("1f21"),ne=i("f477"),re=i("55ba"),ce=i("5769"),ue=i("4c5b"),me=i("dc6c"),de=i("6a98"),he=i("8e20"),le=i("d6be"),pe=i("47c8"),fe=i("8d2f"),_e=i("3639"),ge=i("c017"),be=i("ef44"),Ce=i("bb49"),Se=i("9f50");const ve=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function we(e){e=Object(l["a"])(e,l["a"].EMPTY_OBJECT);const t=e.canvas;let i=e.creditContainer,s=e.creditViewport,o=Object(c["a"])(e.contextOptions);if(Object(p["a"])(o)||(o={}),Object(p["a"])(o.webgl)||(o.webgl={}),o.webgl.powerPreference=Object(l["a"])(o.webgl.powerPreference,"high-performance"),!Object(p["a"])(t))throw new g["a"]("options and options.canvas are required.");const n=Object(p["a"])(i),r=new V["a"](t,o);n||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),Object(p["a"])(s)||(s=t.parentNode),this._id=Object(d["a"])(),this._jobScheduler=new te["a"],this._frameState=new Z["a"](r,new Q["a"](i," â€¢ ",s),this._jobScheduler),this._frameState.scene3DOnly=Object(l["a"])(e.scene3DOnly,!1),this._removeCreditContainer=!n,this._creditContainer=i,this._canvas=t,this._context=r,this._computeEngine=new A["a"](r),this._globe=void 0,this._globeTranslucencyState=new $["a"],this._primitives=new ue["a"],this._groundPrimitives=new ue["a"],this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=r.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new be["a"],this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(l["a"])(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new K["a"](e.depthPlaneEllipsoidOffset),this._clearColorCommand=new M["a"]({color:new u["a"],stencil:0,owner:this}),this._depthClearCommand=new M["a"]({depth:1,owner:this}),this._stencilClearCommand=new M["a"]({stencil:0}),this._classificationStencilClearCommand=new M["a"]({stencil:0,renderState:U["a"].fromCache({stencilMask:fe["a"].CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new he["a"](this),this._preUpdate=new C["a"],this._postUpdate=new C["a"],this._renderError=new C["a"],this._preRender=new C["a"],this._postRender=new C["a"],this._minimumDisableDepthTestDistance=0,this._debugInspector=new Se["a"],this._msaaSamples=Object(l["a"])(e.msaaSamples,1),this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new C["a"],this.morphComplete=new C["a"],this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=u["a"].clone(u["a"].BLACK),this._mode=me["a"].SCENE3D,this._mapProjection=Object(p["a"])(e.mapProjection)?e.mapProjection:new S["a"],this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new Y["a"],this._shadowMapCamera=new G["a"](this),this.shadowMap=new pe["a"]({context:r,lightCamera:this._shadowMapCamera,enabled:Object(l["a"])(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=u["a"].clone(u["a"].WHITE),this._actualInvertClassificationColor=u["a"].clone(this._invertClassificationColor),this._invertClassification=new ee["a"],this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new re["a"],this._brdfLutGenerator=new W["a"],this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new le["a"](this),this._cameraUnderground=!1,this._mapMode2D=Object(l["a"])(e.mapMode2D,ie["a"].INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(l["a"])(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(l["a"])(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=R["a"].requestCompletedEvent.addEventListener(ve(this)),this._removeTaskProcessorListenerCallback=L["a"].taskCompletedEvent.addEventListener(ve(this)),this._removeGlobeCallbacks=[];const m=new a["a"](0,0,r.drawingBufferWidth,r.drawingBufferHeight),h=new G["a"](this);this._logDepthBuffer&&(h.frustum.near=.1,h.frustum.far=1e10),this.preloadFlightCamera=new G["a"](this),this.preloadFlightCullingVolume=void 0,this._picking=new ne["a"](this),this._defaultView=new Ce["a"](this,h,m),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new _e["a"],Ie(this,0,y["a"].now()),this.updateFrameState(),this.initializeFrame()}function De(e,t){for(let a=0;a<e._removeGlobeCallbacks.length;++a)e._removeGlobeCallbacks[a]();e._removeGlobeCallbacks.length=0;const i=[];Object(p["a"])(t)&&(i.push(t.imageryLayersUpdatedEvent.addEventListener(ve(e))),i.push(t.terrainProviderChanged.addEventListener(ve(e)))),e._removeGlobeCallbacks=i}function ye(e,t,i){const a=e._frameState,s=e._context,o=e._view.oit,n=a.shadowState.lightShadowMaps,r=a.shadowState.lightShadowsEnabled;let c=t.derivedCommands;Object(p["a"])(t.pickId)&&(c.picking=J["a"].createPickDerivedCommand(e,t,s,c.picking)),t.pickOnly||(c.depth=J["a"].createDepthOnlyDerivedCommand(e,t,s,c.depth)),c.originalCommand=t,e._hdr&&(c.hdr=J["a"].createHdrCommand(t,s,c.hdr),t=c.hdr.command,c=t.derivedCommands),r&&t.receiveShadows&&(c.shadows=pe["a"].createReceiveDerivedCommand(n,t,i,s,c.shadows)),t.pass===B["a"].TRANSLUCENT&&Object(p["a"])(o)&&o.isSupported()&&(r&&t.receiveShadows?(c.oit=Object(p["a"])(c.oit)?c.oit:{},c.oit.shadows=o.createDerivedCommands(c.shadows.receiveCommand,s,c.oit.shadows)):c.oit=o.createDerivedCommands(t,s,c.oit))}Object.defineProperties(we.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return N["a"].maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return N["a"].maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return ae["a"].isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,De(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(p["a"])(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProvider},set:function(e){Object(p["a"])(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){if(this.scene3DOnly&&e!==me["a"].SCENE3D)throw new g["a"]("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(e===me["a"].SCENE2D)this.morphTo2D(0);else if(e===me["a"].SCENE3D)this.morphTo3D(0);else{if(e!==me["a"].COLUMBUS_VIEW)throw new g["a"]("value must be a valid SceneMode enumeration.");this.morphToColumbusView(0)}this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){if(this.camera.frustum instanceof T["a"])throw new g["a"]("VR is unsupported with an orthographic projection.");this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new G["a"](this),Object(p["a"])(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new X["a"](this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},imagerySplitPosition:{get:function(){return Object(f["a"])("Scene.imagerySplitPosition","Scene.imagerySplitPosition has been deprecated in Cesium 1.92. It will be removed in Cesium 1.94. Use splitPosition instead."),this._frameState.splitPosition},set:function(e){Object(f["a"])("Scene.imagerySplitPosition","Scene.imagerySplitPosition has been deprecated in Cesium 1.92. It will be removed in Cesium 1.94. Use splitPosition instead."),this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){if(!Object(p["a"])(e)||e<0)throw new g["a"]("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){const t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){const e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,N["a"].maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),we.prototype.getCompressedTextureFormatSupported=function(e){const t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc"===e||"etc"===e)&&t.etc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1||("WEBGL_compressed_texture_astc"===e||"astc"===e)&&t.astc||("EXT_texture_compression_bptc"===e||"bc7"===e)&&t.bc7},we.prototype.updateDerivedCommands=function(e){if(!Object(p["a"])(e.derivedCommands))return;const t=this._frameState,i=this._context;let a=!1;const s=t.shadowState.lastDirtyTime;e.lastDirtyTime!==s&&(e.lastDirtyTime=s,e.dirty=!0,a=!0);const o=t.useLogDepth,n=this._hdr,r=e.derivedCommands,c=Object(p["a"])(r.logDepth),u=Object(p["a"])(r.hdr),m=Object(p["a"])(r.originalCommand),d=o&&!c,h=n&&!u,l=(!o||!n)&&!m;if(e.dirty=e.dirty||d||h||l,e.dirty){e.dirty=!1;const s=t.shadowState.shadowMaps,o=t.shadowState.shadowsEnabled;o&&e.castShadows&&(r.shadows=pe["a"].createCastDerivedCommand(s,e,a,i,r.shadows)),(c||d)&&(r.logDepth=J["a"].createLogDepthCommand(e,i,r.logDepth),ye(this,r.logDepth.command,a)),(m||l)&&ye(this,e,a)}};const Oe=new q["a"]({pass:H["a"].RENDER}),Ee=new q["a"]({pass:H["a"].PRELOAD}),xe=new q["a"]({pass:H["a"].PRELOAD_FLIGHT}),Pe=new q["a"]({pass:H["a"].REQUEST_RENDER_MODE_DEFER_CHECK}),Te=new s["a"];let je;function Fe(e){const t=e.globe;if(e._mode===me["a"].SCENE3D&&Object(p["a"])(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){const i=t.ellipsoid,a=e.frameState.minimumTerrainHeight;return Te.radius=i.minimumRadius+a,je=P["a"].fromBoundingSphere(Te,e.camera.positionWC,je),je}}function Ie(e,t,i){const a=e._frameState;a.frameNumber=t,a.time=y["a"].clone(i,a.time)}we.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},we.prototype.updateFrameState=function(){const e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Fe(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof T["a"]||this.camera.frustum instanceof j["a"]),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,Object(p["a"])(this.globe)&&(t.terrainExaggeration=this.globe.terrainExaggeration,t.terrainExaggerationRelativeHeight=this.globe.terrainExaggerationRelativeHeight),Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=u["a"].clone(this.invertClassificationColor,this._actualInvertClassificationColor),ee["a"].isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(p["a"])(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},we.prototype.isVisible=function(e,t,i){return Object(p["a"])(e)&&(!Object(p["a"])(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==D["a"].OUTSIDE&&(!Object(p["a"])(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};let Re=new E["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Le(e,t,i,a){const s=t._frameState,r=s.context,c=e.boundingVolume;let u;Object(p["a"])(t._debugVolume)&&t._debugVolume.destroy();let d=n["a"].clone(c.center);if(s.mode!==me["a"].SCENE3D){d=E["a"].multiplyByPoint(Re,d,d);const e=s.mapProjection,t=e.unproject(d);d=e.ellipsoid.cartographicToCartesian(t)}if(Object(p["a"])(c.radius)){const e=c.radius;u=w["a"].toWireframe(b["a"].createGeometry(new b["a"]({radii:new n["a"](e,e,e),vertexFormat:oe["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ce["a"]({geometryInstances:new v["a"]({geometry:u,modelMatrix:E["a"].fromTranslation(d),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new oe["a"]({flat:!0,translucent:!1}),asynchronous:!1})}else{const e=c.halfAxes;u=w["a"].toWireframe(o["a"].createGeometry(o["a"].fromDimensions({dimensions:new n["a"](2,2,2),vertexFormat:oe["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ce["a"]({geometryInstances:new v["a"]({geometry:u,modelMatrix:E["a"].fromRotationTranslation(e,d,new E["a"]),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new oe["a"]({flat:!0,translucent:!1}),asynchronous:!1})}const h=s.commandList,l=s.commandList=[];if(t._debugVolume.update(s),e=l[0],s.useLogDepth){const t=J["a"].createLogDepthCommand(e,r);e=t.command}let f;Object(p["a"])(a)&&(f=i.framebuffer,i.framebuffer=a),e.execute(r,i),Object(p["a"])(f)&&(i.framebuffer=f),s.commandList=h}function ke(e,t,i,a,s){const o=t._frameState;if(Object(p["a"])(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof M["a"])return void e.execute(i,a);e.debugShowBoundingVolume&&Object(p["a"])(e.boundingVolume)&&Le(e,t,a,s),o.useLogDepth&&Object(p["a"])(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);const n=o.passes;if(!n.pick&&!n.depth&&t._hdr&&Object(p["a"])(e.derivedCommands)&&Object(p["a"])(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&Object(p["a"])(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,a);if(Object(p["a"])(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,a)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,a):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(p["a"])(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,a):e.execute(i,a)}function Me(e,t,i,a){const s=t._frameState;let o=e.derivedCommands;Object(p["a"])(o)&&(s.useLogDepth&&Object(p["a"])(o.logDepth)&&(e=o.logDepth.command),o=e.derivedCommands,Object(p["a"])(o.picking)?(e=o.picking.pickCommand,e.execute(i,a)):Object(p["a"])(o.depth)&&(e=o.depth.depthOnlyCommand,e.execute(i,a)))}function Ae(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function Ve(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+O["a"].EPSILON12}function Ne(e,t,i,a,s){const o=e.context;Object(x["a"])(a,Ae,e.camera.positionWC),Object(p["a"])(s)&&t(s.unclassifiedCommand,e,o,i);const n=a.length;for(let r=0;r<n;++r)t(a[r],e,o,i)}function Be(e,t,i,a,s){const o=e.context;Object(x["a"])(a,Ve,e.camera.positionWC),Object(p["a"])(s)&&t(s.unclassifiedCommand,e,o,i);const n=a.length;for(let r=0;r<n;++r)t(a[r],e,o,i)}Re=E["a"].inverseTransformation(Re,Re);const Ue=new F["a"],We=new I["a"],Ge=new T["a"],He=new j["a"];function qe(e,t){const i=e.camera,a=e.context,s=e.frameState,o=a.uniformState;let n;o.updateCamera(i),n=Object(p["a"])(i.frustum.fov)?i.frustum.clone(Ue):Object(p["a"])(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(We):Object(p["a"])(i.frustum.width)?i.frustum.clone(Ge):i.frustum.clone(He),n.near=i.frustum.near,n.far=i.frustum.far,o.updateFrustum(n),o.updatePass(B["a"].ENVIRONMENT);const r=s.passes,c=r.pick,u=e._environmentState,m=e._view,d=u.renderTranslucentDepthForPick,h=u.useWebVR;if(!c){const i=u.skyBoxCommand;if(Object(p["a"])(i)&&ke(i,e,a,t),u.isSkyAtmosphereVisible&&ke(u.skyAtmosphereCommand,e,a,t),u.isSunVisible&&(u.sunDrawCommand.execute(a,t),e.sunBloom&&!h)){let i;i=u.useGlobeDepthFramebuffer?m.globeDepth.framebuffer:u.usePostProcess?m.sceneFramebuffer.framebuffer:u.originalFramebuffer,e._sunPostProcess.execute(a),e._sunPostProcess.copy(a,i),t.framebuffer=i}u.isMoonVisible&&u.moonCommand.execute(a,t)}let l;u.useOIT?(Object(p["a"])(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,s,o){m.globeDepth.prepareColorTextures(a),m.oit.executeCommands(e,t,i,s,o)}),l=e._executeOITFunction):l=r.render?Ne:Be;const f=m.frustumCommandsList,_=f.length,g=u.clearGlobeDepth,b=u.useDepthPlane,C=e._globeTranslucencyState,S=C.translucent,v=e._view.globeTranslucencyFramebuffer,w=e._depthClearCommand,D=e._stencilClearCommand,y=e._classificationStencilClearCommand,O=e._depthPlane,E=u.usePostProcessSelected,x=i.position.z;let P;for(let T=0;T<_;++T){const r=_-T-1,h=f[r];e.mode===me["a"].SCENE2D?(i.position.z=x-h.near+1,n.far=Math.max(1,h.far-h.near),n.near=1,o.update(s),o.updateFrustum(n)):(n.near=0!==r?h.near*e.opaqueFrustumNearOffset:h.near,n.far=h.far,o.updateFrustum(n)),w.execute(a,t),a.stencilBuffer&&D.execute(a,t),o.updatePass(B["a"].GLOBE);let j=h.commands[B["a"].GLOBE],F=h.indices[B["a"].GLOBE];if(S)C.executeGlobeCommands(h,ke,v,e,t);else for(P=0;P<F;++P)ke(j[P],e,a,t);const I=m.globeDepth;if(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&I.executeCopyDepth(a,t),!u.renderTranslucentDepthForPick)if(o.updatePass(B["a"].TERRAIN_CLASSIFICATION),j=h.commands[B["a"].TERRAIN_CLASSIFICATION],F=h.indices[B["a"].TERRAIN_CLASSIFICATION],S)C.executeGlobeClassificationCommands(h,ke,v,e,t);else for(P=0;P<F;++P)ke(j[P],e,a,t);if(g&&(w.execute(a,t),b&&O.execute(a,t)),!u.useInvertClassification||c||u.renderTranslucentDepthForPick){for(o.updatePass(B["a"].CESIUM_3D_TILE),j=h.commands[B["a"].CESIUM_3D_TILE],F=h.indices[B["a"].CESIUM_3D_TILE],P=0;P<F;++P)ke(j[P],e,a,t);if(F>0&&(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&(I.prepareColorTextures(a,g),I.executeUpdateDepth(a,t,g,I.depthStencilTexture)),!u.renderTranslucentDepthForPick))for(o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION),j=h.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION],F=h.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION],P=0;P<F;++P)ke(j[P],e,a,t)}else{e._invertClassification.clear(a,t);const i=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo.framebuffer,o.updatePass(B["a"].CESIUM_3D_TILE),j=h.commands[B["a"].CESIUM_3D_TILE],F=h.indices[B["a"].CESIUM_3D_TILE],P=0;P<F;++P)ke(j[P],e,a,t);for(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&(e._invertClassification.prepareTextures(a),I.executeUpdateDepth(a,t,g,e._invertClassification._fbo.getDepthStencilTexture())),o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),j=h.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],F=h.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],P=0;P<F;++P)ke(j[P],e,a,t);for(t.framebuffer=i,e._invertClassification.executeClassified(a,t),1===s.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(a,t),F>0&&a.stencilBuffer&&y.execute(a,t),o.updatePass(B["a"].CESIUM_3D_TILE_CLASSIFICATION),j=h.commands[B["a"].CESIUM_3D_TILE_CLASSIFICATION],F=h.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION],P=0;P<F;++P)ke(j[P],e,a,t)}for(F>0&&a.stencilBuffer&&D.execute(a,t),o.updatePass(B["a"].OPAQUE),j=h.commands[B["a"].OPAQUE],F=h.indices[B["a"].OPAQUE],P=0;P<F;++P)ke(j[P],e,a,t);let R;0!==r&&e.mode!==me["a"].SCENE2D&&(n.near=h.near,o.updateFrustum(n)),!c&&u.useInvertClassification&&s.invertClassificationColor.alpha<1&&(R=e._invertClassification),o.updatePass(B["a"].TRANSLUCENT),j=h.commands[B["a"].TRANSLUCENT],j.length=h.indices[B["a"].TRANSLUCENT],l(e,ke,t,j,R);const L=h.indices[B["a"].CESIUM_3D_TILE_CLASSIFICATION]>0;if(L&&m.translucentTileClassification.isSupported()&&(m.translucentTileClassification.executeTranslucentCommands(e,ke,t,j,I.depthStencilTexture),m.translucentTileClassification.executeClassificationCommands(e,ke,t,h)),a.depthTexture&&e.useDepthPicking&&(u.useGlobeDepthFramebuffer||d)){const i=I.depthStencilTexture,s=e._picking.getPickDepth(e,r);s.update(a,i),s.executeCopyDepth(a,t)}if(c||!E)continue;const k=t.framebuffer;if(t.framebuffer=m.sceneFramebuffer.getIdFramebuffer(),n.near=0!==r?h.near*e.opaqueFrustumNearOffset:h.near,n.far=h.far,o.updateFrustum(n),o.updatePass(B["a"].GLOBE),j=h.commands[B["a"].GLOBE],F=h.indices[B["a"].GLOBE],S)C.executeGlobeCommands(h,Me,v,e,t);else for(P=0;P<F;++P)Me(j[P],e,a,t);for(g&&(w.framebuffer=t.framebuffer,w.execute(a,t),w.framebuffer=void 0),g&&b&&O.execute(a,t),o.updatePass(B["a"].CESIUM_3D_TILE),j=h.commands[B["a"].CESIUM_3D_TILE],F=h.indices[B["a"].CESIUM_3D_TILE],P=0;P<F;++P)Me(j[P],e,a,t);for(o.updatePass(B["a"].OPAQUE),j=h.commands[B["a"].OPAQUE],F=h.indices[B["a"].OPAQUE],P=0;P<F;++P)Me(j[P],e,a,t);for(o.updatePass(B["a"].TRANSLUCENT),j=h.commands[B["a"].TRANSLUCENT],F=h.indices[B["a"].TRANSLUCENT],P=0;P<F;++P)Me(j[P],e,a,t);t.framebuffer=k}}function Qe(e){const t=e.context.uniformState;t.updatePass(B["a"].COMPUTE);const i=e._environmentState.sunComputeCommand;Object(p["a"])(i)&&i.execute(e._computeEngine);const a=e._computeCommandList,s=a.length;for(let o=0;o<s;++o)a[o].execute(e._computeEngine)}function ze(e,t){const i=e.context.uniformState;i.updatePass(B["a"].OVERLAY);const a=e.context,s=e._overlayCommandList,o=s.length;for(let n=0;n<o;++n)s[n].execute(a,t)}function Ke(e,t,i){const a=i.shadowMapCullingVolume,s=i.isPointLight,o=i.passes,n=o.length,r=t.length;for(let c=0;c<r;++c){const i=t[c];if(e.updateDerivedCommands(i),i.castShadows&&(i.pass===B["a"].GLOBE||i.pass===B["a"].CESIUM_3D_TILE||i.pass===B["a"].OPAQUE||i.pass===B["a"].TRANSLUCENT)&&e.isVisible(i,a))if(s)for(let e=0;e<n;++e)o[e].commandList.push(i);else if(1===n)o[0].commandList.push(i);else{let t=!1;for(let a=n-1;a>=0;--a){const s=o[a].cullingVolume;if(e.isVisible(i,s))o[a].commandList.push(i),t=!0;else if(t)break}}}}function Je(e){const t=e.frameState,i=t.shadowState.shadowMaps,a=i.length;if(!t.shadowState.shadowsEnabled)return;const s=e.context,o=s.uniformState;for(let n=0;n<a;++n){const t=i[n];if(t.outOfView)continue;const a=t.passes,r=a.length;for(let e=0;e<r;++e)a[e].commandList.length=0;const c=e.frameState.commandList;Ke(e,c,t);for(let i=0;i<r;++i){const a=t.passes[i];o.updateCamera(a.camera),t.updatePass(s,i);const r=a.commandList.length;for(let t=0;t<r;++t){const i=a.commandList[t];o.updatePass(i.pass),ke(i.derivedCommands.shadows.castCommands[n],e,s,a.passState)}}}}const Xe=new n["a"];function Ye(e,t,i){const a=e._view,s=a.camera,o=e._environmentState,r=o.renderTranslucentDepthForPick;ht(e,t,i),dt(e),a.createPotentiallyVisibleSet(e),Qe(e),r||Je(e);const c=t.viewport;c.x=0,c.y=0,c.width=.5*c.width;const u=G["a"].clone(s,e._cameraVR);u.frustum=s.frustum;const m=s.frustum.near,d=m*Object(l["a"])(e.focalLength,5),h=Object(l["a"])(e.eyeSeparation,d/30),p=n["a"].multiplyByScalar(u.right,.5*h,Xe);s.frustum.aspectRatio=c.width/c.height;const f=.5*h*m/d;n["a"].add(u.position,p,s.position),s.frustum.xOffset=f,qe(e,t),c.x=c.width,n["a"].subtract(u.position,p,s.position),s.frustum.xOffset=-f,qe(e,t),G["a"].clone(u,s)}we.prototype.updateAndExecuteCommands=function(e,t){const i=this._frameState,a=i.mode,s=this._environmentState.useWebVR;s?Ye(this,e,t):a!==me["a"].SCENE2D||this._mapMode2D===ie["a"].ROTATE?rt(!0,this,e,t):(ht(this,e,t),nt(this,e))};const Ze=new r["a"](Math.PI,O["a"].PI_OVER_TWO),$e=new n["a"],et=new n["a"],tt=new E["a"],it=new E["a"],at=new n["a"],st=new n["a"],ot=new a["a"];function nt(e,t){const i=e.context,s=e.frameState,o=e.camera,r=t.viewport,c=a["a"].clone(r,ot);t.viewport=c;const u=Ze,m=$e,d=e.mapProjection;d.project(u,m);const h=n["a"].clone(o.position,et),l=E["a"].clone(o.transform,it),p=o.frustum.clone();o._setTransform(E["a"].IDENTITY);const f=E["a"].computeViewportTransformation(c,0,1,tt),_=o.frustum.projectionMatrix,g=o.positionWC.y,b=n["a"].fromElements(O["a"].sign(g)*m.x-g,0,-o.positionWC.x,at),C=k["a"].pointToGLWindowCoordinates(_,f,b,st);C.x=Math.floor(C.x);const S=c.x,v=c.width;if(0===g||C.x<=S||C.x>=S+v)rt(!0,e,t);else if(Math.abs(S+.5*v-C.x)<1)c.width=C.x-c.x,o.position.x*=O["a"].sign(o.position.x),o.frustum.right=0,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!0,e,t),c.x=C.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!1,e,t);else if(C.x>S+.5*v){c.width=C.x-S;const a=o.frustum.right;o.frustum.right=m.x-g,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!0,e,t),c.x=C.x,c.width=S+v-C.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=a-2*o.frustum.right,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!1,e,t)}else{c.x=C.x,c.width=S+v-C.x;const a=o.frustum.left;o.frustum.left=-m.x-g,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!0,e,t),c.x=S,c.width=C.x-S,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=a-2*o.frustum.left,s.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(s),rt(!1,e,t)}o._setTransform(l),n["a"].clone(h,o.position),o.frustum=p.clone(),t.viewport=r}function rt(e,t,i,a){const s=t._environmentState,o=t._view,n=s.renderTranslucentDepthForPick;e||(t.frameState.commandList.length=0),dt(t),o.createPotentiallyVisibleSet(t),e&&(Object(p["a"])(a)&&ht(t,i,a),Qe(t),n||Je(t)),qe(t,i)}const ct=new h["a"];function ut(e){const t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new z["a"]({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(p["a"])(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function mt(e){const t=e._frameState,i=t.shadowMaps,a=i.length,s=a>0&&!t.passes.pick&&e.mode===me["a"].SCENE3D;if(s!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=s),t.shadowState.lightShadowsEnabled=!1,s){for(let e=0;e<a;++e)if(i[e]!==t.shadowState.shadowMaps[e]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(let e=0;e<a;++e){const a=i[e];a.update(t),t.shadowState.shadowMaps.push(a),a.fromLightSource&&(t.shadowState.lightShadowMaps.push(a),t.shadowState.lightShadowsEnabled=!0),a.dirty&&(++t.shadowState.lastDirtyTime,a.dirty=!1)}}}function dt(e){const t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),ut(e),mt(e),e._globe&&e._globe.render(t)}function ht(e,t,i){const a=e._context,s=e._frameState,o=e._environmentState,n=e._view,r=e._frameState.passes,c=r.pick;Object(p["a"])(n.globeDepth)&&(n.globeDepth.picking=c);const m=o.useWebVR;o.originalFramebuffer=t.framebuffer,Object(p["a"])(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!m?e._sunPostProcess=new ge["a"]:Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(p["a"])(e.sun)&&Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);const d=e._clearColorCommand;u["a"].clone(i,d.color),d.execute(a,t);const h=o.useGlobeDepthFramebuffer=Object(p["a"])(n.globeDepth);h&&(n.globeDepth.update(a,t,n.viewport,e.msaaSamples,e._hdr,o.clearGlobeDepth),n.globeDepth.clear(a,t,i));const l=n.oit,f=o.useOIT=!c&&Object(p["a"])(l)&&l.isSupported();f&&(l.update(a,t,n.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),l.clear(a,t,i),o.useOIT=l.isSupported());const _=e.postProcessStages;let g=o.usePostProcess=!c&&(e._hdr||_.length>0||_.ambientOcclusion.enabled||_.fxaa.enabled||_.bloom.enabled);o.usePostProcessSelected=!1,g&&(n.sceneFramebuffer.update(a,n.viewport,e._hdr,e.msaaSamples),n.sceneFramebuffer.clear(a,t,i),_.update(a,s.useLogDepth,e._hdr),_.clear(a),g=o.usePostProcess=_.ready,o.usePostProcessSelected=g&&_.hasSelected),o.isSunVisible&&e.sunBloom&&!m?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(a,t,i)):h?t.framebuffer=n.globeDepth.framebuffer:g&&(t.framebuffer=n.sceneFramebuffer.framebuffer),Object(p["a"])(t.framebuffer)&&d.execute(a,t);const b=o.useInvertClassification=!c&&Object(p["a"])(t.framebuffer)&&e.invertClassification;if(b){let i;if(1===e.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(i=n.globeDepth.framebuffer),Object(p["a"])(i)||a.depthTexture){if(e._invertClassification.previousFramebuffer=i,e._invertClassification.update(a,e.msaaSamples,n.globeDepth.colorFramebufferManager),e._invertClassification.clear(a,t),e.frameState.invertClassificationColor.alpha<1&&f){const t=e._invertClassification.unclassifiedCommand,i=t.derivedCommands;i.oit=l.createDerivedCommands(t,a,i.oit)}}else o.useInvertClassification=!1}e._globeTranslucencyState.translucent&&n.globeTranslucencyFramebuffer.updateAndClear(e._hdr,n.viewport,a,t)}function lt(e){const t=e._frameState.afterRender;for(let i=0,a=t.length;i<a;++i)t[i](),e.requestRender();t.length=0}function pt(e){const t=e._globe,i=e.camera,a=i.positionCartographic;if(Object(p["a"])(t)&&t.show&&Object(p["a"])(a))return t.getHeight(a)}function ft(e){const t=e.camera,i=e._mode,a=e.globe,s=e._screenSpaceCameraController,o=t.positionCartographic;if(!Object(p["a"])(o))return!1;if(!s.onMap()&&o.height<0)return!0;if(!Object(p["a"])(a)||!a.show||i===me["a"].SCENE2D||i===me["a"].MORPHING)return!1;const n=e._globeHeight;return Object(p["a"])(n)&&o.height<n}function _t(e,t){if(e.debugShowFramesPerSecond){if(!Object(p["a"])(e._performanceDisplay)){const t=document.createElement("div");t.className="cesium-performanceDisplay-defaultContainer";const i=e._canvas.parentNode;i.appendChild(t);const a=new se["a"]({container:t});e._performanceDisplay=a,e._performanceContainer=t}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(p["a"])(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function gt(e){e._jobScheduler.resetBudgets();const t=e._frameState,i=e.primitives;i.prePassesUpdate(t),Object(p["a"])(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function bt(e){const t=e._frameState,i=e.primitives;i.postPassesUpdate(t),R["a"].update()}we.prototype.updateEnvironment=function(){const e=this._frameState,t=this._view,i=this._environmentState,a=e.passes.render,s=e.passes.offscreen,o=this.skyAtmosphere,n=this.globe,r=this._globeTranslucencyState;if(!a||this._mode!==me["a"].SCENE2D&&t.camera.frustum instanceof T["a"]||!r.environmentVisible)i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(p["a"])(o)?(Object(p["a"])(n)&&(o.setDynamicAtmosphereColor(n.enableLighting&&n.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||n._surface._tilesToRender.length>0),i.skyAtmosphereCommand=o.update(e,n),Object(p["a"])(i.skyAtmosphereCommand)&&this.updateDerivedCommands(i.skyAtmosphereCommand)):i.skyAtmosphereCommand=void 0,i.skyBoxCommand=Object(p["a"])(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;const a=Object(p["a"])(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(p["a"])(a)?a.drawCommand:void 0,i.sunComputeCommand=Object(p["a"])(a)?a.computeCommand:void 0,i.moonCommand=Object(p["a"])(this.moon)?this.moon.update(e):void 0}const c=i.clearGlobeDepth=Object(p["a"])(n)&&n.show&&(!n.depthTestAgainstTerrain||this.mode===me["a"].SCENE2D),u=i.useDepthPlane=c&&this.mode===me["a"].SCENE3D&&r.useDepthPlane;u&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==me["a"].SCENE2D&&!s;const m=e.mode!==me["a"].SCENE3D||r.sunVisibleThroughGlobe?void 0:e.occluder;let d=e.cullingVolume;const h=ct.planes;for(let p=0;p<5;++p)h[p]=d.planes[p];d=ct,i.isSkyAtmosphereVisible=Object(p["a"])(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,d,m),i.isMoonVisible=this.isVisible(i.moonCommand,d,m);const l=this.specularEnvironmentMaps;let f=this._specularEnvironmentMapAtlas;!Object(p["a"])(l)||Object(p["a"])(f)&&f.url===l?!Object(p["a"])(l)&&Object(p["a"])(f)&&(f.destroy(),this._specularEnvironmentMapAtlas=void 0):(f=f&&f.destroy(),this._specularEnvironmentMapAtlas=new ae["a"](l)),Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},we.prototype.resolveFramebuffers=function(e){const t=this._context,i=this._environmentState,a=this._view,s=a.globeDepth;Object(p["a"])(s)&&s.prepareColorTextures(t);const o=i.useOIT,n=i.useGlobeDepthFramebuffer,r=i.usePostProcess,c=i.originalFramebuffer,u=n?s.colorFramebufferManager:void 0,m=a.sceneFramebuffer._colorFramebuffer,d=a.sceneFramebuffer.idFramebuffer;o&&(e.framebuffer=r?m.framebuffer:c,a.oit.execute(t,e));const h=a.translucentTileClassification;if(h.hasTranslucentDepth&&h.isSupported()&&h.execute(this,e),r){a.sceneFramebuffer.prepareColorTextures(t);let e=m;n&&!o&&(e=u);const i=this.postProcessStages,s=e.getColorTexture(0),r=d.getColorTexture(0),h=Object(l["a"])(u,m).getDepthStencilTexture();i.execute(t,s,h,r),i.copy(t,c)}o||r||!n||(e.framebuffer=c,s.executeCopyColor(t,e))},we.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=pt(this),this._cameraUnderground=ft(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),Object(p["a"])(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};const Ct=new u["a"];function St(e){const t=e._frameState,i=e.context,s=i.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Oe;let r=Object(l["a"])(e.backgroundColor,u["a"].BLACK);e._hdr&&(r=u["a"].clone(r,Ct),r.red=Math.pow(r.red,e.gamma),r.green=Math.pow(r.green,e.gamma),r.blue=Math.pow(r.blue,e.gamma)),t.backgroundColor=r,e.fog.update(t),s.update(t);const c=e.shadowMap;Object(p["a"])(c)&&c.enabled&&(!Object(p["a"])(e.light)||e.light instanceof _e["a"]?n["a"].negate(s.sunDirectionWC,e._shadowMapCamera.direction):n["a"].clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(c)),e._computeCommandList.length=0,e._overlayCommandList.length=0;const m=o.viewport;m.x=0,m.y=0,m.width=i.drawingBufferWidth,m.height=i.drawingBufferHeight;const d=o.passState;d.framebuffer=void 0,d.blendingEnabled=void 0,d.scissorTest=void 0,d.viewport=a["a"].clone(m,d.viewport),Object(p["a"])(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(d,r),e.resolveFramebuffers(d),d.framebuffer=void 0,ze(e,d),Object(p["a"])(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function vt(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function wt(e){return e._picking.updateMostDetailedRayPicks(e)}function Dt(e){const t=e._frameState;Ee.camera=t.camera,Ee.cullingVolume=t.cullingVolume;const i=e.primitives;i.updateForPass(t,Ee)}function yt(e){const t=e._frameState,i=t.camera;if(!i.canPreloadFlight())return;xe.camera=e.preloadFlightCamera,xe.cullingVolume=e.preloadFlightCullingVolume;const a=e.primitives;a.updateForPass(t,xe)}function Ot(e){e.primitives.updateForPass(e._frameState,Pe)}we.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);const t=this._frameState;t.newFrame=!1,Object(p["a"])(e)||(e=y["a"].now());const i=this._view.checkForCameraUpdates(this);let a=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===me["a"].MORPHING;if(!a&&Object(p["a"])(this.maximumRenderTimeChange)&&Object(p["a"])(this._lastRenderTime)){const t=Math.abs(y["a"].secondsDifference(this._lastRenderTime,e));a=a||t>this.maximumRenderTimeChange}if(a){this._lastRenderTime=y["a"].clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;const i=O["a"].incrementWrap(t.frameNumber,15e6,1);Ie(this,i,e),t.newFrame=!0}vt(this,gt),this.primitives.show&&(vt(this,wt),vt(this,Dt),vt(this,yt),a||vt(this,Ot)),this._postUpdate.raiseEvent(this,e),a&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),vt(this,St)),_t(this,a),vt(this,bt),lt(this),a&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},we.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},we.prototype.requestRender=function(){this._renderRequested=!0},we.prototype.clampLineWidth=function(e){return Math.max(N["a"].minimumAliasedLineWidth,Math.min(e,N["a"].maximumAliasedLineWidth))},we.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},we.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},we.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},we.prototype.drillPick=function(e,t,i,a){return this._picking.drillPick(this,e,t,i,a)},we.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},we.prototype.drillPickFromRay=function(e,t,i,a){return this._picking.drillPickFromRay(this,e,t,i,a)},we.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},we.prototype.drillPickFromRayMostDetailed=function(e,t,i,a){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,a)},we.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},we.prototype.clampToHeight=function(e,t,i,a){return this._picking.clampToHeight(this,e,t,i,a)},we.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},we.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},we.prototype.cartesianToCanvasCoordinates=function(e,t){return de["a"].wgs84ToWindowCoordinates(this,e,t)},we.prototype.completeMorph=function(){this._transitioner.completeMorph()},we.prototype.morphTo2D=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo2D(e,t)},we.prototype.morphToColumbusView=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphToColumbusView(e,t)},we.prototype.morphTo3D=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo3D(e,t)},we.prototype.isDestroyed=function(){return!1},we.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(p["a"])(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(_["a"])(this)},t["a"]=we}}]);