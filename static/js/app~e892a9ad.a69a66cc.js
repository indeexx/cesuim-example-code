(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app~e892a9ad"],{"18f1":function(e,t,i){"use strict";var n=i("4232"),o=i("62ba"),s=i("4042"),r=(i("d5a2"),i("2c46")),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"plot-draw-tip-container"},e._l(e.contents,(function(t,n){return i("div",{key:n},[e._v(e._s(t))])})),0)},l=[],c={name:"PlotDrawTip",props:{contents:{type:Array}}},h=c,u=(i("7858"),i("cba8")),p=Object(u["a"])(h,a,l,!1,null,"501c0994",null),d=p.exports,v=r["a"].extend(d),f=function(){function e(t){Object(o["a"])(this,e),this.viewer=t,this.vmInstance=new v({propsData:{contents:[]}}).$mount(),t.cesiumWidget.container.appendChild(this.vmInstance.$el),this.addPostRender()}return Object(s["a"])(e,[{key:"setContent",value:function(e){this.vmInstance.contents=e}},{key:"updatePosition",value:function(e){this.position=e}},{key:"addPostRender",value:function(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}},{key:"postRender",value:function(){if(this.vmInstance.$el&&this.vmInstance.$el.style&&this.position){var e=this.viewer.scene.canvas.height,t=new Cesium.Cartesian2;Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.vmInstance.$el.style.bottom=e-t.y-20+"px";this.vmInstance.$el.offsetWidth;this.vmInstance.$el.style.left=t.x+50+"px"}}},{key:"remove",value:function(){this.viewer.cesiumWidget.container.removeChild(this.vmInstance.$el),this.viewer.scene.postRender.removeEventListener(this.postRender,this)}}]),e}(),C=function(){function e(t){Object(o["a"])(this,e),this.viewer=t,this.addPoint()}return Object(s["a"])(e,[{key:"addPoint",value:function(){this.mousePointEntity=this.viewer.entities.add({point:{pixelSize:8,color:Cesium.Color.AQUA,outlineWidth:1,outlineColor:Cesium.Color.WHITE}})}},{key:"updatePosition",value:function(e){this.mousePointEntity.position=e}},{key:"remove",value:function(){this.viewer.entities.remove(this.mousePointEntity)}}]),e}(),g={ARC:"arc",ELLIPSE:"ellipse",CURVE:"curve",CLOSED_CURVE:"closedcurve",LUNE:"lune",SECTOR:"sector",GATHERING_PLACE:"gatheringplace",STRAIGHT_ARROW:"straightarrow",ASSAULT_DIRECTION:"assaultdirection",ATTACK_ARROW:"attackarrow",TAILED_ATTACK_ARROW:"tailedattackarrow",SQUAD_COMBAT:"squadcombat",TAILED_SQUAD_COMBAT:"tailedsquadcombat",FINE_ARROW:"finearrow",CIRCLE:"circle",DOUBLE_ARROW:"doublearrow",POLYLINE:"polyline",FREEHAND_LINE:"freehandline",POLYGON:"polygon",FREEHAND_POLYGON:"freehandpolygon",RECTANGLE:"rectangle",MARKER:"marker",TRIANGLE:"triangle"},m=g,y=i("0cc0"),P=i("ee8c");i("7a951");function w(e,t){return Cesium.Cartesian3.fromDegrees(e[0],e[1],t)}function E(e,t){var i=[];t=t||0;for(var n=0;n<e.length;n++)i.push(w(e[n],t));return i}function O(e){var t=Cesium.Cartographic.fromCartesian(e);return[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)]}var T=function(){function e(t,i){Object(o["a"])(this,e),this.viewer=t,this.properties=i.properties,this.properties.plotBase="MilitaryPlot",this.coordinates=i.geometry.coordinates,this.style=this.properties.style,this.initConsts(),this.setPoints(this.coordinates[0])}return Object(s["a"])(e,[{key:"initConsts",value:function(){}},{key:"openEditMode",value:function(e){}},{key:"setHeight",value:function(e){this.style.height=e}},{key:"getHeight",value:function(){return this.style.height}},{key:"setPoints",value:function(e){this.coordinates[0]=e||[],this.coordinates[0].length>=1&&this.generate()}},{key:"getPoints",value:function(){return this.coordinates[0].slice(0)}},{key:"getPointCount",value:function(){return this.coordinates[0].length}},{key:"generate",value:function(){}},{key:"generatePositions",value:function(e){this.positions=E(e,this.getHeight())}}]),e}(),M=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.POLYGON,s.properties.plotName="面",s.generateEntity(),s.minPointCount=3,s}return Object(s["a"])(i,[{key:"generateEntity",value:function(){this.polygonEntity=this.viewer.entities.add({plotType:this.properties.plotBase,plotCode:this.properties.plotCode,polygon:{hierarchy:new Cesium.PolygonHierarchy(this.positions||[]),material:Cesium.Color.YELLOW.withAlpha(.6),classificationType:Cesium.ClassificationType.BOTH}})}},{key:"setSelected",value:function(e){this.polygonEntity.polygon.material=e?Cesium.Color.RED.withAlpha(.8):Cesium.Color.YELLOW.withAlpha(.6)}},{key:"generate",value:function(){var e=this.getPointCount();e<2||this.generatePositions(this.coordinates[0])}},{key:"openEditMode",value:function(e){var t=this;e?(this.polygonEntity.polygon.hierarchy=new Cesium.CallbackProperty((function(e){return new Cesium.PolygonHierarchy(t.positions||[])}),!1),this.polygonEntity.polyline={positions:new Cesium.CallbackProperty((function(e){return t.positions&&t.positions.length>0?t.positions.concat(t.positions[0]):[]}),!1),width:2,clampToGround:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}):(this.polygonEntity.polygon.hierarchy=new Cesium.PolygonHierarchy(this.positions||[]),this.polygonEntity.polyline&&(this.polygonEntity.polyline.width=0))}},{key:"toGeoJson",value:function(){return{type:"Feature",properties:this.properties,geometry:{type:"Polygon",coordinates:this.coordinates}}}},{key:"remove",value:function(){this.viewer.entities.remove(this.polygonEntity)}}]),i}(T),A=(i("4a18"),i("8798"),i("88a8"),i("3a31"),i("ebfb"),i("a71d"),i("29b0"),i("18a6"),100),b=Math.PI/2,k=3e-6,S=(Math.PI,6378137),I=6356725,L=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},D=function(e){var t=0;return e&&Array.isArray(e)&&e.length>0&&e.forEach((function(i,n){n<e.length-1&&(t+=L(i,e[n+1]))})),t},R=function(e){return Math.pow(D(e),.99)},_=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},F=function(e,t){var i,n=Math.asin(Math.abs(t[1]-e[1])/L(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=n+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-n:t[1]<e[1]&&t[0]<e[0]?i=n:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-n),i},j=function(e,t,i){var n=F(t,e)-F(t,i);return n<0?n+2*Math.PI:n},N=function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])},W=function(e,t,i,n,o){e=Math.max(Math.min(e,1),0);var s=1-e,r=e*e,a=r*e,l=s*s,c=l*s,h=c*t[0]+3*l*e*i[0]+3*s*r*n[0]+a*o[0],u=c*t[1]+3*l*e*i[1]+3*s*r*n[1]+a*o[1];return[h,u]},H=function(e,t,i,n,o){var s=F(e,t),r=o?s+i:s-i,a=n*Math.cos(r),l=n*Math.sin(r);return[t[0]+a,t[1]+l]},B=function(e,t,i,n){var o=x(t,i,n),s=null,r=null,a=null,l=null,c=null,h=Math.sqrt(o[0]*o[0]+o[1]*o[1]),u=o[0]/h,p=o[1]/h,d=L(t,i),v=L(i,n);return h>k?N(t,i,n)?(a=e*d,l=i[0]-a*p,c=i[1]+a*u,s=[l,c],a=e*v,l=i[0]+a*p,c=i[1]-a*u,r=[l,c]):(a=e*d,l=i[0]+a*p,c=i[1]-a*u,s=[l,c],a=e*v,l=i[0]-a*p,c=i[1]+a*u,r=[l,c]):(l=i[0]+e*(t[0]-i[0]),c=i[1]+e*(t[1]-i[1]),s=[l,c],l=i[0]+e*(n[0]-i[0]),c=i[1]+e*(n[1]-i[1]),r=[l,c]),[s,r]},x=function(e,t,i){var n=e[0]-t[0],o=e[1]-t[1],s=Math.sqrt(n*n+o*o);n/=s,o/=s;var r=i[0]-t[0],a=i[1]-t[1],l=Math.sqrt(r*r+a*a);r/=l,a/=l;var c=n+r,h=o+a;return[c,h]},U=function(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,n=0;n<=1;n+=.01){for(var o=0,s=0,r=0;r<=i;r++){var a=K(i,r),l=Math.pow(n,r),c=Math.pow(1-n,i-r);o+=a*l*c*e[r][0],s+=a*l*c*e[r][1]}t.push([o,s])}return t.push(e[i]),t},G=function(e){var t=1;switch(e){case e<=1:t=1;break;case 2===e:t=2;break;case 3===e:t=6;break;case 24===e:t=24;break;case 5===e:t=120;break;default:for(var i=1;i<=e;i++)t*=i;break}return t},K=function(e,t){return G(e)/(G(t)*G(e-t))},q=function(e){if(e.length<=2)return e;var t=2,i=[],n=e.length-t-1;i.push(e[0]);for(var o=0;o<=n;o++)for(var s=0;s<=1;s+=.05){for(var r=0,a=0,l=0;l<=t;l++){var c=V(l,s);r+=c*e[o+l][0],a+=c*e[o+l][1]}i.push([r,a])}return i.push(e[e.length-1]),i},V=function(e,t){var i=0;return 0===e?i=Math.pow(t-1,2)/2:1===e?i=(-2*Math.pow(t,2)+2*t+1)/2:2===e&&(i=Math.pow(t,2)/2),i};var Y=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.CLOSED_CURVE,s.properties.plotName="曲线面",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.t=.3}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2))if(2==e)this.generatePositions(this.coordinates[0]);else{var t=this.getPoints();t.push(t[0],t[1]);for(var i=[],n=0;n<t.length-2;n++){var o=B(this.t,t[n],t[n+1],t[n+2]);i=i.concat(o)}e=i.length;i=[i[e-1]].concat(i.slice(0,e-1));var s=[];for(n=0;n<t.length-2;n++){var r=t[n],a=t[n+1];s.push(r);for(var l=0;l<=A;l++){var c=W(l/A,r,i[2*n],i[2*n+1],a);s.push(c)}s.push(a)}this.generatePositions(s)}}}]),i}(M),$=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.CIRCLE,s.properties.plotName="正圆",s.fixPointCount=2,s}return Object(s["a"])(i,[{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.coordinates[0][0],i=this.distance(t,this.coordinates[0][1]);this.generatePositions(this.generateCirclePoints(t,i))}}},{key:"distance",value:function(e,t){var i=e[1]*Math.PI/180,n=t[1]*Math.PI/180,o=i-n,s=e[0]*Math.PI/180-t[0]*Math.PI/180,r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(s/2),2)));return r*=6378.137,r=Math.round(1e4*r)/10,r}},{key:"generateCirclePoints",value:function(e,t){for(var i=[],n=0;n<360;n+=2)i.push(this.getCirclePoint(e[0],e[1],n,t));return i}},{key:"getCirclePoint",value:function(e,t,i,n){var o=n*Math.sin(i*Math.PI/180),s=n*Math.cos(i*Math.PI/180),r=I+(S-I)*(90-t)/90,a=r*Math.cos(t*Math.PI/180),l=180*(o/a+e*Math.PI/180)/Math.PI,c=180*(s/r+t*Math.PI/180)/Math.PI;return[l,c]}}]),i}(M),Q=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.ELLIPSE,s.properties.plotName="椭圆",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.fixPointCount=2}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.coordinates[0][0],i=this.coordinates[0][1],n=_(t,i),o=Math.abs((t[0]-i[0])/2),s=Math.abs((t[1]-i[1])/2);this.generatePositions(this.generatePoints(n,o,s))}}},{key:"generatePoints",value:function(e,t,i){for(var n,o,s,r=[],a=0;a<=A;a++)s=2*Math.PI*a/A,n=e[0]+t*Math.cos(s),o=e[1]+i*Math.sin(s),r.push([n,o]);return r}}]),i}(M),z=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.SECTOR,s.properties.plotName="扇形",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.fixPointCount=3}},{key:"generate",value:function(){if(!(this.getPointCount()<2))if(2==this.getPointCount())this.generatePositions(this.coordinates[0]);else{var e=this.getPoints(),t=e[0],i=e[1],n=e[2],o=(L(i,t),F(i,t)),s=F(n,t),r=180*o/3.14,a=180*s/3.14,l=this.distance(i,t),c=this.generatSectorPoints(t,l,r,a);c.push(t,c[0]),this.generatePositions(c)}}},{key:"distance",value:function(e,t){var i=e[1]*Math.PI/180,n=t[1]*Math.PI/180,o=i-n,s=e[0]*Math.PI/180-t[0]*Math.PI/180,r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(s/2),2)));return r*=6378.137,r=Math.round(1e4*r)/10,r}},{key:"generatSectorPoints",value:function(e,t,i,n){i=90-i,n=90-n;var o=[];if(i<n)for(var s=i;s<n;s+=2)o.push(this.getCirclePoint(e[0],e[1],s,t));else for(var r=i;r>n;r-=2)o.push(this.getCirclePoint(e[0],e[1],r,t));return o}},{key:"getCirclePoint",value:function(e,t,i,n){var o=n*Math.sin(i*Math.PI/180),s=n*Math.cos(i*Math.PI/180),r=I+(S-I)*(90-t)/90,a=r*Math.cos(t*Math.PI/180),l=180*(o/a+e*Math.PI/180)/Math.PI,c=180*(s/r+t*Math.PI/180)/Math.PI;return[l,c]}}]),i}(M),J=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.RECTANGLE,s.properties.plotName="矩形",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.fixPointCount=2}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.coordinates[0][0],i=this.coordinates[0][1],n=Math.min(t[0],i[0]),o=Math.max(t[0],i[0]),s=Math.min(t[1],i[1]),r=Math.max(t[1],i[1]),a=[n,r],l=[o,r],c=[o,s],h=[n,s];this.generatePositions([a,l,c,h])}}}]),i}(M),X=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.FINE_ARROW,s.properties.plotName="直箭头",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.tailWidthFactor=.1,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.fixPointCount=2}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.getPoints(),i=t[0],n=t[1],o=R(t),s=o*this.tailWidthFactor,r=o*this.neckWidthFactor,a=o*this.headWidthFactor,l=H(n,i,b,s,!0),c=H(n,i,b,s,!1),h=H(i,n,this.headAngle,a,!1),u=H(i,n,this.headAngle,a,!0),p=H(i,n,this.neckAngle,r,!1),d=H(i,n,this.neckAngle,r,!0),v=[l,p,h,n,u,d,c];this.generatePositions(v)}}}]),i}(M),Z=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.ASSAULT_DIRECTION,s.properties.plotName="突击方向",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI,this.fixPointCount=2}}]),i}(X),ee=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.ATTACK_ARROW,s.properties.plotName="进攻方向",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8}},{key:"generate",value:function(){if(!(this.getPointCount()<2))if(2!=this.getPointCount()){var e=this.getPoints(),t=e[0],i=e[1];N(e[0],e[1],e[2])&&(t=e[1],i=e[0]);var n=_(t,i),o=[n].concat(e.slice(2)),s=this.getArrowHeadPoints(o,t,i),r=s[0],a=s[4],l=L(t,i)/R(o),c=this.getArrowBodyPoints(o,r,a,l),h=c.length,u=[t].concat(c.slice(0,h/2));u.push(r);var p=[i].concat(c.slice(h/2,h));p.push(a),u=q(u),p=q(p),this.generatePositions(u.concat(s,p.reverse()))}else this.generatePositions(this.coordinates[0])}},{key:"getArrowHeadPoints",value:function(e,t,i){var n=R(e),o=n*this.headHeightFactor,s=e[e.length-1];n=L(s,e[e.length-2]);var r=L(t,i);o>r*this.headTailFactor&&(o=r*this.headTailFactor);var a=o*this.headWidthFactor,l=o*this.neckWidthFactor;o=o>n?n:o;var c=o*this.neckHeightFactor,h=H(e[e.length-2],s,0,o,!0),u=H(e[e.length-2],s,0,c,!0),p=H(s,h,b,a,!1),d=H(s,h,b,a,!0),v=H(s,u,b,l,!1),f=H(s,u,b,l,!0);return[v,p,s,d,f]}},{key:"getArrowBodyPoints",value:function(e,t,i,n){for(var o=D(e),s=R(e),r=s*n,a=L(t,i),l=(r-a)/2,c=0,h=[],u=[],p=1;p<e.length-1;p++){var d=j(e[p-1],e[p],e[p+1])/2;c+=L(e[p-1],e[p]);var v=(r/2-c/o*l)/Math.sin(d),f=H(e[p-1],e[p],Math.PI-d,v,!0),C=H(e[p-1],e[p],d,v,!1);h.push(f),u.push(C)}return h.concat(u)}}]),i}(M),te=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.TAILED_ATTACK_ARROW,s.properties.plotName="进攻方向尾",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=null}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2))if(2!=this.getPointCount()){var t=this.getPoints(),i=t[0],n=t[1];N(t[0],t[1],t[2])&&(i=t[1],n=t[0]);var o=_(i,n),s=[o].concat(t.slice(2)),r=this.getArrowHeadPoints(s,i,n),a=r[0],l=r[4],c=L(i,n),h=R(s),u=h*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=H(s[1],s[0],0,u,!0);var p=c/h,d=this.getArrowBodyPoints(s,a,l,p),v=(e=d.length,[i].concat(d.slice(0,e/2)));v.push(a);var f=[n].concat(d.slice(e/2,e));f.push(l),v=q(v),f=q(f),this.generatePositions(v.concat(r,f.reverse(),[this.swallowTailPnt,v[0]]))}else this.generatePositions(this.coordinates[0])}}]),i}(ee),ie=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.DOUBLE_ARROW,s.properties.plotName="钳击",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.fixPointCount=4}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2))if(2!=e){var t,i,n=this.coordinates[0][0],o=this.coordinates[0][1],s=this.coordinates[0][2];e=this.getPointCount();this.tempPoint4=3==e?this.getTempPoint4(n,o,s):this.coordinates[0][3],this.connPoint=3==e||4==e?_(n,o):this.coordinates[0][4],N(n,o,s)?(t=this.getArrowPoints(n,this.connPoint,this.tempPoint4,!1),i=this.getArrowPoints(this.connPoint,o,s,!0)):(t=this.getArrowPoints(o,this.connPoint,s,!1),i=this.getArrowPoints(this.connPoint,n,this.tempPoint4,!0));var r=t.length,a=(r-5)/2,l=t.slice(0,a),c=t.slice(a,a+5),h=t.slice(a+5,r),u=i.slice(0,a),p=i.slice(a,a+5),d=i.slice(a+5,r);u=U(u);var v=U(d.concat(l.slice(1)));h=U(h);var f=u.concat(p,v,c,h);this.generatePositions(f)}else this.generatePositions(this.coordinates[0])}},{key:"getArrowPoints",value:function(e,t,i,n){var o=_(e,t),s=L(o,i),r=H(i,o,0,.3*s,!0),a=H(i,o,0,.5*s,!0);r=H(o,r,b,s/5,n),a=H(o,a,b,s/4,n);var l=[o,r,a,i],c=this.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=c[0],u=c[4],p=L(e,t)/R(l)/2,d=this.getArrowBodyPoints(l,h,u,p),v=d.length,f=d.slice(0,v/2),C=d.slice(v/2,v);return f.push(h),C.push(u),f=f.reverse(),f.push(t),C=C.reverse(),C.push(e),f.reverse().concat(c,C)}},{key:"getArrowHeadPoints",value:function(e,t,i){var n=R(e),o=n*this.headHeightFactor,s=e[e.length-1],r=(L(t,i),o*this.headWidthFactor),a=o*this.neckWidthFactor,l=o*this.neckHeightFactor,c=H(e[e.length-2],s,0,o,!0),h=H(e[e.length-2],s,0,l,!0),u=H(s,c,b,r,!1),p=H(s,c,b,r,!0),d=H(s,h,b,a,!1),v=H(s,h,b,a,!0);return[d,u,s,p,v]}},{key:"getArrowBodyPoints",value:function(e,t,i,n){for(var o=D(e),s=R(e),r=s*n,a=L(t,i),l=(r-a)/2,c=0,h=[],u=[],p=1;p<e.length-1;p++){var d=j(e[p-1],e[p],e[p+1])/2;c+=L(e[p-1],e[p]);var v=(r/2-c/o*l)/Math.sin(d),f=H(e[p-1],e[p],Math.PI-d,v,!0),C=H(e[p-1],e[p],d,v,!1);h.push(f),u.push(C)}return h.concat(u)}},{key:"getTempPoint4",value:function(e,t,i){var n,o,s,r,a=_(e,t),l=L(a,i),c=j(e,a,i);return c<b?(o=l*Math.sin(c),s=l*Math.cos(c),r=H(e,a,b,o,!1),n=H(a,r,b,s,!0)):c>=b&&c<Math.PI?(o=l*Math.sin(Math.PI-c),s=l*Math.cos(Math.PI-c),r=H(e,a,b,o,!1),n=H(a,r,b,s,!1)):c>=Math.PI&&c<1.5*Math.PI?(o=l*Math.sin(c-Math.PI),s=l*Math.cos(c-Math.PI),r=H(e,a,b,o,!0),n=H(a,r,b,s,!0)):(o=l*Math.sin(2*Math.PI-c),s=l*Math.cos(2*Math.PI-c),r=H(e,a,b,o,!0),n=H(a,r,b,s,!1)),n}}]),i}(M),ne=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.GATHERING_PLACE,s.properties.plotName="集结地",s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.t=.4,this.fixPointCount=3}},{key:"generate",value:function(){var e=this.getPoints();if(!(e.length<2)){if(2==this.getPointCount()){var t=_(e[0],e[1]),i=L(e[0],t)/.9,n=H(e[0],t,b,i,!0);e=[e[0],n,e[1]]}t=_(e[0],e[2]);e.push(t,e[0],e[1]);for(var o=[],s=0;s<e.length-2;s++){var r=e[s],a=e[s+1],l=e[s+2],c=B(this.t,r,a,l);o=o.concat(c)}var h=o.length;o=[o[h-1]].concat(o.slice(0,h-1));var u=[];for(s=0;s<e.length-2;s++){r=e[s],a=e[s+1],u.push(r);for(var p=0;p<=A;p++){n=W(p/A,r,o[2*s],o[2*s+1],a);u.push(n)}u.push(a)}this.generatePositions(u)}}}]),i}(M),oe=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n,s){var r;return Object(o["a"])(this,i),r=t.call(this,e,n,s),r.properties.plotType=m.SQUAD_COMBAT,r.properties.plotName="分队战斗",r.minPointCount=2,r}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.getPoints(),i=this.getTailPoints(t),n=this.getArrowHeadPoints(t,i[0],i[1]),o=n[0],s=n[4],r=this.getArrowBodyPoints(t,o,s,this.tailWidthFactor),a=(e=r.length,[i[0]].concat(r.slice(0,e/2)));a.push(o);var l=[i[1]].concat(r.slice(e/2,e));l.push(s),a=q(a),l=q(l),this.generatePositions(a.concat(n,l.reverse()))}}},{key:"getTailPoints",value:function(e){var t=R(e),i=t*this.tailWidthFactor,n=H(e[1],e[0],b,i,!1),o=H(e[1],e[0],b,i,!0);return[n,o]}}]),i}(ee),se=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.TAILED_SQUAD_COMBAT,s.properties.plotName="分队战斗尾",s.minPointCount=2,s}return Object(s["a"])(i,[{key:"initConsts",value:function(){this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null}},{key:"generate",value:function(){var e=this.getPointCount();if(!(e<2)){var t=this.getPoints(),i=this.getTailPoints(t),n=this.getArrowHeadPoints(t,i[0],i[2]),o=n[0],s=n[4],r=this.getArrowBodyPoints(t,o,s,this.tailWidthFactor),a=(e=r.length,[i[0]].concat(r.slice(0,e/2)));a.push(o);var l=[i[2]].concat(r.slice(e/2,e));l.push(s),a=q(a),l=q(l),this.generatePositions(a.concat(n,l.reverse(),[i[1],a[0]]))}}},{key:"getTailPoints",value:function(e){var t=R(e),i=t*this.tailWidthFactor,n=H(e[1],e[0],b,i,!1),o=H(e[1],e[0],b,i,!0),s=i*this.swallowTailFactor,r=H(e[1],e[0],0,s,!0);return[n,r,o]}}]),i}(ee),re=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n){var s;return Object(o["a"])(this,i),s=t.call(this,e,n),s.properties.plotType=m.MARKER,s.properties.plotName="Marker",s.generateEntity(),s.fixPointCount=1,s}return Object(s["a"])(i,[{key:"generateEntity",value:function(){var e=this;this.markerEntity=this.viewer.entities.add({plotType:this.properties.plotBase,plotCode:this.properties.plotCode,position:new Cesium.CallbackProperty((function(t){return e.positions[0]}),!1),billboard:{image:"../../../static/images/Plot/location.png",scaleByDistance:new Cesium.NearFarScalar(300,1,1200,.4),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM}})}},{key:"toGeoJson",value:function(){return{type:"Feature",properties:this.properties,geometry:{type:"Point",coordinates:this.coordinates}}}},{key:"generate",value:function(){var e=this.getPointCount();e<1||this.generatePositions(this.coordinates[0])}},{key:"remove",value:function(){this.viewer.entities.remove(this.markerEntity)}}]),i}(T),ae=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e,n,s){var r;return Object(o["a"])(this,i),r=t.call(this,e,n,s),r.baseInfo.plotName=m.POLYLINE,r.minPointCount=2,r.generateEntity(),r}return Object(s["a"])(i,[{key:"generateEntity",value:function(){var e=this;this.lineEntity=this.viewer.entities.add({plotType:"MilitaryPlot",plotCode:this.baseInfo.plotCode,polyline:{positions:new Cesium.CallbackProperty((function(t){return e.positions}),!1)}})}},{key:"generate",value:function(){var e=this.getPointCount();e<2||this.generatePositions(this.points)}},{key:"remove",value:function(){this.viewer.entities.remove(this.lineEntity)}}]),i}(T),le={createPlot:function(e,t,i){switch(t){case m.POLYGON:return new M(e,i);case m.DOUBLE_ARROW:return new ie(e,i);case m.ATTACK_ARROW:return new ee(e,i);case m.ELLIPSE:return new Q(e,i);case m.CIRCLE:return new $(e,i);case m.FINE_ARROW:return new X(e,i);case m.TAILED_ATTACK_ARROW:return new te(e,i);case m.ASSAULT_DIRECTION:return new Z(e,i);case m.GATHERING_PLACE:return new ne(e,i);case m.CLOSED_CURVE:return new Y(e,i);case m.SECTOR:return new z(e,i);case m.RECTANGLE:return new J(e,i);case m.SQUAD_COMBAT:return new oe(e,i);case m.TAILED_SQUAD_COMBAT:return new se(e,i);case m.MARKER:return new re(e,i);case m.POLYLINE:return new ae(e,i)}}},ce=le;function he(){var e=new Date,t=e.getFullYear()+"";return t+=e.getMonth()+1,t+=e.getDate(),t+=e.getHours(),t+=e.getMinutes(),t+=e.getSeconds(),t+=e.getMilliseconds(),t}var ue=function(){function e(t){Object(o["a"])(this,e),this.viewer=t,this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.initEvents()}return Object(s["a"])(e,[{key:"activate",value:function(e){this.plotType=e,this.clear(),this.points=[],this.plotDrawTip=new f(this.viewer),this.MousePoint=new C(this.viewer),this.registerEvents(),this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="default",this.initMouseTip(),this.PlotDrawStartEvent.raiseEvent()}},{key:"initMouseTip",value:function(){var e=this.getPlotNam(),t="按下鼠标右键取消绘制",i="按下鼠标左键确定第一个点的位置";switch(this.plotType){case m.MARKER:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要1个点","按下鼠标左键确定位置",t]);break;case m.POLYLINE:case m.SQUAD_COMBAT:case m.TAILED_SQUAD_COMBAT:this.plotDrawTip.setContent(["当前绘制类型："+e+"，最少需要2个点",i,t]);break;case m.ELLIPSE:case m.CIRCLE:case m.RECTANGLE:case m.FINE_ARROW:case m.ASSAULT_DIRECTION:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要2个点",i,t]);break;case m.POLYGON:case m.ATTACK_ARROW:case m.TAILED_ATTACK_ARROW:case m.CLOSED_CURVE:this.plotDrawTip.setContent(["当前绘制类型："+e+"，最少需要3个点",i,t]);break;case m.GATHERING_PLACE:case m.SECTOR:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要3个点",i,t]);break;case m.DOUBLE_ARROW:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要4个点",i,t]);break}}},{key:"getPlotNam",value:function(){switch(this.plotType){case m.MARKER:return"点";case m.POLYLINE:return"线";case m.POLYGON:return"面";case m.ELLIPSE:return"椭圆";case m.CIRCLE:return"正圆";case m.RECTANGLE:return"矩形";case m.CLOSED_CURVE:return"曲线面";case m.SECTOR:return"扇形";case m.FINE_ARROW:return"直箭头";case m.ASSAULT_DIRECTION:return"突击方向";case m.ATTACK_ARROW:return"点进攻方向";case m.TAILED_ATTACK_ARROW:return"进攻方向尾";case m.GATHERING_PLACE:return"集结地";case m.SQUAD_COMBAT:return"分队作战";case m.TAILED_SQUAD_COMBAT:return"分队作战尾";case m.DOUBLE_ARROW:return"钳击"}}},{key:"deactivate",value:function(){this.unRegisterEvents(),this.plotType=void 0,this.viewer._element.style.cursor="pointer",this.viewer.enableCursorStyle=!0,this.plotDrawTip&&(this.plotDrawTip.remove(),this.MousePoint.remove(),this.plotDrawTip=void 0,this.MousePoint=void 0)}},{key:"clear",value:function(){this.plot&&(this.plot.remove(),this.plot=void 0)}},{key:"generatePlot",value:function(e,t){var i=he(),n={type:"Feature",properties:{plotCode:i,style:{height:t}},geometry:{type:"Polygon",coordinates:[e]}};this.plot=ce.createPlot(this.viewer,this.plotType,n),this.plot.openEditMode(!0)}},{key:"initEvents",value:function(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.PlotDrawStartEvent=new Cesium.Event,this.PlotDrawEndEvent=new Cesium.Event}},{key:"registerEvents",value:function(){this.leftClickEvent(),this.rightClickEvent(),this.mouseMoveEvent()}},{key:"leftClickEvent",value:function(){var e=this;this.handler.setInputAction((function(t){e.viewer._element.style.cursor="default";var i=e.viewer.scene.pickPosition(t.position);if(i||(i=e.viewer.scene.camera.pickEllipsoid(t.position,e.viewer.scene.globe.ellipsoid)),i){var n=O(i),o=Cesium.Cartographic.fromCartesian(i);if(0==e.points.length)e.points.push(n),e.generatePlot(e.points,o.height);else{if(L(n,e.points[e.points.length-1])<k)return;e.points.push(n),e.plot.setPoints(e.points)}e.setMouseTipContent(),e.plot.fixPointCount==e.points.length&&(e.drawEnd(),e.deactivate())}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}},{key:"setMouseTipContent",value:function(){var e=this.getPlotNam();switch(this.plotType){case m.POLYLINE:case m.SQUAD_COMBAT:case m.TAILED_SQUAD_COMBAT:this.plotDrawTip.setContent(["当前绘制类型："+e+"，最少需要2个点","已有"+this.points.length+"个点，按下鼠标左键确定第"+(this.points.length+1)+"个点",,this.points.length<2?"按下鼠标右键取消绘制":"按下鼠标右键结束绘制"]);break;case m.ELLIPSE:case m.CIRCLE:case m.RECTANGLE:case m.FINE_ARROW:case m.ASSAULT_DIRECTION:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要2个点","已有"+this.points.length+"个点，按下鼠标左键确定第"+(this.points.length+1)+"个点",,"按下鼠标右键取消绘制"]);break;case m.POLYGON:case m.ATTACK_ARROW:case m.TAILED_ATTACK_ARROW:case m.CLOSED_CURVE:this.plotDrawTip.setContent(["当前绘制类型："+e+"，最少需要3个点","已有"+this.points.length+"个点，按下鼠标左键确定第"+(this.points.length+1)+"个点",,this.points.length<3?"按下鼠标右键取消绘制":"按下鼠标右键结束绘制"]);break;case m.GATHERING_PLACE:case m.SECTOR:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要3个点","已有"+this.points.length+"个点，按下鼠标左键确定第"+(this.points.length+1)+"个点",,"按下鼠标右键取消绘制"]);break;case m.DOUBLE_ARROW:this.plotDrawTip.setContent(["当前绘制类型："+e+"，需要4个点","已有"+this.points.length+"个点，按下鼠标左键确定第"+(this.points.length+1)+"个点",,"按下鼠标右键取消绘制"]);break}}},{key:"mouseMoveEvent",value:function(){var e=this;this.handler.setInputAction((function(t){var i=e.viewer.scene.pickPosition(t.endPosition);if(i||(i=e.viewer.scene.camera.pickEllipsoid(t.endPosition,e.viewer.scene.globe.ellipsoid)),i&&(e.plotDrawTip.updatePosition(i),e.MousePoint.updatePosition(i),e.plot)){var n=O(i);if(!(L(n,e.points[e.points.length-1])<k)){var o=e.points.concat([n]);e.plot.setPoints(o)}}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"rightClickEvent",value:function(){var e=this;this.handler.setInputAction((function(t){0!=e.points.length?e.plot.fixPointCount?e.points.length==e.plot.fixPointCount?(e.plot.setPoints(e.points),e.drawEnd(),e.deactivate()):(e.deactivate(),e.clear()):e.points.length>=e.plot.minPointCount?(e.plot.setPoints(e.points),e.drawEnd(),e.deactivate()):(e.deactivate(),e.clear()):e.deactivate()}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"unRegisterEvents",value:function(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"drawEnd",value:function(){this.plot.openEditMode(!1),this.PlotDrawEndEvent.raiseEvent(this.plot,this.plotType)}}]),e}(),pe=(i("a0d4"),function(){function e(t){Object(o["a"])(this,e),this.viewer=t,this.plots=[],this.plotSelecteable=!1}return Object(s["a"])(e,[{key:"setPlotSelectable",value:function(e){this.plotSelecteable=e}},{key:"initPlots",value:function(e){}},{key:"addPlot",value:function(e){}},{key:"removeByPlotCode",value:function(e){for(var t=0;t<this.plots.length;t++)if(this.plots[t].properties.plotCode==e)return this.plots[t].remove(),void this.plots.splice(t,1)}},{key:"getByPlotCode",value:function(e){for(var t=0;t<this.plots.length;t++)if(this.plots[t].properties.plotCode==e)return this.plots[t]}},{key:"removeAll",value:function(){this.clear()}},{key:"clear",value:function(){this.plots.forEach((function(e){e.remove()})),this.plots=[]}}]),e}()),de=function(e){Object(y["a"])(i,e);var t=Object(P["a"])(i);function i(e){var n;return Object(o["a"])(this,i),n=t.call(this,e),n.selectedPlotChanged=new Cesium.Event,n.initEvent(),n}return Object(s["a"])(i,[{key:"addPlot",value:function(e){var t=ce.createPlot(this.viewer,e.properties.plotType,e);return this.plots.push(t),t}},{key:"flyToByPlotCode",value:function(e){var t=this,i=this.getByPlotCode(e);if(i){this.setSelectedPlot(i);var n=this.viewer.entities.add({polygon:{hierarchy:i.positions,perPositionHeight:!0,material:Cesium.Color.YELLOW.withAlpha(.001),outline:!1}});this.viewer.flyTo(n).then((function(){t.viewer.entities.remove(n)}))}}},{key:"setSelectedPlot",value:function(e){this.plotSelecteable&&(this.selectedPlot&&this.selectedPlot.setSelected(!1),this.selectedPlot=e,this.selectedPlot.setSelected(!0),this.selectedPlotChanged.raiseEvent(e))}},{key:"clearSelectedPlot",value:function(){this.selectedPlot&&(this.selectedPlot.setSelected(!1),this.selectedPlot.openEditMode(!1),this.selectedPlot=void 0)}},{key:"initEvent",value:function(){var e=this;new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas).setInputAction((function(t){if(e.plotSelecteable){var i=e.viewer.scene.pick(t.position);if(i&&i.id){if(i.id&&i.id.type&&"MilitaryPlot"==i.id.type||e.selectedPlot&&(e.selectedPlot.setSelected(!1),e.selectedPlot=void 0,e.selectedPlotChanged.raiseEvent(void 0)),!e.selectedPlot||e.selectedPlot.properties.plotCode!=i.id.plotCode){var n=e.getByPlotCode(i.id.plotCode);n?(e.selectedPlot=n,e.selectedPlot.setSelected(!0),e.selectedPlotChanged.raiseEvent(n)):(e.selectedPlot&&(e.selectedPlot.setSelected(!1),e.selectedPlot=void 0),e.selectedPlotChanged.raiseEvent(void 0))}}else e.selectedPlot&&(e.selectedPlot.setSelected(!1),e.selectedPlot=void 0,e.selectedPlotChanged.raiseEvent(void 0))}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}}]),i}(pe);i("82ae"),t["a"]={data:function(){return{name:"geodrawminix",option:null}},methods:{initDrawTool:function(){var e=this;this.drawTool=new n["a"](viewer),this.drawTool.DrawEndEvent.addEventListener((function(t,i,n){t.remove(),e.addDrawResult(i,n),console.log("绘制类型："+n+"结果如下"),console.log(i)}))},initPlot:function(){var e=this;this.plotDraw=new ue(viewer),this.militaryPlotLayer=new de(viewer),this.militaryPlotLayer.setPlotSelectable(!0),this.plotDraw.PlotDrawEndEvent.addEventListener((function(t,i){t.remove(),e.militaryPlotLayer.addPlot(t.toGeoJson())}))},addDrawResult:function(e,t){switch(t){case"Point":this.generatePoint(e);break;case"Polyline":this.generatePolyline(e);break;case"Polygon":this.generatePolygon(e);break}},generatePoint:function(e){viewer.entities.add({position:e[0],billboard:{image:"../../static/images/poi/sp.png",scaleByDistance:new Cesium.NearFarScalar(300,1,1200,.4),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM}})},generatePolyline:function(e){var t=document.querySelector("[name=line]>.imgBox .selected").dataset.type,i=null;switch(t){case"solid":i=Cesium.Color.fromCssColorString(document.querySelector("[name=line] [name=color]").value);break;case"dash":i=new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(document.querySelector("[name=line] [name=color]").value)});break;default:break}viewer.entities.add({name:document.querySelector("[name=line] [name=title]").value,polyline:{positions:e,width:document.querySelector("[name=line] [name=width]").value,material:i,depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString(document.querySelector("[name=line] [name=color]").value)})}})},generatePolygon:function(e){var t=Cesium.Color.fromCssColorString(document.querySelector("[name=polygon] [name=fillColor]").value);t.alpha=document.querySelector("[name=polygon] [name=Opacity]").value;viewer.entities.add({name:document.querySelector("[name=polygon] [name=title]").value,polygon:{hierarchy:e,material:t,outline:!0,outlineColor:Cesium.Color.fromCssColorString(document.querySelector("[name=polygon] [name=edgeColor]").value),perPositionHeight:!0,extrudedHeight:.5}})},drawActivate:function(e){this.drawTool.activate(e)},activateMiliDraw:function(e){this.plotDraw.activate(e)},clearDraw:function(){viewer.entities.removeAll(),this.militaryPlotLayer.clear()}}}},"2c6d":function(e,t,i){},7858:function(e,t,i){"use strict";i("2c6d")},db04:function(e,t,i){"use strict";i("d656"),i("8798"),i("88a8"),i("d7b9");t["a"]={entities:[],measureLineSpace:function(e,t){window.measureing=!0;var i=this;e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t=new Cesium.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);var n,o=[],s=null,r=0,a=null;t.setInputAction((function(t){a=e.scene.pickPosition(t.endPosition),o.length>=2&&(Cesium.defined(s)?(o.pop(),o.push(a)):s=new l(o),r=c(o))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction((function(t){a=e.scene.pickPosition(t.position),0==o.length&&o.push(a.clone()),o.push(a);var s=r+"米";n=e.entities.add({name:"空间直线距离",position:o[o.length-1],point:{pixelSize:5,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2},label:{text:s,font:"18px sans-serif",fillColor:Cesium.Color.GOLD,style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(20,-20)}}),i.entities.push(n)}),Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction((function(e){t.destroy(),o.pop(),window.measureing=!1,document.documentElement.style.cursor="default"}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);var l=function(){function t(e){this.options={name:"直线",polyline:{show:!0,positions:[],material:Cesium.Color.CHARTREUSE,width:10,clampToGround:!1}},this.positions=e,this._init()}return t.prototype._init=function(){var t=this,n=function(){return t.positions};this.options.polyline.positions=new Cesium.CallbackProperty(n,!1);var o=e.entities.add(this.options);i.entities.push(o)},t}();function c(e){for(var t=0,i=0;i<e.length-1;i++){var n=Cesium.Cartographic.fromCartesian(e[i]),o=Cesium.Cartographic.fromCartesian(e[i+1]),s=new Cesium.EllipsoidGeodesic;s.setEndPoints(n,o);var r=s.surfaceDistance;r=Math.sqrt(Math.pow(r,2)+Math.pow(o.height-n.height,2)),t+=r}return t.toFixed(2)}},measureAreaSpace:function(e,t){window.measureing=!0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t=new Cesium.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);var i,n=[],o=[],s=null,r=null,a=this;t.setInputAction((function(t){r=e.scene.pickPosition(t.endPosition),n.length>=2&&(Cesium.defined(s)?(n.pop(),n.push(r)):s=new d(n))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction((function(t){r=e.scene.pickPosition(t.position),0==n.length&&n.push(r.clone()),n.push(r);var s=Cesium.Cartographic.fromCartesian(n[n.length-1]),l=Cesium.Math.toDegrees(s.longitude),c=Cesium.Math.toDegrees(s.latitude),h=s.height;o.push({lon:l,lat:c,hei:h}),i=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2,heightReference:Cesium.HeightReference.NONE}}),a.entities.push(i)}),Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction((function(i){t.destroy(),n.pop();var s=h(o),r=e.scene.pickPosition(i.position),l=e.entities.add({name:"多边形面积",position:r,label:{text:s,font:"18px sans-serif",fillColor:Cesium.Color.GOLD,style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(20,-40)}});a.entities.push(l),window.measureing=!1,document.documentElement.style.cursor="default"}),Cesium.ScreenSpaceEventType.RIGHT_CLICK);var l=Math.PI/180,c=180/Math.PI;function h(e){for(var t=0,i=0;i<e.length-2;i++){var o=(i+1)%e.length,s=(i+2)%e.length,r=u(e[i],e[o],e[s]),a=v(n[i],n[o]),l=v(n[o],n[s]);t+=a*l*Math.abs(Math.sin(r)),console.log(t)}return t>1e6?(t/1e6).toFixed(3)+"平方公里":t.toFixed(3)+"平方米"}function u(e,t,i){var n=p(t,e),o=p(t,i),s=n-o;return s<0&&(s+=360),s}function p(e,t){var i=e.lat*l,n=e.lon*l,o=t.lat*l,s=t.lon*l,r=-Math.atan2(Math.sin(n-s)*Math.cos(o),Math.cos(i)*Math.sin(o)-Math.sin(i)*Math.cos(o)*Math.cos(n-s));return r<0&&(r+=2*Math.PI),r*=c,r}var d=function(){function t(e){this.options={name:"多边形",polygon:{hierarchy:[],material:Cesium.Color.GREEN.withAlpha(.5)}},this.hierarchy={positions:e},this._init()}return t.prototype._init=function(){var t=this,i=function(){return t.hierarchy};this.options.polygon.hierarchy=new Cesium.CallbackProperty(i,!1);var n=e.entities.add(this.options);a.entities.push(n)},t}();function v(e,t){var i=Cesium.Cartographic.fromCartesian(e),n=Cesium.Cartographic.fromCartesian(t),o=new Cesium.EllipsoidGeodesic;o.setEndPoints(i,n);var s=o.surfaceDistance;return s=Math.sqrt(Math.pow(s,2)+Math.pow(n.height-i.height,2)),s}},clearAll:function(){this.entities.forEach((function(e){e.show=!1,viewer.entities.remove(e)})),window.measureing=!1,document.documentElement.style.cursor="default"}}},ed0a:function(e,t,i){"use strict";var n=i("66b1"),o=(i("8798"),i("88a8"),i("3e65"),i("2f9e"),i("34bc"),i("a71d"),i("18a6"),i("4ff3")),s=i.n(o),r=(i("2cae"),i("7595")),a={sceneModel:"outdoor",outdoorDataset:null,indoorDataset:null,otherDatasetArr:[],eventHandler:null,selectFloorName:"",selectBuildFeature:null,floorEntity:null,floorConfigs:{},toBuildInfoFun:null,toHomeFun:null,floorName:"",structShowState:{"墙":!0,"门":!0,"结构柱":!0,"窗":!0,"幕墙嵌板":!0,"栏杆扶手":!0,"楼板":!0,"常规模型":!0,"幕墙竖梃":!0,"楼梯":!0},addFloorLabel:!1,loadOutdoorModel:function(){var e=viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:"https://xdata-1251202940.cos.ap-guangzhou.myqcloud.com/3dtiles/sgbd/qxsy/tileset.json",modelMatrix:Cesium.Matrix4.fromArray([.9872182048248306,.08568055204034175,-.13438399854335717,0,-.032586267791304024,.933899102308549,.3560485947995295,0,.15600753575988638,-.3471185816249952,.9247542046818605,0,-1160.1974571812898,2581.4528367621824,-15025.367700870614,1])})),t={destination:{x:-2405178.572459869,y:5381404.211059531,z:2429385.1386184245},duration:.5,orientation:{heading:.06967072816405206,pitch:-.2745573701027455,roll:.0001716655269072831}};viewer.camera.flyTo(t),e.skipLevelOfDetail=!0,e.preferLeaves=!0,e.maximumMemoryUsage=2e3,this.outdoorDataset=e,e.allTilesLoaded.addEventListener((function(){a.indoorDataset||a.loadIndoorModel()})),this.initLeftClickHandler()},laodTreeModel:function(){var e=viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:"http://localhost:9000/model/7d700b70c77811ebba07b157128873b7/tileset.json"}));a.otherDatasetArr.push(e)},loadAroundBox:function(){var e=viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:"http://localhost:9000/model/cd8755e0b94611eba646d131ed2b2fa0/tileset.json"}));e.readyPromise.then((function(e){e.tileVisible.addEventListener((function(e){for(var t=e.content,i=t.featuresLength,n=function(){var e=t.getFeature(o),i=e.content._model;i&&i._sourcePrograms&&i._rendererResources&&(Object.keys(i._sourcePrograms).forEach((function(e){var t=i._sourcePrograms[e];i._rendererResources.sourceShaders[t.fragmentShader]="varying vec3 v_positionEC;\n                              void main(void){\n                                  vec4 position = czm_inverseModelView * vec4(v_positionEC,1); // 位置\n                                  float glowRange = 100.0; // 光环的移动范围(高度)\n                                  gl_FragColor = vec4(0.2,  0.5, 1.0, 1.0); // 颜色\n                                  gl_FragColor *= vec4(vec3(position.z / 100.0), 1.0); // 渐变\n                                  // 动态光环\n                                  float time = fract(czm_frameNumber / 360.0);\n                                  time = abs(time - 0.5) * 2.0;\n                                  float diff = step(0.005, abs( clamp(position.z / glowRange, 0.0, 1.0) - time));\n                                  gl_FragColor.rgb += gl_FragColor.rgb * (1.0 - diff);\n                              }\n                             "})),i._shouldRegenerateShaders=!0)},o=0;o<i;o+=2)n()}))})).otherwise((function(e){console.error(e)})),this.otherDatasetArr.push(e)},loadRouteLine:function(){var e=this,t=Cesium.GeoJsonDataSource.load("data/daolu.json");t.then((function(t){viewer.dataSources.add(t),e.otherDatasetArr.push(t);for(var i=t.entities.values,n=0;n<i.length;n++){var o=i[n],s=o.polyline.positions._value;for(var r in s){var a=s[r],l=viewer.scene.globe.ellipsoid,c=l.cartesianToCartographic(a);c.height+=10;var h=l.cartographicToCartesian(c);o.polyline.positions._value[r]=h}o.polyline.material=new Cesium.PolylineGlowMaterialProperty({glowPower:.06,color:Cesium.Color.ORANGERED.withAlpha(.9)}),o.polyline.width=12}})).otherwise((function(e){console.log(e)}))},loadIndoorModel:function(){var e=viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:"https://xdata-1251202940.cos.ap-guangzhou.myqcloud.com/3dtiles/3d/tileset.json"}));this.indoorDataset=e,this.initIndoorConfig("https://xdata-1251202940.cos.ap-guangzhou.myqcloud.com/3dtiles/sgbd/3Dtiles/scenetree.json"),e.skipLevelOfDetail=!0,e.preferLeaves=!0,e.maximumMemoryUsage=3e3,e.maximumScreenSpaceError=99},initIndoorConfig:function(e){a.floorConfigs={};viewer.scene.globe.ellipsoid;s.a.get(e).then((function(e){var t,i=Object(n["a"])(e.data.scenes);try{for(i.s();!(t=i.n()).done;){var o=t.value;a.floorConfigs[o.name]=o.height}}catch(s){i.e(s)}finally{i.f()}})).catch((function(e){console.log("此数据不存在层级关系表",e)}))},initLeftClickHandler:function(){var e=this;this.eventHandler||(this.eventHandler=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas)),this.eventHandler.setInputAction((function(e){if("outdoor"===a.sceneModel){var t=viewer.scene.pick(e.position);if(!Cesium.defined(t)||t.tileset!=a.outdoorDataset)return;a.selectBuildFeature=t;var i=t.getProperty("id"),n='${id}==="'+i+'"?color("PALEGREEN"):color("white")',o=new Cesium.Cesium3DTileStyle({color:n});a.outdoorDataset.style=o,a.toBuildInfoFun()}}),Cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler.setInputAction((function(t){var i=viewer.scene.pick(t.position);if(Cesium.defined(i))switch(a.sceneModel){case"outdoor":a.intoIndoorScen();break;case"indoor":var n=i.getProperty("file");e.sceneModel="floorsplit",e.floorName=n,a.buildFloorSplit(n),viewer.trackedEntity=void 0;break;case"floorsplit":break}}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.eventHandler.setInputAction((function(e){if(!window.measureing)switch(a.sceneModel){case"outdoor":a.unselectOutdoor();break;case"indoor":a.backOutdoor();break;case"floorsplit":a.intoIndoorScen();break}}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)},backOutdoor:function(){a.outdoorDataset.show=!0,viewer.scene.globe.show=!0,a.sceneModel="outdoor",a.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),viewer.entities.remove(a.floorEntity),a.floorEntity=void 0},unselectOutdoor:function(){a.selectBuildFeature&&(a.outdoorDataset.style=null,a.selectBuildFeature=null,a.toHomeFun())},intoIndoorScen:function(){a.indoorDataset||a.loadIndoorModel(),a.outdoorDataset.show=!1,viewer.scene.globe.show=!1,viewer.scene.skyBox.show=!1,a.sceneModel="indoor",this.buildFloorSplit();for(var e=0;e<2;e++){var t=viewer.scene.primitives.get(e);1==t.show&&(document.querySelector(".layersBox > .layerBg:nth-child(2)").classList.add("active"),t._billboards.forEach((function(e){e.show=!0})))}var i="",n=this;a.eventHandler.setInputAction((function(e){if(n.addFloorLabel){var t=viewer.scene.pick(e.endPosition);if(!t)return;var o=t.getProperty("file");if(!o)return;if(i==o)return;i=o,a.selectFloorName=o;var s=viewer.scene.pickPosition(e.endPosition);a.drawFloorLabel(s,o),a.highlightFloor(o)}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)},drawFloorLabel:function(e,t){this.floorEntity?(this.floorEntity.label.text=t,this.floorEntity.position=e):(this.floorEntity=viewer.entities.add({name:"floorLabel",position:e,label:{text:t,font:"16px bold 楷体",showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("#0fa3f180"),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,9e3),pixelOffset:new Cesium.Cartesian2(0,-20),eyeOffset:new Cesium.Cartesian3(0,0,-10)},billboard:{image:"https://i.loli.net/2021/05/26/RL5gGp97EOwmQlB.png",width:50,height:50,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,eyeOffset:new Cesium.Cartesian3(0,0,-10)}}),this.floorEntity.billboard.horizontalOrigin=Cesium.HorizontalOrigin.CENTER)},highlightFloor:function(e){var t=this,i="${feature['file']} === '"+e+"'",n=[];Object.keys(this.structShowState).forEach((function(e){t.structShowState[e]&&n.push(["${类别} === '"+e+"'","true"])}));var o=new Cesium.Cesium3DTileStyle({color:{conditions:[[i,"color('#FFAC3A80')"],[!0,"color('white')"]]},show:{conditions:n}});a.indoorDataset.style=o},buildFloorSplit:function(e){var t=this;if(a.floorConfigs!=={}){var i=[];if("floorsplit"===this.sceneModel){a.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);var n=this;Object.keys(this.structShowState).forEach((function(o){n.structShowState[o]&&i.push(["${file} === '"+(e||t.floorName)+"'&&${类别} === '"+o+"'","true"])}))}else{if("indoor"!==this.sceneModel)return;var o=this;Object.keys(this.structShowState).forEach((function(e){o.structShowState[e]&&i.push(["${类别} === '"+e+"'","true"])}))}var s=new Cesium.Cesium3DTileStyle({defines:{file:"${feature['file']}","类别":"${feature['类别']}"},show:{conditions:i}});if(a.indoorDataset.style=s,viewer.entities.remove(a.floorEntity),a.floorEntity=void 0,"floorsplit"===this.sceneModel){var l=r["a"][e];viewer.camera.flyTo(l);for(var c=0;c<2;c++){var h=viewer.scene.primitives.get(c);1==h.show&&h._billboards.forEach((function(t){t.id.split("_")[0]==e?t.show=!0:t.show=!1}))}}}}};t["a"]=a}}]);