(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors~41e60e5b"],{"55ba":function(e,t,n){"use strict";var o=n("408d"),i=n("ae9b"),a=n("c937"),s=n("21b7"),r=n("e2a6"),c=n("0238"),u=n("1494"),l=n("4d68"),h=n("1a75"),d=n("50de"),f=n("518b"),_=n("2189"),p=n("b54e"),m=n("f361"),g=n("c8d0"),b=n("0a9f");const y=[];function S(){const e=m["a"].createFXAAStage(),t=m["a"].createAmbientOcclusionStage(),n=m["a"].createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=m["a"].createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=b["a"].ACES;const o=this._tonemapping;e.enabled=!1,t.enabled=!1,n.enabled=!1,o.enabled=!1;const i=new g["a"](this),s={},r=y;r.push(e,t,n,o);while(r.length>0){const e=r.pop();s[e.name]=e,e._textureCache=i;const t=e.length;if(Object(a["a"])(t))for(let n=0;n<t;++n)r.push(e.get(n))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;const c=this;t.uniforms.randomTexture=function(){return c._randomTexture},this._ao=t,this._bloom=n,this._fxaa=e,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=s,this._textureCache=i}function x(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;const t=[],n=e._stages,o=n.length;for(let i=0,a=0;i<o;++i){const e=n[i];e&&(e._index=a++,t.push(e))}e._stages=t}function T(e){while(Object(a["a"])(e.length))e=e.get(e.length-1);return e.outputTexture}function O(e,t,n,o,i){if(Object(a["a"])(e.execute))return void e.execute(t,n,o,i);const s=e.length;let r;if(e.inputPreviousStageTexture)for(O(e.get(0),t,n,o,i),r=1;r<s;++r)O(e.get(r),t,T(e.get(r-1)),o,i);else for(r=0;r<s;++r)O(e.get(r),t,n,o,i)}Object.defineProperties(S.prototype,{ready:{get:function(){let e=!1;const t=this._stages,n=t.length;for(let r=n-1;r>=0;--r){const n=t[r];e=e||n.ready&&n.enabled}const o=this._fxaa,i=this._ao,a=this._bloom,s=this._tonemapping;return e=e||o.ready&&o.enabled,e=e||i.ready&&i.enabled,e=e||a.ready&&a.enabled,e=e||s.ready&&s.enabled,e}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return x(this),this._stages.length}},outputTexture:{get:function(){const e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);const t=this._stages,n=t.length;for(let r=n-1;r>=0;--r){const e=t[r];if(Object(a["a"])(e)&&e.ready&&e.enabled)return this.getOutputTexture(e.name)}const o=this._tonemapping;if(o.enabled&&o.ready)return this.getOutputTexture(o.name);const i=this._bloom;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);const s=this._ao;return s.enabled&&s.ready?this.getOutputTexture(s.name):void 0}},hasSelected:{get:function(){const e=Object(o["a"])(this._stages);while(e.length>0){const t=e.pop();if(!Object(a["a"])(t))continue;if(Object(a["a"])(t.selected))return!0;const n=t.length;if(Object(a["a"])(n))for(let o=0;o<n;++o)e.push(t.get(o))}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper===e)return;if(!b["a"].validate(e))throw new r["a"]("tonemapper was set to an invalid value.");Object(a["a"])(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());const t=this._autoExposureEnabled;let n;switch(e){case b["a"].REINHARD:n=m["a"].createReinhardTonemappingStage(t);break;case b["a"].MODIFIED_REINHARD:n=m["a"].createModifiedReinhardTonemappingStage(t);break;case b["a"].FILMIC:n=m["a"].createFilmicTonemappingStage(t);break;default:n=m["a"].createAcesTonemappingStage(t);break}if(t){const e=this._autoExposure;n.uniforms.autoExposure=function(){return e.outputTexture}}this._tonemapper=e,this._tonemapping=n,Object(a["a"])(this._stageNames)&&(this._stageNames[n.name]=n,n._textureCache=this._textureCache),this._textureCacheDirty=!0}}}),S.prototype.add=function(e){i["a"].typeOf.object("stage",e);const t=this._stageNames,n=y;n.push(e);while(n.length>0){const e=n.pop();if(Object(a["a"])(t[e.name]))throw new r["a"](e.name+" has already been added to the collection or does not have a unique name.");t[e.name]=e,e._textureCache=this._textureCache;const o=e.length;if(Object(a["a"])(o))for(let t=0;t<o;++t)n.push(e.get(t))}const o=this._stages;return e._index=o.length,o.push(e),this._textureCacheDirty=!0,e},S.prototype.remove=function(e){if(!this.contains(e))return!1;const t=this._stageNames,n=y;n.push(e);while(n.length>0){const e=n.pop();delete t[e.name];const o=e.length;if(Object(a["a"])(o))for(let t=0;t<o;++t)n.push(e.get(t))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},S.prototype.contains=function(e){return Object(a["a"])(e)&&Object(a["a"])(e._index)&&e._textureCache===this._textureCache},S.prototype.get=function(e){x(this);const t=this._stages,n=t.length;return i["a"].typeOf.number.greaterThanOrEquals("stages length",n,0),i["a"].typeOf.number.greaterThanOrEquals("index",e,0),i["a"].typeOf.number.lessThan("index",e,n),t[e]},S.prototype.removeAll=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)this.remove(e[n]);e.length=0},S.prototype.getStageByName=function(e){return this._stageNames[e]},S.prototype.update=function(e,t,n){x(this);const o=this._activeStages,i=this._activeStages=this._previousActiveStages;this._previousActiveStages=o;const s=this._stages;let r,p,m=i.length=s.length,g=0;for(r=0;r<m;++r)p=s[r],p.ready&&p.enabled&&p._isSupported(e)&&(i[g++]=p);i.length=g;let b=g!==o.length;if(!b)for(r=0;r<g;++r)if(i[r]!==o[r]){b=!0;break}const y=this._ao,S=this._bloom,T=this._autoExposure,O=this._tonemapping,w=this._fxaa;O.enabled=n;const E=y.enabled&&y._isSupported(e),v=S.enabled&&S._isSupported(e),D=O.enabled&&O._isSupported(e),I=w.enabled&&w._isSupported(e);if((b||this._textureCacheDirty||E!==this._aoEnabled||v!==this._bloomEnabled||D!==this._tonemappingEnabled||I!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=E,this._bloomEnabled=v,this._tonemappingEnabled=D,this._fxaaEnabled=I,this._textureCacheDirty=!1),Object(a["a"])(this._randomTexture)&&!E&&(this._randomTexture.destroy(),this._randomTexture=void 0),!Object(a["a"])(this._randomTexture)&&E){m=196608;const t=new Uint8Array(m);for(r=0;r<m;r+=3)t[r]=Math.floor(255*Math.random());this._randomTexture=new h["a"]({context:e,pixelFormat:c["a"].RGB,pixelDatatype:u["a"].UNSIGNED_BYTE,source:{arrayBufferView:t,width:256,height:256},sampler:new l["a"]({wrapS:_["a"].REPEAT,wrapT:_["a"].REPEAT,minificationFilter:f["a"].NEAREST,magnificationFilter:d["a"].NEAREST})})}for(this._textureCache.update(e),w.update(e,t),y.update(e,t),S.update(e,t),O.update(e,t),this._autoExposureEnabled&&T.update(e,t),m=s.length,r=0;r<m;++r)s[r].update(e,t);for(g=0,r=0;r<m;++r)p=s[r],p.ready&&p.enabled&&p._isSupported(e)&&g++;b=g!==i.length,b&&this.update(e,t,n)},S.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},S.prototype.getOutputTexture=function(e){const t=this.getStageByName(e);if(Object(a["a"])(t))return T(t)},S.prototype.execute=function(e,t,n,o){const i=this._activeStages,a=i.length,s=this._fxaa,r=this._ao,c=this._bloom,u=this._autoExposure,l=this._tonemapping,h=r.enabled&&r._isSupported(e),d=c.enabled&&c._isSupported(e),f=this._autoExposureEnabled,_=l.enabled&&l._isSupported(e),p=s.enabled&&s._isSupported(e);if(!p&&!h&&!d&&!_&&0===a)return;let m=t;h&&r.ready&&(O(r,e,m,n,o),m=T(r)),d&&c.ready&&(O(c,e,m,n,o),m=T(c)),f&&u.ready&&O(u,e,m,n,o),_&&l.ready&&(O(l,e,m,n,o),m=T(l));let g=m;if(a>0){O(i[0],e,m,n,o);for(let t=1;t<a;++t)O(i[t],e,T(i[t-1]),n,o);g=T(i[a-1])}p&&s.ready&&O(s,e,g,n,o)},S.prototype.copy=function(e,t){if(!Object(a["a"])(this._copyColorCommand)){const t=this;this._copyColorCommand=e.createViewportQuadCommand(p["a"],{uniformMap:{colorTexture:function(){return t.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},S.prototype.isDestroyed=function(){return!1},S.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),Object(s["a"])(this)},t["a"]=S},"643f":function(e,t,n){"use strict";var o=n("554f"),i=n("8656"),a=n("dde0"),s=n("4051"),r=n("1a5d"),c=n("c937"),u=n("e2a6"),l=n("aecc"),h=n("722e"),d=n("2c95"),f=n("46bd");function _(e,t){e=Object(r["a"])(e,r["a"].EMPTY_OBJECT),this._show=Object(r["a"])(e.show,!0),this._width=Object(r["a"])(e.width,1),this._loop=Object(r["a"])(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,Object(c["a"])(this._material)||(this._material=f["a"].fromType(f["a"].ColorType,{color:new s["a"](1,1,1,1)}));let n,u=e.positions;Object(c["a"])(u)||(u=[]),this._positions=u,this._actualPositions=Object(o["a"])(u,a["a"].equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=u.slice()),this._actualPositions.push(a["a"].clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,Object(c["a"])(t)&&(n=h["a"].clone(t.modelMatrix)),this._modelMatrix=n,this._segments=d["a"].wrapLongitude(this._actualPositions,n),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(x),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=i["a"].fromPoints(this._actualPositions),this._boundingVolumeWC=i["a"].transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new i["a"]}const p=_.POSITION_INDEX=0,m=_.SHOW_INDEX=1,g=_.WIDTH_INDEX=2,b=_.MATERIAL_INDEX=3,y=_.POSITION_SIZE_INDEX=4,S=_.DISTANCE_DISPLAY_CONDITION=5,x=_.NUMBER_OF_PROPERTIES=6;function T(e,t){++e._propertiesChanged[t];const n=e._polylineCollection;Object(c["a"])(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(_.prototype,{show:{get:function(){return this._show},set:function(e){if(!Object(c["a"])(e))throw new u["a"]("value is required.");e!==this._show&&(this._show=e,T(this,m))}},positions:{get:function(){return this._positions},set:function(e){if(!Object(c["a"])(e))throw new u["a"]("value is required.");let t=Object(o["a"])(e,a["a"].equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(a["a"].clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||T(this,y),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=i["a"].fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=i["a"].transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),T(this,p),this.update()}},material:{get:function(){return this._material},set:function(e){if(!Object(c["a"])(e))throw new u["a"]("material is required.");this._material!==e&&(this._material=e,T(this,b))}},width:{get:function(){return this._width},set:function(e){if(!Object(c["a"])(e))throw new u["a"]("value is required.");const t=this._width;e!==t&&(this._width=e,T(this,g))}},loop:{get:function(){return this._loop},set:function(e){if(!Object(c["a"])(e))throw new u["a"]("value is required.");if(e!==this._loop){let t=this._actualPositions;e?t.length>2&&!a["a"].equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(a["a"].clone(t[0]))):t.length>2&&a["a"].equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,T(this,y)}}},id:{get:function(){return this._id},set:function(e){this._id=e,Object(c["a"])(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!Object(c["a"])(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(Object(c["a"])(e)&&e.far<=e.near)throw new u["a"]("far distance must be greater than near distance.");l["a"].equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=l["a"].clone(e,this._distanceDisplayCondition),T(this,S))}}}),_.prototype.update=function(){let e=h["a"].IDENTITY;Object(c["a"])(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);const t=this._segments.positions.length,n=this._segments.lengths,o=this._propertiesChanged[p]>0||this._propertiesChanged[y]>0;if(h["a"].equals(e,this._modelMatrix)&&!o||(this._segments=d["a"].wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=i["a"].transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=h["a"].clone(e,this._modelMatrix),this._segments.positions.length!==t)T(this,y);else{const e=n.length;for(let t=0;t<e;++t)if(n[t]!==this._segments.lengths[t]){T(this,y);break}}},_.prototype.getPickId=function(e){return Object(c["a"])(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},_.prototype._clean=function(){this._dirty=!1;const e=this._propertiesChanged;for(let t=0;t<x-1;++t)e[t]=0},_.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0},t["a"]=_},"788d":function(e,t,n){"use strict";const o={NEAREST:0,LINEAR:1};t["a"]=o},"9a7e":function(e,t,n){"use strict";var o=n("ae9b"),i=n("0b4a"),a=n("1a5d"),s=n("c937"),r=n("21b7");function c(e){e=Object(a["a"])(e,a["a"].EMPTY_OBJECT),o["a"].defined("options.stages",e.stages),o["a"].typeOf.number.greaterThan("options.stages.length",e.stages.length,0),this._stages=e.stages,this._inputPreviousStageTexture=Object(a["a"])(e.inputPreviousStageTexture,!0);let t=e.name;Object(s["a"])(t)||(t=Object(i["a"])()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}function u(e){let t=Object(s["a"])(e._selected)?e._selected.length:0;const n=Object(s["a"])(e._parentSelected)?e._parentSelected:0;let o=e._selected!==e._selectedShadow||t!==e._selectedLength;if(o=o||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,Object(s["a"])(e._selected)&&Object(s["a"])(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(s["a"])(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!o&&Object(s["a"])(e._combinedSelected)){if(!Object(s["a"])(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return o}Object.defineProperties(c.prototype,{ready:{get:function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){const t=this._stages,n=t.length;for(let o=0;o<n;++o)t[o].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),c.prototype._isSupported=function(e){const t=this._stages,n=t.length;for(let o=0;o<n;++o)if(!t[o]._isSupported(e))return!1;return!0},c.prototype.get=function(e){return o["a"].typeOf.number.greaterThanOrEquals("index",e,0),o["a"].typeOf.number.lessThan("index",e,this.length),this._stages[e]},c.prototype.update=function(e,t){this._selectedDirty=u(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(s["a"])(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(s["a"])(this._parentSelected)?this._parentSelected.length:0;const n=this._stages,o=n.length;for(let i=0;i<o;++i){const o=n[i];this._selectedDirty&&(o.parentSelected=this._combinedSelected),o.update(e,t)}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return Object(r["a"])(this)},t["a"]=c},aa2d:function(e,t,n){"use strict";var o=n("1a5d"),i=n("8e1f"),a=n("514d"),s=n("9353"),r=n("9d57"),c=n("d3ce"),u=n("50f2");let l=`${c["a"]}\n${r["a"]}`;const h=s["a"];function d(e){e=Object(o["a"])(e,o["a"].EMPTY_OBJECT);const t=Object(o["a"])(e.translucent,!0),n=!1,i=d.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=Object(o["a"])(e.vertexShaderSource,l),this._fragmentShaderSource=Object(o["a"])(e.fragmentShaderSource,h),this._renderState=u["a"].getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=i}i["a"].isInternetExplorer()||(l="#define CLIP_POLYLINE \n"+l),Object.defineProperties(d.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),d.VERTEX_FORMAT=a["a"].POSITION_ONLY,d.prototype.getFragmentShaderSource=u["a"].prototype.getFragmentShaderSource,d.prototype.isTranslucent=u["a"].prototype.isTranslucent,d.prototype.getRenderState=u["a"].prototype.getRenderState,t["a"]=d},af2a:function(e,t,n){"use strict";var o=n("1a5d"),i=n("c937"),a=n("8e1f"),s=n("514d"),r=n("4088"),c=n("d3ce"),u=n("4b1b"),l=n("50f2"),h=n("46bd");let d=`${c["a"]}\n${r["a"]}`;const f=u["a"];function _(e){e=Object(o["a"])(e,o["a"].EMPTY_OBJECT);const t=Object(o["a"])(e.translucent,!0),n=!1,a=_.VERTEX_FORMAT;this.material=Object(i["a"])(e.material)?e.material:h["a"].fromType(h["a"].ColorType),this.translucent=t,this._vertexShaderSource=Object(o["a"])(e.vertexShaderSource,d),this._fragmentShaderSource=Object(o["a"])(e.fragmentShaderSource,f),this._renderState=l["a"].getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=a}a["a"].isInternetExplorer()||(d="#define CLIP_POLYLINE \n"+d),Object.defineProperties(_.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&(e="#define POLYLINE_DASH\n"+e),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),_.VERTEX_FORMAT=s["a"].POSITION_AND_ST,_.prototype.getFragmentShaderSource=l["a"].prototype.getFragmentShaderSource,_.prototype.isTranslucent=l["a"].prototype.isTranslucent,_.prototype.getRenderState=l["a"].prototype.getRenderState,t["a"]=_},c8d0:function(e,t,n){"use strict";var o=n("4051"),i=n("c937"),a=n("21b7"),s=n("b8b5"),r=n("a3c8"),c=n("66fd");function u(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function l(e){while(Object(i["a"])(e.length))e=e.get(e.length-1);return e.name}function h(e,t,n,o,a){if(!o.enabled||!o._isSupported(t))return a;const s=n[o.name]={};if(Object(i["a"])(a)){const t=e.getStageByName(a);s[l(t)]=!0}const r=o.uniforms;if(Object(i["a"])(r)){const t=Object.getOwnPropertyNames(r),n=t.length;for(let o=0;o<n;++o){const n=r[t[o]];if("string"===typeof n){const t=e.getStageByName(n);Object(i["a"])(t)&&(s[l(t)]=!0)}}}return o.name}function d(e,t,n,o,a){if(Object(i["a"])(o.enabled)&&!o.enabled||Object(i["a"])(o._isSupported)&&!o._isSupported(t))return a;const s=a,r=!Object(i["a"])(o.inputPreviousStageTexture)||o.inputPreviousStageTexture;let c=a;const u=o.length;for(let l=0;l<u;++l){const s=o.get(l);c=Object(i["a"])(s.length)?d(e,t,n,s,a):h(e,t,n,s,a),r&&(a=c)}let f,_;if(r)for(f=1;f<u;++f)_=l(o.get(f)),Object(i["a"])(n[_])||(n[_]={}),n[_][s]=!0;else for(f=1;f<u;++f){_=l(o.get(f));const e=n[_];for(let t=0;t<f;++t)e[l(o.get(t))]=!0}return c}function f(e,t){const n={};if(Object(i["a"])(e.ambientOcclusion)){const o=e.ambientOcclusion,i=e.bloom,a=e._tonemapping,s=e.fxaa;let r=d(e,t,n,o,void 0);r=d(e,t,n,i,r),r=h(e,t,n,a,r),r=d(e,t,n,e,r),h(e,t,n,s,r)}else d(e,t,n,e,void 0);return n}function _(e,t,n){const a=e._collection,s=a.getStageByName(t),r=s._textureScale,u=s._forcePowerOfTwo,l=s._pixelFormat,h=s._pixelDatatype,d=s._clearColor;let f,_;const p=e._framebuffers,m=p.length;for(f=0;f<m;++f){if(_=p[f],r!==_.textureScale||u!==_.forcePowerOfTwo||l!==_.pixelFormat||h!==_.pixelDatatype||!o["a"].equals(d,_.clearColor))continue;const e=_.stages,t=e.length;let i=!1;for(let o=0;o<t;++o)if(n[e[o]]){i=!0;break}if(!i)break}return Object(i["a"])(_)&&f<m?(_.stages.push(t),_):(_={textureScale:r,forcePowerOfTwo:u,pixelFormat:l,pixelDatatype:h,clearColor:d,stages:[t],buffer:new c["a"]({pixelFormat:l,pixelDatatype:h}),clear:void 0},p.push(_),_)}function p(e,t){const n=f(e._collection,t);for(const o in n)n.hasOwnProperty(o)&&(e._stageNameToFramebuffer[o]=_(e,o,n[o]))}function m(e){const t=e._framebuffers,n=t.length;for(let o=0;o<n;++o){const e=t[o];e.buffer.destroy()}}function g(e,t){const n=e._width,o=e._height,i=e._framebuffers,a=i.length;for(let c=0;c<a;++c){const e=i[c],a=e.textureScale;let u=Math.ceil(n*a),l=Math.ceil(o*a),h=Math.min(u,l);e.forcePowerOfTwo&&(s["a"].isPowerOfTwo(h)||(h=s["a"].nextPowerOfTwo(h)),u=h,l=h),e.buffer.update(t,u,l),e.clear=new r["a"]({color:e.clearColor,framebuffer:e.buffer.framebuffer})}}u.prototype.updateDependencies=function(){this._updateDependencies=!0},u.prototype.update=function(e){const t=this._collection,n=this._updateDependencies,o=Object(i["a"])(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),a=Object(i["a"])(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),s=Object(i["a"])(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),r=Object(i["a"])(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),c=!Object(i["a"])(t._activeStages)||t._activeStages.length>0||o||a||s||r;if((n||!c&&this._framebuffers.length>0)&&(m(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!n&&!c)return;0===this._framebuffers.length&&p(this,e);const u=e.drawingBufferWidth,l=e.drawingBufferHeight,h=this._width!==u||this._height!==l;(n||h)&&(this._width=u,this._height=l,this._updateDependencies=!1,m(this),g(this,e))},u.prototype.clear=function(e){const t=this._framebuffers;for(let n=0;n<t.length;++n)t[n].clear.execute(e)},u.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},u.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},u.prototype.getFramebuffer=function(e){const t=this._stageNameToFramebuffer[e];if(Object(i["a"])(t))return t.buffer.framebuffer},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return m(this),Object(a["a"])(this)},t["a"]=u},e964:function(e,t,n){"use strict";var o=n("6af0"),i=n("ae9b"),a=n("4051"),s=n("2fad"),r=n("0b4a"),c=n("1a5d"),u=n("c937"),l=n("21b7"),h=n("e2a6"),d=n("0238"),f=n("9f38"),_=n("2992"),p=n("1494"),m=n("5027"),g=n("4d68"),b=n("b3ce"),y=n("1a75"),S=n("50de"),x=n("518b"),T=n("2189"),O=n("788d");function w(e){e=Object(c["a"])(e,c["a"].EMPTY_OBJECT);const t=e.fragmentShader,n=Object(c["a"])(e.textureScale,1),s=Object(c["a"])(e.pixelFormat,d["a"].RGBA);if(i["a"].typeOf.string("options.fragmentShader",t),i["a"].typeOf.number.greaterThan("options.textureScale",n,0),i["a"].typeOf.number.lessThanOrEquals("options.textureScale",n,1),!d["a"].isColorFormat(s))throw new h["a"]("options.pixelFormat must be a color format.");this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=n,this._forcePowerOfTwo=Object(c["a"])(e.forcePowerOfTwo,!1),this._sampleMode=Object(c["a"])(e.sampleMode,O["a"].NEAREST),this._pixelFormat=s,this._pixelDatatype=Object(c["a"])(e.pixelDatatype,p["a"].UNSIGNED_BYTE),this._clearColor=Object(c["a"])(e.clearColor,a["a"].BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;const l=new _["a"];l.scissorTest={enabled:!0,rectangle:Object(u["a"])(e.scissorRectangle)?o["a"].clone(e.scissorRectangle):new o["a"]},this._passState=l,this._ready=!1;let f=e.name;Object(u["a"])(f)||(f=Object(r["a"])()),this._name=f,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(w.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(Object(u["a"])(this._textureCache)){const e=this._textureCache.getFramebuffer(this._name);if(Object(u["a"])(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});const E=/uniform\s+sampler2D\s+depthTexture/g;function v(e,t,n){const o=t[n];return("string"===typeof o||o instanceof HTMLCanvasElement||o instanceof HTMLImageElement||o instanceof HTMLVideoElement||o instanceof ImageData)&&e._dirtyUniforms.push(n),{get:function(){return t[n]},set:function(o){const i=t[n];t[n]=o;const a=e._actualUniforms,s=a[n];Object(u["a"])(s)&&s!==i&&s instanceof y["a"]&&!Object(u["a"])(e._textureCache.getStageByName(n))&&(e._texturesToRelease.push(s),delete a[n],delete a[n+"Dimensions"]),i instanceof y["a"]&&e._texturesToRelease.push(i),"string"===typeof o||o instanceof HTMLCanvasElement||o instanceof HTMLImageElement||o instanceof HTMLVideoElement||o instanceof ImageData?e._dirtyUniforms.push(n):a[n]=o}}}function D(e,t){return function(){const n=e._actualUniforms[t];return"function"===typeof n?n():n}}function I(e,t){return function(){const n=e[t]();if(Object(u["a"])(n))return n.dimensions}}function P(e){if(Object(u["a"])(e._uniformMap))return;const t={},n={},o=e._uniforms,i=e._actualUniforms;for(const a in o)if(o.hasOwnProperty(a)){"function"!==typeof o[a]?(t[a]=D(e,a),n[a]=v(e,o,a)):(t[a]=o[a],n[a]=o[a]),i[a]=o[a];const s=t[a]();("string"===typeof s||s instanceof y["a"]||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(t[a+"Dimensions"]=I(t,a))}e._uniforms={},Object.defineProperties(e._uniforms,n),e._uniformMap=Object(s["a"])(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}function C(e,t){if(Object(u["a"])(e._command)&&!e._logDepthChanged&&!e._selectedDirty)return;let n=e._fragmentShader;if(Object(u["a"])(e._selectedIdTexture)){const t=e._selectedIdTexture.width;n=n.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""),n=`#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < ${t}; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n`+n}const o=new b["a"]({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[n]});e._command=t.createViewportQuadCommand(o,{uniformMap:e._uniformMap,owner:e})}function A(e){const t=e._sampleMode;let n,o;t===O["a"].LINEAR?(n=x["a"].LINEAR,o=S["a"].LINEAR):(n=x["a"].NEAREST,o=S["a"].NEAREST);const i=e._sampler;Object(u["a"])(i)&&i.minificationFilter===n&&i.magnificationFilter===o||(e._sampler=new g["a"]({wrapS:T["a"].CLAMP_TO_EDGE,wrapT:T["a"].CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:o}))}function j(e,t){return function(n){e._texturesToCreate.push({name:t,source:n})}}function B(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function N(e,t){let n,o,i;const a=e._texturesToRelease;let s=a.length;for(n=0;n<s;++n)o=a[n],o=o&&o.destroy();a.length=0;const r=e._texturesToCreate;for(s=r.length,n=0;n<s;++n){const o=r[n];i=o.name;const a=o.source;e._actualUniforms[i]=new y["a"]({context:t,source:a})}r.length=0;const c=e._dirtyUniforms;if(0===c.length&&!Object(u["a"])(e._texturePromise))return void(e._ready=!0);if(0===c.length||Object(u["a"])(e._texturePromise))return;s=c.length;const l=e._uniforms,h=[];for(n=0;n<s;++n){i=c[n];const t=l[i],o=e._textureCache.getStageByName(t);if(Object(u["a"])(o))e._actualUniforms[i]=B(e,t);else if("string"===typeof t){const n=new f["a"]({url:t});h.push(n.fetchImage().then(j(e,i)))}else e._texturesToCreate.push({name:i,source:t})}c.length=0,h.length>0?(e._ready=!1,e._texturePromise=Promise.all(h).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}function L(e){Object(u["a"])(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();const t=e._textureCache;if(!Object(u["a"])(t))return;const n=e._uniforms,o=e._actualUniforms;for(const i in o)o.hasOwnProperty(i)&&o[i]instanceof y["a"]&&(Object(u["a"])(t.getStageByName(n[i]))||o[i].destroy(),e._dirtyUniforms.push(i))}function R(e){let t=Object(u["a"])(e._selected)?e._selected.length:0;const n=Object(u["a"])(e._parentSelected)?e._parentSelected:0;let o=e._selected!==e._selectedShadow||t!==e._selectedLength;if(o=o||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,Object(u["a"])(e._selected)&&Object(u["a"])(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(u["a"])(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!o&&Object(u["a"])(e._combinedSelected)){if(!Object(u["a"])(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return o}function M(e,t){if(!e._selectedDirty)return;e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;const n=e._combinedSelected;if(!Object(u["a"])(n))return;let o,i,s=0;const r=n.length;for(o=0;o<r;++o)i=n[o],Object(u["a"])(i.pickIds)?s+=i.pickIds.length:Object(u["a"])(i.pickId)&&++s;if(0===r||0===s){const n=new Uint8Array(4);return n[0]=255,n[1]=255,n[2]=255,n[3]=255,void(e._selectedIdTexture=new y["a"]({context:t,pixelFormat:d["a"].RGBA,pixelDatatype:p["a"].UNSIGNED_BYTE,source:{arrayBufferView:n,width:1,height:1},sampler:g["a"].NEAREST}))}let c,l=0;const h=new Uint8Array(4*s);for(o=0;o<r;++o)if(i=n[o],Object(u["a"])(i.pickIds)){const e=i.pickIds,t=e.length;for(let n=0;n<t;++n)c=e[n].color,h[l]=a["a"].floatToByte(c.red),h[l+1]=a["a"].floatToByte(c.green),h[l+2]=a["a"].floatToByte(c.blue),h[l+3]=a["a"].floatToByte(c.alpha),l+=4}else Object(u["a"])(i.pickId)&&(c=i.pickId.color,h[l]=a["a"].floatToByte(c.red),h[l+1]=a["a"].floatToByte(c.green),h[l+2]=a["a"].floatToByte(c.blue),h[l+3]=a["a"].floatToByte(c.alpha),l+=4);e._selectedIdTexture=new y["a"]({context:t,pixelFormat:d["a"].RGBA,pixelDatatype:p["a"].UNSIGNED_BYTE,source:{arrayBufferView:h,width:s,height:1},sampler:g["a"].NEAREST})}w.prototype._isSupported=function(e){return!E.test(this._fragmentShader)||e.depthTexture},w.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||L(this),this._enabled=this.enabled,!this._enabled)return;if(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=R(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(u["a"])(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(u["a"])(this._parentSelected)?this._parentSelected.length:0,M(this,e),P(this),N(this,e),C(this,e),A(this),this._selectedDirty=!1,!this._ready)return;const n=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=n,!Object(u["a"])(n))return;const i=n.getColorTexture(0);let a;i.width===e.drawingBufferWidth&&i.height===e.drawingBufferHeight||(a=this._renderState,Object(u["a"])(a)&&i.width===a.viewport.width&&i.height===a.viewport.height||(this._renderState=m["a"].fromCache({viewport:new o["a"](0,0,i.width,i.height)}))),this._command.renderState=a},w.prototype.execute=function(e,t,n,o){if(!Object(u["a"])(this._command)||!Object(u["a"])(this._command.framebuffer)||!this._ready||!this._enabled)return;this._colorTexture=t,this._depthTexture=n,this._idTexture=o,g["a"].equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);const i=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;Object(u["a"])(i)&&(i.context=e),this._command.execute(e,i)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return L(this),Object(l["a"])(this)},t["a"]=w},f361:function(e,t,n){"use strict";var o=n("1924"),i=n("4051"),a=n("0b4a"),s=n("c937"),r=n("e107"),c=n("51a3"),u=n("9050"),l=n("926ac"),h=n("7248"),d=n("0150"),f=n("18e9"),_=n("a6e4"),p=n("1f42"),m=n("8560"),g=n("7ebc"),b=n("568a"),y=n("0fd5"),S=n("4077"),x=n("07fc"),T=n("4e05"),O=n("fc0d"),w=n("fe3a"),E=n("8d72"),v=n("57f8"),D=n("c21c"),I=n("e964"),P=n("9a7e"),C=n("788d");const A={};function j(e){const t=1,n=2,o=1,i="#define USE_STEP_SIZE\n"+S["a"],a=new I["a"]({name:e+"_x_direction",fragmentShader:i,uniforms:{delta:t,sigma:n,stepSize:o,direction:0},sampleMode:C["a"].LINEAR}),s=new I["a"]({name:e+"_y_direction",fragmentShader:i,uniforms:{delta:t,sigma:n,stepSize:o,direction:1},sampleMode:C["a"].LINEAR}),r={};return Object.defineProperties(r,{delta:{get:function(){return a.uniforms.delta},set:function(e){const t=a.uniforms,n=s.uniforms;t.delta=n.delta=e}},sigma:{get:function(){return a.uniforms.sigma},set:function(e){const t=a.uniforms,n=s.uniforms;t.sigma=n.sigma=e}},stepSize:{get:function(){return a.uniforms.stepSize},set:function(e){const t=a.uniforms,n=s.uniforms;t.stepSize=n.stepSize=e}}}),new P["a"]({name:e,stages:[a,s],uniforms:r})}function B(e){if(!Object(s["a"])(e))return A.createEdgeDetectionStage();const t=new P["a"]({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),n={};let o="",i="";for(let s=0;s<e.length;++s)o+=`uniform sampler2D edgeTexture${s}; \n`,i+=`        vec4 edge${s} = texture2D(edgeTexture${s}, v_textureCoordinates); \n        if (edge${s}.a > 0.0) \n        { \n            color = edge${s}; \n            break; \n        } \n`,n["edgeTexture"+s]=e[s].name;const a=o+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n"+`    for (int i = 0; i < ${e.length}; i++) \n`+`    { \n${i}    } \n    gl_FragColor = color; \n} \n`,r=new I["a"]({name:"czm_edge_detection_combine",fragmentShader:a,uniforms:n});return new P["a"]({name:"czm_edge_detection_composite",stages:[t,r]})}A.createBlurStage=function(){return j("czm_blur")},A.createDepthOfFieldStage=function(){const e=j("czm_depth_of_field_blur"),t=new I["a"]({name:"czm_depth_of_field_composite",fragmentShader:p["a"],uniforms:{focalDistance:5,blurTexture:e.name}}),n={};return Object.defineProperties(n,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new P["a"]({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:n})},A.isDepthOfFieldSupported=function(e){return e.context.depthTexture},A.createEdgeDetectionStage=function(){const e=Object(a["a"])();return new I["a"]({name:"czm_edge_detection_"+e,fragmentShader:g["a"],uniforms:{length:.25,color:i["a"].clone(i["a"].BLACK)}})},A.isEdgeDetectionSupported=function(e){return e.context.depthTexture},A.createSilhouetteStage=function(e){const t=B(e),n=new I["a"]({name:"czm_silhouette_color_edges",fragmentShader:E["a"],uniforms:{silhouetteTexture:t.name}});return new P["a"]({name:"czm_silhouette",stages:[t,n],inputPreviousStageTexture:!1,uniforms:t.uniforms})},A.isSilhouetteSupported=function(e){return e.context.depthTexture},A.createBloomStage=function(){const e=new I["a"]({name:"czm_bloom_contrast_bias",fragmentShader:_["a"],uniforms:{contrast:128,brightness:-.3}}),t=j("czm_bloom_blur"),n=new P["a"]({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),o=new I["a"]({name:"czm_bloom_generate_composite",fragmentShader:d["a"],uniforms:{glowOnly:!1,bloomTexture:n.name}}),i={};return Object.defineProperties(i,{glowOnly:{get:function(){return o.uniforms.glowOnly},set:function(e){o.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new P["a"]({name:"czm_bloom",stages:[n,o],inputPreviousStageTexture:!1,uniforms:i})},A.createAmbientOcclusionStage=function(){const e=new I["a"]({name:"czm_ambient_occlusion_generate",fragmentShader:u["a"],uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=j("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;const n=new P["a"]({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),o=new I["a"]({name:"czm_ambient_occlusion_composite",fragmentShader:l["a"],uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:n.name}}),i={};return Object.defineProperties(i,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return o.uniforms.ambientOcclusionOnly},set:function(e){o.uniforms.ambientOcclusionOnly=e}}}),new P["a"]({name:"czm_ambient_occlusion",stages:[n,o],inputPreviousStageTexture:!1,uniforms:i})},A.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};const N=`#define FXAA_QUALITY_PRESET 39 \n${v["a"]}\n${y["a"]}`;A.createFXAAStage=function(){return new I["a"]({name:"czm_FXAA",fragmentShader:N,sampleMode:C["a"].LINEAR})},A.createAcesTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=c["a"],new I["a"]({name:"czm_aces",fragmentShader:t,uniforms:{autoExposure:void 0}})},A.createFilmicTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=b["a"],new I["a"]({name:"czm_filmic",fragmentShader:t,uniforms:{autoExposure:void 0}})},A.createReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=w["a"],new I["a"]({name:"czm_reinhard",fragmentShader:t,uniforms:{autoExposure:void 0}})},A.createModifiedReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=T["a"],new I["a"]({name:"czm_modified_reinhard",fragmentShader:t,uniforms:{white:i["a"].WHITE,autoExposure:void 0}})},A.createAutoExposureStage=function(){return new D["a"]},A.createBlackAndWhiteStage=function(){return new I["a"]({name:"czm_black_and_white",fragmentShader:h["a"],uniforms:{gradations:5}})},A.createBrightnessStage=function(){return new I["a"]({name:"czm_brightness",fragmentShader:f["a"],uniforms:{brightness:.5}})},A.createNightVisionStage=function(){return new I["a"]({name:"czm_night_vision",fragmentShader:O["a"]})},A.createDepthViewStage=function(){return new I["a"]({name:"czm_depth_view",fragmentShader:m["a"]})},A.createLensFlareStage=function(){return new I["a"]({name:"czm_lens_flare",fragmentShader:x["a"],uniforms:{dirtTexture:Object(o["a"])("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:Object(o["a"])("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:r["a"].WGS84.maximumRadius}})},t["a"]=A},fabb:function(e,t,n){"use strict";var o=n("8656"),i=n("85b2"),a=n("dde0"),s=n("6b82"),r=n("8d54"),c=n("4051"),u=n("2fad"),l=n("cbf0"),h=n("1a5d"),d=n("c937"),f=n("21b7"),_=n("e2a6"),p=n("d809"),m=n("8e1f"),g=n("2642"),b=n("a61d"),y=n("b8b5"),S=n("722e"),x=n("a7b2"),T=n("e2aa"),O=n("6f54"),w=n("6ba7"),E=n("2341"),v=n("d5cf"),D=n("51f2"),I=n("5027"),P=n("8f7d"),C=n("b3ce"),A=n("1a75"),j=n("dc15"),B=n("d3ce"),N=n("4b1b"),L=n("ca9c"),R=n("73f3"),M=n("da23"),F=n("46bd"),U=n("643f"),z=n("dc6c");const V=U["a"].SHOW_INDEX,k=U["a"].WIDTH_INDEX,H=U["a"].POSITION_INDEX,Y=U["a"].MATERIAL_INDEX,W=U["a"].POSITION_SIZE_INDEX,X=U["a"].DISTANCE_DISPLAY_CONDITION,q=U["a"].NUMBER_OF_PROPERTIES,G={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function $(e){e=Object(h["a"])(e,h["a"].EMPTY_OBJECT),this.show=Object(h["a"])(e.show,!0),this.modelMatrix=S["a"].clone(Object(h["a"])(e.modelMatrix,S["a"].IDENTITY)),this._modelMatrix=S["a"].clone(S["a"].IDENTITY),this.debugShowBoundingVolume=Object(h["a"])(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(q),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:w["a"].STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=c["a"].clone(c["a"].WHITE);const t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}function J(e,t){Object(d["a"])(e._batchTable)&&e._batchTable.destroy();const n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:l["a"].UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:l["a"].UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:l["a"].FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:l["a"].FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:l["a"].FLOAT,componentsPerAttribute:2}];e._batchTable=new R["a"](t,n,e._polylines.length)}Object.defineProperties($.prototype,{length:{get:function(){return he(this),this._polylines.length}}}),$.prototype.add=function(e){const t=new U["a"](e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},$.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,Object(d["a"])(e._bucket)){const t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1},$.prototype.removeAll=function(){de(this),_e(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},$.prototype.contains=function(e){return Object(d["a"])(e)&&e._polylineCollection===this},$.prototype.get=function(e){if(!Object(d["a"])(e))throw new _["a"]("index is required.");return he(this),this._polylines[e]};const K=new p["a"],Q=new s["a"],Z=new i["a"];$.prototype.update=function(e){if(he(this),0===this._polylines.length||!this.show)return;le(this,e);const t=e.context,n=e.mapProjection;let o,a=this._propertiesChanged;if(this._createBatchTable){if(0===E["a"].maximumVertexTextureImageUnits)throw new T["a"]("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");J(this,t),this._createBatchTable=!1}if(this._createVertexArray||oe(this))ae(this,t,n);else if(this._polylinesUpdated){const r=this._polylinesToUpdate;if(this._mode!==z["a"].SCENE3D){const e=r.length;for(let t=0;t<e;++t)o=r[t],o.update()}if(a[W]||a[Y])ae(this,t,n);else{const t=r.length,c=this._polylineBuckets;for(let u=0;u<t;++u){o=r[u],a=o._propertiesChanged;const t=o._bucket;let l=0;for(const e in c)if(c.hasOwnProperty(e)){if(c[e]===t){a[H]&&t.writeUpdate(l,o,this._positionBuffer,n);break}l+=c[e].lengthOfPositions}if((a[V]||a[k])&&this._batchTable.setBatchedAttribute(o._index,0,new i["a"](o._width,o._show)),this._batchTable.attributes.length>2){if(a[H]||a[W]){const t=e.mode===z["a"].SCENE2D?o._boundingVolume2D:o._boundingVolumeWC,n=p["a"].fromCartesian(t.center,K),i=s["a"].fromElements(n.low.x,n.low.y,n.low.z,t.radius,Q);this._batchTable.setBatchedAttribute(o._index,2,n.high),this._batchTable.setBatchedAttribute(o._index,3,i)}if(a[X]){const e=Z;e.x=0,e.y=Number.MAX_VALUE;const t=o.distanceDisplayCondition;Object(d["a"])(t)&&(e.x=t.near,e.y=t.far),this._batchTable.setBatchedAttribute(o._index,4,e)}}o._clean()}}r.length=0,this._polylinesUpdated=!1}a=this._propertiesChanged;for(let i=0;i<q;++i)a[i]=0;let r=S["a"].IDENTITY;e.mode===z["a"].SCENE3D&&(r=this.modelMatrix);const c=e.passes,u=0!==e.morphTime;if(Object(d["a"])(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===u||(this._opaqueRS=I["a"].fromCache({depthMask:u,depthTest:{enabled:u}})),Object(d["a"])(this._translucentRS)&&this._translucentRS.depthTest.enabled===u||(this._translucentRS=I["a"].fromCache({blending:M["a"].ALPHA_BLEND,depthMask:!u,depthTest:{enabled:u}})),this._batchTable.update(e),c.render||c.pick){const t=this._colorCommands;ne(this,e,t,r)}};const ee=new o["a"],te=new o["a"];function ne(e,t,n,i){const a=t.context,s=t.commandList,r=n.length;let c=0,l=!0;const h=e._vertexArrays,f=e.debugShowBoundingVolume,_=e._batchTable,p=_.getUniformMapCallback(),m=h.length;for(let g=0;g<m;++g){const _=h[g],m=_.buckets,b=m.length;for(let h=0;h<b;++h){const g=m[h];let b=g.offset;const y=g.bucket.shaderProgram,S=g.bucket.polylines,x=S.length;let T,O,w,E,I=0;for(let h=0;h<x;++h){const m=S[h],x=ce(m._material);if(x!==T){if(Object(d["a"])(T)&&I>0){const t=O.isTranslucent();c>=r?(w=new v["a"]({owner:e}),n.push(w)):w=n[c],++c,E=Object(u["a"])(p(O._uniforms),e._uniformMap),w.boundingVolume=o["a"].clone(ee,w.boundingVolume),w.modelMatrix=i,w.shaderProgram=y,w.vertexArray=_.va,w.renderState=t?e._translucentRS:e._opaqueRS,w.pass=t?D["a"].TRANSLUCENT:D["a"].OPAQUE,w.debugShowBoundingVolume=f,w.pickId="v_pickColor",w.uniformMap=E,w.count=I,w.offset=b,b+=I,I=0,l=!0,s.push(w)}O=m._material,O.update(a),T=x}const P=m._locatorBuckets,C=P.length;for(let e=0;e<C;++e){const t=P[e];t.locator===g&&(I+=t.count)}let A;t.mode===z["a"].SCENE3D?A=m._boundingVolumeWC:t.mode===z["a"].COLUMBUS_VIEW?A=m._boundingVolume2D:t.mode===z["a"].SCENE2D?Object(d["a"])(m._boundingVolume2D)&&(A=o["a"].clone(m._boundingVolume2D,te),A.center.x=0):Object(d["a"])(m._boundingVolumeWC)&&Object(d["a"])(m._boundingVolume2D)&&(A=o["a"].union(m._boundingVolumeWC,m._boundingVolume2D,te)),l?(l=!1,o["a"].clone(A,ee)):o["a"].union(A,ee,ee)}Object(d["a"])(T)&&I>0&&(c>=r?(w=new v["a"]({owner:e}),n.push(w)):w=n[c],++c,E=Object(u["a"])(p(O._uniforms),e._uniformMap),w.boundingVolume=o["a"].clone(ee,w.boundingVolume),w.modelMatrix=i,w.shaderProgram=y,w.vertexArray=_.va,w.renderState=O.isTranslucent()?e._translucentRS:e._opaqueRS,w.pass=O.isTranslucent()?D["a"].TRANSLUCENT:D["a"].OPAQUE,w.debugShowBoundingVolume=f,w.pickId="v_pickColor",w.uniformMap=E,w.count=I,w.offset=b,l=!0,s.push(w)),T=void 0}}n.length=c}function oe(e){let t=!1;const n=e._propertiesChanged,o=e._positionBufferUsage;return n[H]?o.bufferUsage!==w["a"].STREAM_DRAW?(t=!0,o.bufferUsage=w["a"].STREAM_DRAW,o.frameCount=100):o.frameCount=100:o.bufferUsage!==w["a"].STATIC_DRAW&&(0===o.frameCount?(t=!0,o.bufferUsage=w["a"].STATIC_DRAW):o.frameCount--),t}$.prototype.isDestroyed=function(){return!1},$.prototype.destroy=function(){return fe(this),de(this),_e(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(f["a"])(this)};const ie=[0,0,0];function ae(e,t,n){e._createVertexArray=!1,de(e),fe(e),ue(e);const o=[[]];let i=o[0];const a=e._batchTable,s=e._useHighlightColor,r=[0];let c=0;const u=[[]];let h=0;const f=e._polylineBuckets;let _,p;for(_ in f)f.hasOwnProperty(_)&&(p=f[_],p.updateShader(t,a,s),h+=p.lengthOfPositions);if(h>0){const s=e._mode,m=new Float32Array(6*h*3),b=new Float32Array(4*h);let S,x=0,T=0,E=0;for(_ in f)if(f.hasOwnProperty(_)){p=f[_],p.write(m,b,x,T,E,a,t,n),s===z["a"].MORPHING&&(Object(d["a"])(S)||(S=new Float32Array(6*h*3)),p.writeForMorph(S,x));const e=p.lengthOfPositions;x+=6*e*3,T+=4*e,E+=4*e,c=p.updateIndices(o,r,u,c)}const v=e._positionBufferUsage.bufferUsage,D=w["a"].STATIC_DRAW;let I;e._positionBuffer=O["a"].createVertexBuffer({context:t,typedArray:m,usage:v}),Object(d["a"])(S)&&(I=O["a"].createVertexBuffer({context:t,typedArray:S,usage:v})),e._texCoordExpandAndBatchIndexBuffer=O["a"].createVertexBuffer({context:t,typedArray:b,usage:D});const P=3*Float32Array.BYTES_PER_ELEMENT,C=4*Float32Array.BYTES_PER_ELEMENT;let A=0;const B=o.length;for(let n=0;n<B;++n)if(i=o[n],i.length>0){const o=new Uint16Array(i),a=O["a"].createIndexBuffer({context:t,typedArray:o,usage:w["a"].STATIC_DRAW,indexDatatype:g["a"].UNSIGNED_SHORT});A+=r[n];const c=6*(n*(P*y["a"].SIXTY_FOUR_KILOBYTES)-A*P),h=P+c,d=P+h,f=P+d,_=P+f,p=P+_,m=n*(C*y["a"].SIXTY_FOUR_KILOBYTES)-A*C,b=[{index:G.position3DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:c,strideInBytes:6*P},{index:G.position3DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:h,strideInBytes:6*P},{index:G.position2DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:c,strideInBytes:6*P},{index:G.position2DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:h,strideInBytes:6*P},{index:G.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:d,strideInBytes:6*P},{index:G.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:f,strideInBytes:6*P},{index:G.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:d,strideInBytes:6*P},{index:G.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:f,strideInBytes:6*P},{index:G.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:_,strideInBytes:6*P},{index:G.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:p,strideInBytes:6*P},{index:G.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:_,strideInBytes:6*P},{index:G.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:l["a"].FLOAT,offsetInBytes:p,strideInBytes:6*P},{index:G.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:l["a"].FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:m}];let S,x,T,E;s===z["a"].SCENE3D?(x=e._positionBuffer,S="vertexBuffer",T=ie,E="value"):s===z["a"].SCENE2D||s===z["a"].COLUMBUS_VIEW?(x=ie,S="value",T=e._positionBuffer,E="vertexBuffer"):(x=I,S="vertexBuffer",T=e._positionBuffer,E="vertexBuffer"),b[0][S]=x,b[1][S]=x,b[2][E]=T,b[3][E]=T,b[4][S]=x,b[5][S]=x,b[6][E]=T,b[7][E]=T,b[8][S]=x,b[9][S]=x,b[10][E]=T,b[11][E]=T;const v=new j["a"]({context:t,attributes:b,indexBuffer:a});e._vertexArrays.push({va:v,buckets:u[n]})}}}function se(e,t){return t instanceof A["a"]?t.id:t}const re=[];function ce(e){const t=F["a"]._uniformList[e.type],n=t.length;re.length=2*n;let o=0;for(let i=0;i<n;++i){const n=t[i];re[o]=n,re[o+1]=e._uniforms[n](),o+=2}return`${e.type}:${JSON.stringify(re,se)}`}function ue(e){const t=e._mode,n=e._modelMatrix,o=e._polylineBuckets={},i=e._polylines,a=i.length;for(let s=0;s<a;++s){const e=i[s];if(e._actualPositions.length>1){e.update();const i=e.material;let a=o[i.type];Object(d["a"])(a)||(a=o[i.type]=new me(i,t,n)),a.addPolyline(e)}}}function le(e,t){const n=t.mode;e._mode===n&&S["a"].equals(e._modelMatrix,e.modelMatrix)||(e._mode=n,e._modelMatrix=S["a"].clone(e.modelMatrix),e._createVertexArray=!0)}function he(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;const t=[],n=[];let o,i=0;const a=e._polylines.length;for(let s=0;s<a;++s)o=e._polylines[s],o.isDestroyed||(o._index=i++,n.push(o),t.push(o));e._polylines=t,e._polylinesToUpdate=n}}function de(e){const t=e._polylines,n=t.length;for(let o=0;o<n;++o)if(!t[o].isDestroyed){const e=t[o]._bucket;Object(d["a"])(e)&&(e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy())}}function fe(e){const t=e._vertexArrays.length;for(let n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}function _e(e){const t=e._polylines,n=t.length;for(let o=0;o<n;++o)t[o].isDestroyed||t[o]._destroy()}function pe(e,t,n){this.count=e,this.offset=t,this.bucket=n}function me(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}function ge(e){return a["a"].dot(a["a"].UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(x["a"].ORIGIN_ZX_PLANE)===b["a"].INTERSECTING}$.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},me.prototype.addPolyline=function(e){const t=this.polylines;t.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},me.prototype.updateShader=function(e,t,n){if(Object(d["a"])(this.shaderProgram))return;const o=["DISTANCE_DISPLAY_CONDITION"];n&&o.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&o.push("POLYLINE_DASH"),m["a"].isInternetExplorer()||o.push("CLIP_POLYLINE");const i=new C["a"]({defines:o,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,N["a"]]}),a=t.getVertexShaderCallback()(L["a"]),s=new C["a"]({defines:o,sources:[B["a"],a]});this.shaderProgram=P["a"].fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:i,attributeLocations:G})},me.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===z["a"].SCENE3D||!ge(e))return t=e._actualPositions.length,4*t-4;let n=0;const o=e._segments.lengths;t=o.length;for(let i=0;i<t;++i)n+=4*o[i]-4;return n};const be=new a["a"],ye=new a["a"],Se=new a["a"],xe=new a["a"],Te=new s["a"],Oe=new i["a"];me.prototype.write=function(e,t,n,o,i,r,u,l){const h=this.mode,f=l.ellipsoid.maximumRadius*y["a"].PI,_=this.polylines,m=_.length;for(let g=0;g<m;++g){const o=_[g],m=o.width,b=o.show&&m>0,y=o._index,S=this.getSegments(o,l),x=S.positions,T=S.lengths,O=x.length,w=o.getPickId(u).color;let E,v=0,D=0;for(let s=0;s<O;++s){0===s?o._loop?E=x[O-2]:(E=xe,a["a"].subtract(x[0],x[1],E),a["a"].add(x[0],E,E)):E=x[s-1],a["a"].clone(E,ye),a["a"].clone(x[s],be),s===O-1?o._loop?E=x[1]:(E=xe,a["a"].subtract(x[O-1],x[O-2],E),a["a"].add(x[O-1],E,E)):E=x[s+1],a["a"].clone(E,Se);const r=T[v];s===D+r&&(D+=r,++v);const c=s-D===0,u=s===D+T[v]-1;h===z["a"].SCENE2D&&(ye.z=0,be.z=0,Se.z=0),h!==z["a"].SCENE2D&&h!==z["a"].MORPHING||(c||u)&&f-Math.abs(be.x)<1&&((be.x<0&&ye.x>0||be.x>0&&ye.x<0)&&a["a"].clone(be,ye),(be.x<0&&Se.x>0||be.x>0&&Se.x<0)&&a["a"].clone(be,Se));const l=c?2:0,d=u?2:4;for(let o=l;o<d;++o){p["a"].writeElements(be,e,n),p["a"].writeElements(ye,e,n+6),p["a"].writeElements(Se,e,n+12);const a=o-2<0?-1:1;t[i]=s/(O-1),t[i+1]=o%2*2-1,t[i+2]=a,t[i+3]=y,n+=18,i+=4}}const I=Te;I.x=c["a"].floatToByte(w.red),I.y=c["a"].floatToByte(w.green),I.z=c["a"].floatToByte(w.blue),I.w=c["a"].floatToByte(w.alpha);const P=Oe;P.x=m,P.y=b?1:0;const C=h===z["a"].SCENE2D?o._boundingVolume2D:o._boundingVolumeWC,A=p["a"].fromCartesian(C.center,K),j=A.high,B=s["a"].fromElements(A.low.x,A.low.y,A.low.z,C.radius,Q),N=Z;N.x=0,N.y=Number.MAX_VALUE;const L=o.distanceDisplayCondition;Object(d["a"])(L)&&(N.x=L.near,N.y=L.far),r.setBatchedAttribute(y,0,P),r.setBatchedAttribute(y,1,I),r.attributes.length>2&&(r.setBatchedAttribute(y,2,j),r.setBatchedAttribute(y,3,B),r.setBatchedAttribute(y,4,N))}};const we=new a["a"],Ee=new a["a"],ve=new a["a"],De=new a["a"];me.prototype.writeForMorph=function(e,t){const n=this.modelMatrix,o=this.polylines,i=o.length;for(let s=0;s<i;++s){const i=o[s],r=i._segments.positions,c=i._segments.lengths,u=r.length;let l=0,h=0;for(let o=0;o<u;++o){let s;0===o?i._loop?s=r[u-2]:(s=De,a["a"].subtract(r[0],r[1],s),a["a"].add(r[0],s,s)):s=r[o-1],s=S["a"].multiplyByPoint(n,s,Ee);const d=S["a"].multiplyByPoint(n,r[o],we);let f;o===u-1?i._loop?f=r[1]:(f=De,a["a"].subtract(r[u-1],r[u-2],f),a["a"].add(r[u-1],f,f)):f=r[o+1],f=S["a"].multiplyByPoint(n,f,ve);const _=c[l];o===h+_&&(h+=_,++l);const m=o-h===0,g=o===h+c[l]-1,b=m?2:0,y=g?2:4;for(let n=b;n<y;++n)p["a"].writeElements(d,e,t),p["a"].writeElements(s,e,t+6),p["a"].writeElements(f,e,t+12),t+=18}}};const Ie=new Array(1);me.prototype.updateIndices=function(e,t,n,o){let i=n.length-1,a=new pe(0,o,this);n[i].push(a);let s=0,r=e[e.length-1],c=0;r.length>0&&(c=r[r.length-1]+1);const u=this.polylines,l=u.length;for(let h=0;h<l;++h){const l=u[h];let d;if(l._locatorBuckets=[],this.mode===z["a"].SCENE3D){d=Ie;const e=l._actualPositions.length;if(!(e>0))continue;d[0]=e}else d=l._segments.lengths;const f=d.length;if(f>0){let u=0;for(let h=0;h<f;++h){const f=d[h]-1;for(let h=0;h<f;++h)c+4>y["a"].SIXTY_FOUR_KILOBYTES&&(l._locatorBuckets.push({locator:a,count:u}),u=0,t.push(4),r=[],e.push(r),c=0,a.count=s,s=0,o=0,a=new pe(0,0,this),n[++i]=[a]),r.push(c,c+2,c+1),r.push(c+1,c+2,c+3),u+=6,s+=6,o+=6,c+=4}l._locatorBuckets.push({locator:a,count:u}),c+4>y["a"].SIXTY_FOUR_KILOBYTES&&(t.push(0),r=[],e.push(r),c=0,a.count=s,o=0,s=0,a=new pe(0,0,this),n[++i]=[a])}l._clean()}return a.count=s,o},me.prototype.getPolylineStartIndex=function(e){const t=this.polylines;let n=0;const o=t.length;for(let i=0;i<o;++i){const o=t[i];if(o===e)break;n+=o._actualLength}return n};const Pe={positions:void 0,lengths:void 0},Ce=new Array(1),Ae=new a["a"],je=new r["a"];let Be;me.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===z["a"].SCENE3D)return Ce[0]=n.length,Pe.positions=n,Pe.lengths=Ce,Pe;ge(e)&&(n=e._segments.positions);const i=t.ellipsoid,s=[],r=this.modelMatrix,c=n.length;let u,l=Ae;for(let o=0;o<c;++o)u=n[o],l=S["a"].multiplyByPoint(r,u,l),s.push(t.project(i.cartesianToCartographic(l,je)));if(s.length>0){e._boundingVolume2D=o["a"].fromPoints(s,e._boundingVolume2D);const t=e._boundingVolume2D.center;e._boundingVolume2D.center=new a["a"](t.z,t.x,t.y)}return Pe.positions=s,Pe.lengths=e._segments.lengths,Pe},me.prototype.writeUpdate=function(e,t,n,o){const i=this.mode,s=o.ellipsoid.maximumRadius*y["a"].PI;let r=t._actualLength;if(r){e+=this.getPolylineStartIndex(t);let c=Be;const u=6*r*3;!Object(d["a"])(c)||c.length<u?c=Be=new Float32Array(u):c.length>u&&(c=new Float32Array(c.buffer,0,u));const l=this.getSegments(t,o),h=l.positions,f=l.lengths;let _,m=0,g=0,b=0;r=h.length;for(let e=0;e<r;++e){0===e?t._loop?_=h[r-2]:(_=xe,a["a"].subtract(h[0],h[1],_),a["a"].add(h[0],_,_)):_=h[e-1],a["a"].clone(_,ye),a["a"].clone(h[e],be),e===r-1?t._loop?_=h[1]:(_=xe,a["a"].subtract(h[r-1],h[r-2],_),a["a"].add(h[r-1],_,_)):_=h[e+1],a["a"].clone(_,Se);const n=f[g];e===b+n&&(b+=n,++g);const o=e-b===0,u=e===b+f[g]-1;i===z["a"].SCENE2D&&(ye.z=0,be.z=0,Se.z=0),i!==z["a"].SCENE2D&&i!==z["a"].MORPHING||(o||u)&&s-Math.abs(be.x)<1&&((be.x<0&&ye.x>0||be.x>0&&ye.x<0)&&a["a"].clone(be,ye),(be.x<0&&Se.x>0||be.x>0&&Se.x<0)&&a["a"].clone(be,Se));const l=o?2:0,d=u?2:4;for(let e=l;e<d;++e)p["a"].writeElements(be,c,m),p["a"].writeElements(ye,c,m+6),p["a"].writeElements(Se,c,m+12),m+=18}n.copyFromArrayView(c,18*Float32Array.BYTES_PER_ELEMENT*e)}},t["a"]=$}}]);